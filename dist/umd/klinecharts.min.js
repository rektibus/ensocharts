/**
     * @license
     * KLineChart v10.0.0-beta1
     * Copyright (c) 2019 lihu.
     * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
     */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).klinecharts={})}(this,function(t){"use strict";function e(t,s){if(r(t)||r(s))for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)){const n=t[a],o=s[a];r(o)&&r(n)?e(n,o):t[a]=i(o)}}function i(t){if(!r(t))return t;let e=null;e=s(t)?[]:{};for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const a=t[s];r(a)?e[s]=i(a):e[s]=a}return e}function s(t){return"[object Array]"===Object.prototype.toString.call(t)}function a(t){return"function"==typeof t}function r(t){return"object"==typeof t&&o(t)}function n(t){return"number"==typeof t&&Number.isFinite(t)}function o(t){return null!=t}function l(t){return"boolean"==typeof t}function c(t){return"string"==typeof t}function h(t){return"transparent"===t||"none"===t||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(t)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(t)}function d(t,e){const i=t.replace(/^#/,""),s=parseInt(i,16);return`rgba(${s>>16&255}, ${s>>8&255}, ${255&s}, ${e??1})`}const u={RED:"#F92855",GREEN:"#2DC08E",WHITE:"#FFFFFF",GREY:"#76808F",BLUE:"#1677FF"};function g(){const t={show:!0,color:u.GREY,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"};return{type:"candle_solid",bar:{compareRule:"current_open",upColor:u.GREEN,downColor:u.RED,noChangeColor:u.GREY,upBorderColor:u.GREEN,downBorderColor:u.RED,noChangeBorderColor:u.GREY,upWickColor:u.GREEN,downWickColor:u.RED,noChangeWickColor:u.GREY},area:{lineSize:2,lineColor:u.BLUE,smooth:!1,value:"close",backgroundColor:[{offset:0,color:d(u.BLUE,.01)},{offset:1,color:d(u.BLUE,.2)}],point:{show:!0,color:u.BLUE,radius:4,rippleColor:d(u.BLUE,.3),rippleRadius:8,animation:!0,animationDuration:1e3}},priceMark:{show:!0,high:{...t},low:{...t},last:{show:!0,compareRule:"current_open",upColor:u.GREEN,downColor:u.RED,noChangeColor:u.GREY,line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],color:u.WHITE,family:"Helvetica Neue",weight:"normal",borderRadius:2},extendTexts:[]}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",rect:{position:"fixed",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},title:{show:!0,size:14,family:"Helvetica Neue",weight:"normal",color:u.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,template:"{ticker} · {period}"},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:u.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:[{title:"time",value:"{time}"},{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}]},features:[]}}}function p(){const t=d(u.GREEN,.7),e=d(u.RED,.7);return{ohlc:{compareRule:"current_open",upColor:t,downColor:e,noChangeColor:u.GREY},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:t,downColor:e,noChangeColor:u.GREY}],lines:["#FF9600","#935EBD",u.BLUE,"#E11D74","#01C5C4"].map(t=>({style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:t})),circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:t,downColor:e,noChangeColor:u.GREY}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:u.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",title:{show:!0,showName:!0,showParams:!0,size:12,family:"Helvetica Neue",weight:"normal",color:u.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:u.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a"},features:[]}}}function m(){return{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:u.GREY,size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}}}function y(){const t=d(u.BLUE,.35),e=d(u.BLUE,.25);return{point:{color:u.BLUE,borderColor:t,borderSize:1,radius:5,activeColor:u.BLUE,activeBorderColor:t,activeBorderSize:3,activeRadius:5},line:{style:"solid",smooth:!1,color:u.BLUE,size:1,dashedValue:[2,2]},rect:{style:"fill",color:e,borderColor:u.BLUE,borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:u.BLUE,borderColor:u.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:e,borderColor:u.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:u.BLUE,size:1,dashedValue:[2,2]},text:{style:"fill",color:u.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:u.BLUE,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:u.BLUE}}}const x=/\\(\\)?/g,f=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g");function _(t,e,i){if(o(t)){const s=[];e.replace(f,(t,...e)=>{let i=t;return o(e[1])?i=e[2].replace(x,"$1"):o(e[0])&&(i=e[0].trim()),s.push(i),""});let a=t,r=0;const n=s.length;for(;o(a)&&r<n;)a=a?.[s[r++]];return o(a)?a:i??"--"}return i??"--"}function v(t,e,i){const s=function(t,e){const i={};return t.formatToParts(new Date(e)).forEach(({type:t,value:e})=>{switch(t){case"year":i.YYYY=e;break;case"month":i.MM=e;break;case"day":i.DD=e;break;case"hour":i.HH="24"===e?"00":e;break;case"minute":i.mm=e;break;case"second":i.ss=e}}),i}(t,e);return i.replace(/YYYY|MM|DD|HH|mm|ss/g,t=>s[t])}function b(t,e){const i=+t;return n(i)?i.toFixed(e??2):`${t}`}function E(t){const e=+t;if(n(e)){if(e>1e9)return+(e/1e9).toFixed(3)+"B";if(e>1e6)return+(e/1e6).toFixed(3)+"M";if(e>1e3)return+(e/1e3).toFixed(3)+"K"}return`${t}`}function C(t,e){const i=`${t}`;if(0===e.length)return i;if(i.includes(".")){const t=i.split(".");return`${t[0].replace(/(\d)(?=(\d{3})+$)/g,t=>`${t}${e}`)}.${t[1]}`}return i.replace(/(\d)(?=(\d{3})+$)/g,t=>`${t}${e}`)}function w(t,e){const i=`${t}`;if(new RegExp("\\.0{"+e+",}[1-9][0-9]*$").test(i)){const t=i.split("."),e=t.length-1,s=t[e],a=/0*/.exec(s);if(o(a)){const i=a[0].length;return t[e]=s.replace(/0*/,`0{${i}}`),t.join(".")}}return i}function P(t,e){return t.replace(/\{(\w+)\}/g,(t,i)=>{const s=e[i];return o(s)?s:`{${i}}`})}let S=null;function I(t){return t.ownerDocument.defaultView?.devicePixelRatio??1}function D(t,e,i){return`${e??"normal"} ${t??12}px ${i??"Helvetica Neue"}`}function T(t,e,i,s){if(!o(S)){const t=document.createElement("canvas"),e=I(t);S=t.getContext("2d"),S.scale(e,e)}return S.font=D(e,i,s),Math.round(S.measureText(t).width)}function M(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}class F{_children=[];_callbacks=new Map;registerEvent(t,e){return this._callbacks.set(t,e),this}onEvent(t,e){const i=this._callbacks.get(t);return!(!o(i)||!this.checkEventOn(e))&&i(e)}dispatchEventToChildren(t,e){const i=this._children.length-1;if(i>-1)for(let s=i;s>-1;s--)if(this._children[s].dispatchEvent(t,e))return!0;return!1}dispatchEvent(t,e){return!!this.dispatchEventToChildren(t,e)||this.onEvent(t,e)}addChild(t){return this._children.push(t),this}clear(){this._children=[]}}class A extends F{attrs;styles;constructor(t){super(),this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}setAttrs(t){return this.attrs=t,this}setStyles(t){return this.styles=t,this}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){return class extends A{checkEventOnImp(e,i,s){return t.checkEventOn(e,i,s)}drawImp(e,i,s){t.draw(e,i,s)}}}}function k(t,e){let i=[];i=i.concat(e);for(const e of i)if(Math.abs(M(t,e)-e.r)<2){const{r:i,startAngle:s,endAngle:a}=e,r=i*Math.cos(s)+e.x,n=i*Math.sin(s)+e.y,o=i*Math.cos(a)+e.x,l=i*Math.sin(a)+e.y;if(t.x<=Math.max(r,o)+2&&t.x>=Math.min(r,o)-2&&t.y<=Math.max(n,l)+2&&t.y>=Math.min(n,l)-2)return!0}return!1}const B={name:"arc",checkEventOn:k,draw:(t,e,i)=>{!function(t,e,i){let s=[];s=s.concat(e);const{style:a="solid",size:r=1,color:n="currentColor",dashedValue:o=[2,2]}=i;t.lineWidth=r,t.strokeStyle=n,"dashed"===a?t.setLineDash(o):t.setLineDash([]),s.forEach(({x:e,y:i,r:s,startAngle:a,endAngle:r})=>{t.beginPath(),t.arc(e,i,s,a,r),t.stroke(),t.closePath()})}(t,e,i)}};function R(t,e){let i=[];i=i.concat(e);for(const e of i){const{x:i,y:s,r:a}=e,r=t.x-i,n=t.y-s;if(!(r*r+n*n>a*a))return!0}return!1}const L={name:"circle",checkEventOn:R,draw:(t,e,i)=>{!function(t,e,i){let s=[];s=s.concat(e);const{style:a="fill",color:r="currentColor",borderSize:n=1,borderColor:o="currentColor",borderStyle:l="solid",borderDashedValue:d=[2,2]}=i,u=!("fill"!==a&&"stroke_fill"!==i.style||c(r)&&h(r));u&&(t.fillStyle=r,s.forEach(({x:e,y:i,r:s})=>{t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.closePath(),t.fill()})),("stroke"===a||"stroke_fill"===i.style)&&n>0&&!h(o)&&(t.strokeStyle=o,t.lineWidth=n,"dashed"===l?t.setLineDash(d):t.setLineDash([]),s.forEach(({x:e,y:i,r:s})=>{(!u||s>n)&&(t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.closePath(),t.stroke())}))}(t,e,i)}};function O(t,e){let i=[];i=i.concat(e);for(const e of i){const{coordinates:i}=e;if(i.length>1)for(let e=1;e<i.length;e++){const s=i[e-1],a=i[e];if(s.x===a.x){if(Math.abs(s.y-t.y)+Math.abs(a.y-t.y)-Math.abs(s.y-a.y)<4&&Math.abs(t.x-s.x)<2)return!0}else{const e=N(s,a),i=W(e,t),r=Math.abs(i-t.y);if(Math.abs(s.x-t.x)+Math.abs(a.x-t.x)-Math.abs(s.x-a.x)<4&&r*r/(e[0]*e[0]+1)<4)return!0}}}return!1}function W(t,e){return null!==t?e.x*t[0]+t[1]:e.y}function Y(t,e,i){return W(N(t,e),i)}function N(t,e){const i=t.x-e.x;if(0!==i){const s=(t.y-e.y)/i;return[s,t.y-s*t.x]}return null}function z(t,e,i){const s=e.length,a=n(i)?i>0&&i<1?i:0:i?.5:0;if(a>0&&s>2){let i=e[0].x,r=e[0].y;for(let n=1;n<s-1;n++){const s=e[n-1],o=e[n],l=e[n+1],c=o.x-s.x,h=o.y-s.y,d=l.x-o.x,u=l.y-o.y;let g=l.x-s.x,p=l.y-s.y;const m=Math.sqrt(c*c+h*h),y=Math.sqrt(d*d+u*u),x=y/(y+m);let f=o.x+g*a*x,_=o.y+p*a*x;f=Math.min(f,Math.max(l.x,o.x)),_=Math.min(_,Math.max(l.y,o.y)),f=Math.max(f,Math.min(l.x,o.x)),_=Math.max(_,Math.min(l.y,o.y)),g=f-o.x,p=_-o.y;let v=o.x-g*m/y,b=o.y-p*m/y;v=Math.min(v,Math.max(s.x,o.x)),b=Math.min(b,Math.max(s.y,o.y)),v=Math.max(v,Math.min(s.x,o.x)),b=Math.max(b,Math.min(s.y,o.y)),g=o.x-v,p=o.y-b,f=o.x+g*y/m,_=o.y+p*y/m,t.bezierCurveTo(i,r,v,b,o.x,o.y),i=f,r=_}const n=e[s-1];t.bezierCurveTo(i,r,n.x,n.y,n.x,n.y)}else for(let i=1;i<s;i++)t.lineTo(e[i].x,e[i].y)}const V={name:"line",checkEventOn:O,draw:(t,e,i)=>{!function(t,e,i){let s=[];s=s.concat(e);const{style:a="solid",smooth:r=!1,size:n=1,color:o="currentColor",dashedValue:l=[2,2]}=i;t.lineWidth=n,t.strokeStyle=o,"dashed"===a?t.setLineDash(l):t.setLineDash([]);const c=n%2==1?.5:0;s.forEach(({coordinates:e})=>{e.length>1&&(2!==e.length||e[0].x!==e[1].x&&e[0].y!==e[1].y?(t.save(),n%2==1&&t.translate(.5,.5),t.beginPath(),t.moveTo(e[0].x,e[0].y),z(t,e,r),t.stroke(),t.closePath(),t.restore()):(t.beginPath(),e[0].x===e[1].x?(t.moveTo(e[0].x+c,e[0].y),t.lineTo(e[1].x+c,e[1].y)):(t.moveTo(e[0].x,e[0].y+c),t.lineTo(e[1].x,e[1].y+c)),t.stroke(),t.closePath()))})}(t,e,i)}};function X(t,e){let i=[];i=i.concat(e);for(const e of i){let i=!1;const{coordinates:s}=e;for(let e=0,a=s.length-1;e<s.length;a=e++)s[e].y>t.y!=s[a].y>t.y&&t.x<(s[a].x-s[e].x)*(t.y-s[e].y)/(s[a].y-s[e].y)+s[e].x&&(i=!i);if(i)return!0}return!1}const H={name:"polygon",checkEventOn:X,draw:(t,e,i)=>{!function(t,e,i){let s=[];s=s.concat(e);const{style:a="fill",color:r="currentColor",borderSize:n=1,borderColor:o="currentColor",borderStyle:l="solid",borderDashedValue:d=[2,2]}=i;"fill"!==a&&"stroke_fill"!==i.style||c(r)&&h(r)||(t.fillStyle=r,s.forEach(({coordinates:e})=>{t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.closePath(),t.fill()})),("stroke"===a||"stroke_fill"===i.style)&&n>0&&!h(o)&&(t.strokeStyle=o,t.lineWidth=n,"dashed"===l?t.setLineDash(d):t.setLineDash([]),s.forEach(({coordinates:e})=>{t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.closePath(),t.stroke()}))}(t,e,i)}};function $(t,e){let i=[];i=i.concat(e);for(const e of i){let i=e.x,s=e.width;s<4&&(i-=2,s=4);let a=e.y,r=e.height;if(r<4&&(a-=2,r=4),t.x>=i&&t.x<=i+s&&t.y>=a&&t.y<=a+r)return!0}return!1}function G(t,e,i){let s=[];s=s.concat(e);const{style:a="fill",color:r="transparent",borderSize:n=1,borderColor:o="transparent",borderStyle:l="solid",borderRadius:d=0,borderDashedValue:u=[2,2]}=i,g=t.roundRect??t.rect,p=!("fill"!==a&&"stroke_fill"!==i.style||c(r)&&h(r));if(p&&(t.fillStyle=r,s.forEach(({x:e,y:i,width:s,height:a})=>{t.beginPath(),g.call(t,e,i,s,a,d),t.closePath(),t.fill()})),("stroke"===a||"stroke_fill"===i.style)&&n>0&&!h(o)){t.strokeStyle=o,t.fillStyle=o,t.lineWidth=n,"dashed"===l?t.setLineDash(u):t.setLineDash([]);const e=n%2==1?.5:0,i=Math.round(2*e);s.forEach(({x:s,y:a,width:r,height:o})=>{r>2*n&&o>2*n?(t.beginPath(),g.call(t,s+e,a+e,r-i,o-i,d),t.closePath(),t.stroke()):p||t.fillRect(s,a,r,o)})}}const U={name:"rect",checkEventOn:$,draw:(t,e,i)=>{G(t,e,i)}};function Z(t,e){const{size:i=12,paddingLeft:s=0,paddingTop:a=0,paddingRight:r=0,paddingBottom:n=0,weight:o="normal",family:l}=e,{x:c,y:h,text:d,align:u="left",baseline:g="top",width:p,height:m}=t,y=p??s+T(d,i,o,l)+r,x=m??a+i+n;let f=0;switch(u){case"left":case"start":f=c;break;case"right":case"end":f=c-y;break;default:f=c-y/2}let _=0;switch(g){case"top":case"hanging":_=h;break;case"bottom":case"ideographic":case"alphabetic":_=h-x;break;default:_=h-x/2}return{x:f,y:_,width:y,height:x}}function q(t,e,i){let s=[];s=s.concat(e);for(const e of s){const{x:s,y:a,width:r,height:n}=Z(e,i);if(t.x>=s&&t.x<=s+r&&t.y>=a&&t.y<=a+n)return!0}return!1}const j={name:"text",checkEventOn:q,draw:(t,e,i)=>{!function(t,e,i){let s=[];s=s.concat(e);const{color:a="currentColor",size:r=12,family:n,weight:o,paddingLeft:l=0,paddingTop:c=0,paddingRight:h=0}=i,d=s.map(t=>Z(t,i));G(t,d,{...i,color:i.backgroundColor}),t.textAlign="left",t.textBaseline="top",t.font=D(r,o,n),t.fillStyle=a,s.forEach((e,i)=>{const s=d[i];t.fillText(e.text,s.x+l,s.y+c,s.width-l-h)})}(t,e,i)}};function Q(t,e,i,s,a,r,n){const[o,l,c,h,d,u,g]=s,p=function(t,e,i,s,a,r,n,o,l){const{cx:c,cy:h,startAngle:d,deltaAngle:u}=function(t,e,i,s,a,r,n,o,l){const c=a*Math.PI/180,h=(t-o)/2,d=(e-l)/2,u=Math.cos(c)*h+Math.sin(c)*d,g=-Math.sin(c)*h+Math.cos(c)*d,p=u**2/i**2+g**2/s**2;p>1&&(i*=Math.sqrt(p),s*=Math.sqrt(p));const m=r===n?-1:1,y=i**2*s**2-i**2*g**2-s**2*u**2,x=i**2*g**2+s**2*u**2,f=m*Math.sqrt(Math.abs(y/x))*(i*g/s),_=m*Math.sqrt(Math.abs(y/x))*(-s*u/i),v=Math.cos(c)*f-Math.sin(c)*_+(t+o)/2,b=Math.sin(c)*f+Math.cos(c)*_+(e+l)/2,E=Math.atan2((g-_)/s,(u-f)/i);let C=Math.atan2((-g-_)/s,(-u-f)/i)-E;C<0&&1===n?C+=2*Math.PI:C>0&&0===n&&(C-=2*Math.PI);return{cx:v,cy:b,startAngle:E,deltaAngle:C}}(t,e,i,s,a,r,n,o,l),g=[],p=Math.ceil(Math.abs(u)/(Math.PI/2));for(let t=0;t<p;t++){const e=J(c,h,i,s,a,d+t*u/p,d+(t+1)*u/p);g.push(e)}return g}(e,i,o,l,c,h,d,n?e+u:u+a,n?i+g:g+r);p.forEach(e=>{t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])})}function J(t,e,i,s,a,r,n){const o=Math.sin(n-r)*(Math.sqrt(4+3*Math.tan((n-r)/2)**2)-1)/3,l=Math.cos(a),c=Math.sin(a),h=t+i*Math.cos(r)*l-s*Math.sin(r)*c,d=e+i*Math.cos(r)*c+s*Math.sin(r)*l,u=t+i*Math.cos(n)*l-s*Math.sin(n)*c,g=e+i*Math.cos(n)*c+s*Math.sin(n)*l;return[h+o*(-i*Math.sin(r)*l-s*Math.cos(r)*c),d+o*(-i*Math.sin(r)*c+s*Math.cos(r)*l),u-o*(-i*Math.sin(n)*l-s*Math.cos(n)*c),g-o*(-i*Math.sin(n)*c+s*Math.cos(n)*l),u,g]}const K={name:"path",checkEventOn:$,draw:(t,e,i)=>{!function(t,e,i){let s=[];s=s.concat(e);const{lineWidth:a=1,color:r="currentColor"}=i;t.lineWidth=a,t.strokeStyle=r,t.setLineDash([]),s.forEach(({x:e,y:s,path:a})=>{const r=a.match(/[MLHVCSQTAZ][^MLHVCSQTAZ]*/gi);if(o(r)){const a=e,n=s;t.beginPath(),r.forEach(e=>{let i=0,s=0,r=0,o=0;const l=e[0],c=e.slice(1).trim().split(/[\s,]+/).map(Number);switch(l){case"M":i=c[0]+a,s=c[1]+n,t.moveTo(i,s),r=i,o=s;break;case"m":i+=c[0],s+=c[1],t.moveTo(i,s),r=i,o=s;break;case"L":i=c[0]+a,s=c[1]+n,t.lineTo(i,s);break;case"l":i+=c[0],s+=c[1],t.lineTo(i,s);break;case"H":i=c[0]+a,t.lineTo(i,s);break;case"h":i+=c[0],t.lineTo(i,s);break;case"V":s=c[0]+n,t.lineTo(i,s);break;case"v":s+=c[0],t.lineTo(i,s);break;case"C":t.bezierCurveTo(c[0]+a,c[1]+n,c[2]+a,c[3]+n,c[4]+a,c[5]+n),i=c[4]+a,s=c[5]+n;break;case"c":t.bezierCurveTo(i+c[0],s+c[1],i+c[2],s+c[3],i+c[4],s+c[5]),i+=c[4],s+=c[5];break;case"S":t.bezierCurveTo(i,s,c[0]+a,c[1]+n,c[2]+a,c[3]+n),i=c[2]+a,s=c[3]+n;break;case"s":t.bezierCurveTo(i,s,i+c[0],s+c[1],i+c[2],s+c[3]),i+=c[2],s+=c[3];break;case"Q":t.quadraticCurveTo(c[0]+a,c[1]+n,c[2]+a,c[3]+n),i=c[2]+a,s=c[3]+n;break;case"q":t.quadraticCurveTo(i+c[0],s+c[1],i+c[2],s+c[3]),i+=c[2],s+=c[3];break;case"T":t.quadraticCurveTo(i,s,c[0]+a,c[1]+n),i=c[0]+a,s=c[1]+n;break;case"t":t.quadraticCurveTo(i,s,i+c[0],s+c[1]),i+=c[0],s+=c[1];break;case"A":Q(t,i,s,c,a,n,!1),i=c[5]+a,s=c[6]+n;break;case"a":Q(t,i,s,c,a,n,!0),i+=c[5],s+=c[6];break;case"Z":case"z":t.closePath(),i=r,s=o}}),"fill"===i.style?t.fill():t.stroke()}})}(t,e,i)}},tt={};function et(t,e,i,s){const a=t.result,r=t.figures,n=t.styles,l=_(n,"circles",i.circles),c=l.length,h=_(n,"bars",i.bars),d=h.length,u=_(n,"lines",i.lines),g=u.length;let p,m=0,y=0,x=0,f=0;r.forEach(r=>{switch(r.type){case"circle":{f=m;const t=l[m%c];p={...t,color:t.noChangeColor},m++;break}case"bar":{f=y;const t=h[y%d];p={...t,color:t.noChangeColor},y++;break}case"line":f=x,p=u[x%g],x++}if(o(r.type)){const n=r.styles?.({data:{prev:a[e-1],current:a[e],next:a[e+1]},indicator:t,defaultStyles:i});s(r,{...p,...n},f)}})}[L,V,H,U,j,B,K].forEach(t=>{tt[t.name]=A.extend(t)});class it{id;paneId;name;shortName;precision=4;calcParams=[];shouldOhlc=!1;shouldFormatBigNumber=!1;visible=!0;zLevel=0;extendData;series="normal";figures=[];minValue=null;maxValue=null;styles=null;shouldUpdate=(t,e)=>{const i=JSON.stringify(t.calcParams)!==JSON.stringify(e.calcParams)||t.figures!==e.figures||t.calc!==e.calc;return{calc:i,draw:i||t.shortName!==e.shortName||t.series!==e.series||t.minValue!==e.minValue||t.maxValue!==e.maxValue||t.precision!==e.precision||t.shouldOhlc!==e.shouldOhlc||t.shouldFormatBigNumber!==e.shouldFormatBigNumber||t.visible!==e.visible||t.zLevel!==e.zLevel||t.extendData!==e.extendData||t.regenerateFigures!==e.regenerateFigures||t.createTooltipDataSource!==e.createTooltipDataSource||t.draw!==e.draw}};calc=()=>[];regenerateFigures=null;createTooltipDataSource=null;draw=null;result=[];_prevIndicator;_lockSeriesPrecision=!1;constructor(t){this.override(t),this._lockSeriesPrecision=!1}override(t){const{result:s,...r}=this;this._prevIndicator={...i(r),result:s};const{id:l,name:h,shortName:d,precision:u,styles:g,figures:p,calcParams:m,...y}=t;!c(this.id)&&c(l)&&(this.id=l),c(this.name)||(this.name=h??""),this.shortName=d??this.shortName??this.name,n(u)&&(this.precision=u,this._lockSeriesPrecision=!0),o(g)&&(this.styles??={},e(this.styles,g)),e(this,y),o(m)&&(this.calcParams=m,a(this.regenerateFigures)&&(this.figures=this.regenerateFigures(this.calcParams))),this.figures=p??this.figures}setSeriesPrecision(t){this._lockSeriesPrecision||(this.precision=t)}shouldUpdateImp(){const t=this._prevIndicator.zLevel!==this.zLevel,e=this.shouldUpdate(this._prevIndicator,this);return l(e)?{calc:e,draw:e,sort:t}:{...e,sort:t}}async calcImp(t){try{const e=await this.calc(t,this);return this.result=e,!0}catch(t){return!1}}static extend(t){return class extends it{constructor(){super(t)}}}}const st={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:({data:t,indicator:e,defaultStyles:i})=>{const{prev:s,current:a}=t,r=s?.ao??Number.MIN_SAFE_INTEGER,n=a?.ao??Number.MIN_SAFE_INTEGER;let o="";o=n>r?_(e.styles,"bars[0].upColor",i.bars[0].upColor):_(e.styles,"bars[0].downColor",i.bars[0].downColor);return{color:o,style:n>r?"stroke":"fill",borderColor:o}}}],calc:(t,e)=>{const i=e.calcParams,s=Math.max(i[0],i[1]);let a=0,r=0,n=0,o=0;return t.map((e,l)=>{const c={},h=(e.low+e.high)/2;if(a+=h,r+=h,l>=i[0]-1){n=a/i[0];const e=t[l-(i[0]-1)];a-=(e.low+e.high)/2}if(l>=i[1]-1){o=r/i[1];const e=t[l-(i[1]-1)];r-=(e.low+e.high)/2}return l>=s-1&&(c.ao=n-o),c})}};const at={name:"BOLL",shortName:"BOLL",series:"price",calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,s=i[0]-1;let a=0;return t.map((e,r)=>{const n=e.close,o={};if(a+=n,r>=s){o.mid=a/i[0];const e=function(t,e){const i=t.length;let s=0;return t.forEach(t=>{const i=t.close-e;s+=i*i}),s=Math.abs(s),Math.sqrt(s/i)}(t.slice(r-s,r+1),o.mid);o.up=o.mid+i[1]*e,o.dn=o.mid-i[1]*e,a-=t[r-s].close}return o})}},rt={name:"BBI",shortName:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,s=Math.max(...i),a=[],r=[];return t.map((e,n)=>{const o={},l=e.close;if(i.forEach((e,i)=>{a[i]=(a[i]??0)+l,n>=e-1&&(r[i]=a[i]/e,a[i]-=t[n-(e-1)].close)}),n>=s-1){let t=0;r.forEach(e=>{t+=e}),o.bbi=t/4}return o})}},nt={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,s=i[0]-1;let a=0;const r=[];return t.map((e,n)=>{const o={},l=(e.high+e.low+e.close)/3;if(a+=l,r.push(l),n>=s){const e=a/i[0],c=r.slice(n-s,n+1);let h=0;c.forEach(t=>{h+=Math.abs(t-e)});const d=h/i[0];o.cci=0!==d?(l-e)/d/.015:0;const u=(t[n-s].high+t[n-s].low+t[n-s].close)/3;a-=u}return o})}},ot={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,s=Math.ceil(i[1]/2.5+1),a=Math.ceil(i[2]/2.5+1),r=Math.ceil(i[3]/2.5+1),n=Math.ceil(i[4]/2.5+1);let o=0;const l=[];let c=0;const h=[];let d=0;const u=[];let g=0;const p=[],m=[];return t.forEach((e,y)=>{const x={},f=t[y-1]??e,_=(f.high+f.close+f.low+f.open)/4,v=Math.max(0,e.high-_),b=Math.max(0,_-e.low);y>=i[0]-1&&(x.cr=0!==b?v/b*100:0,o+=x.cr,c+=x.cr,d+=x.cr,g+=x.cr,y>=i[0]+i[1]-2&&(l.push(o/i[1]),y>=i[0]+i[1]+s-3&&(x.ma1=l[l.length-1-s]),o-=m[y-(i[1]-1)].cr??0),y>=i[0]+i[2]-2&&(h.push(c/i[2]),y>=i[0]+i[2]+a-3&&(x.ma2=h[h.length-1-a]),c-=m[y-(i[2]-1)].cr??0),y>=i[0]+i[3]-2&&(u.push(d/i[3]),y>=i[0]+i[3]+r-3&&(x.ma3=u[u.length-1-r]),d-=m[y-(i[3]-1)].cr??0),y>=i[0]+i[4]-2&&(p.push(g/i[4]),y>=i[0]+i[4]+n-3&&(x.ma4=p[p.length-1-n]),g-=m[y-(i[4]-1)].cr??0)),m.push(x)}),m}},lt={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,s=Math.max(i[0],i[1]);let a=0,r=0,n=0;const o=[];return t.forEach((e,l)=>{const c={},h=e.close;a+=h,r+=h;let d=0,u=0;if(l>=i[0]-1&&(d=a/i[0],a-=t[l-(i[0]-1)].close),l>=i[1]-1&&(u=r/i[1],r-=t[l-(i[1]-1)].close),l>=s-1){const t=d-u;c.dma=t,n+=t,l>=s+i[2]-2&&(c.ama=n/i[2],n-=o[l-(i[2]-1)].dma??0)}o.push(c)}),o}},ct={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let s=0,a=0,r=0,n=0,o=0,l=0,c=0,h=0;const d=[];return t.forEach((e,u)=>{const g={},p=t[u-1]??e,m=p.close,y=e.high,x=e.low,f=y-x,_=Math.abs(y-m),v=Math.abs(m-x),b=y-p.high,E=p.low-x,C=Math.max(Math.max(f,_),v),w=b>0&&b>E?b:0,P=E>0&&E>b?E:0;if(s+=C,a+=w,r+=P,u>=i[0]-1){u>i[0]-1?(n=n-n/i[0]+C,o=o-o/i[0]+w,l=l-l/i[0]+P):(n=s,o=a,l=r);let t=0,e=0;0!==n&&(t=100*o/n,e=100*l/n),g.pdi=t,g.mdi=e;let p=0;e+t!==0&&(p=Math.abs(e-t)/(e+t)*100),c+=p,u>=2*i[0]-2&&(h=u>2*i[0]-2?(h*(i[0]-1)+p)/i[0]:c/i[0],g.adx=h,u>=2*i[0]+i[1]-3&&(g.adxr=((d[u-(i[1]-1)].adx??0)+h)/2))}d.push(g)}),d}},ht={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:({data:t,indicator:e,defaultStyles:i})=>{const{prev:s,current:a}=t,r=s?.macd??Number.MIN_SAFE_INTEGER,n=a?.macd??Number.MIN_SAFE_INTEGER;let o="";o=n>0?_(e.styles,"bars[0].upColor",i.bars[0].upColor):n<0?_(e.styles,"bars[0].downColor",i.bars[0].downColor):_(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor);return{style:r<n?"stroke":"fill",color:o,borderColor:o}}}],calc:(t,e)=>{const i=e.calcParams;let s=0,a=0,r=0,n=0,o=0,l=0;const c=Math.max(i[0],i[1]);return t.map((t,e)=>{const h={},d=t.close;return s+=d,e>=i[0]-1&&(a=e>i[0]-1?(2*d+(i[0]-1)*a)/(i[0]+1):s/i[0]),e>=i[1]-1&&(r=e>i[1]-1?(2*d+(i[1]-1)*r)/(i[1]+1):s/i[1]),e>=c-1&&(n=a-r,h.dif=n,o+=n,e>=c+i[2]-2&&(l=e>c+i[2]-2?(2*n+l*(i[2]-1))/(i[2]+1):o/i[2],h.macd=2*(n-l),h.dea=l)),h})}},dt={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:t=>t.map((t,e)=>{const i=e+1;return{key:`rsi${i}`,title:`RSI${i}: `,type:"line"}}),calc:(t,e)=>{const{calcParams:i,figures:s}=e,a=[],r=[];return t.map((e,n)=>{const o={},l=(t[n-1]??e).close,c=e.close-l;return i.forEach((e,i)=>{if(c>0?a[i]=(a[i]??0)+c:r[i]=(r[i]??0)+Math.abs(c),n>=e-1){0!==r[i]?o[s[i].key]=100-100/(1+a[i]/r[i]):o[s[i].key]=0;const l=t[n-(e-1)],c=t[n-e]??l,h=l.close-c.close;h>0?a[i]-=h:r[i]-=Math.abs(h)}}),o})}};function ut(t,e,i){let s=0,a=0;for(a=t.length-1;s!==a;){const r=Math.floor((a+s)/2),n=a-s,o=t[r][e];if(i===t[s][e])return s;if(i===t[a][e])return a;if(i===o)return r;if(i>o?s=r:a=r,n<=2)break}return s}function gt(t,e){e=Math.max(0,e??0);const i=Math.pow(10,e);return Math.round(t*i)/i}function pt(t,e,i){const s=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],a=t.length;let r=0;for(;r<a;){const a=t[r];s[0]=Math.max(a[e]??Number.MIN_SAFE_INTEGER,s[0]),s[1]=Math.min(a[i]??Number.MAX_SAFE_INTEGER,s[1]),++r}return s}function mt(t){return 0===t?0:Math.log10(t)}function yt(t){return Math.pow(10,t)}const xt={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,s=[];return t.forEach((e,a)=>{const r={},n=e.close;if(a>=i[0]-1){const e=pt(t.slice(a-(i[0]-1),a+1),"high","low"),o=e[0],l=e[1],c=o-l,h=(n-l)/(0===c?1:c)*100;r.k=((i[1]-1)*(s[a-1]?.k??50)+h)/i[1],r.d=((i[2]-1)*(s[a-1]?.d??50)+r.k)/i[2],r.j=3*r.k-2*r.d}s.push(r)}),s}},ft={name:"SAR",shortName:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:({data:t,indicator:e,defaultStyles:i})=>{const{current:s}=t;return{color:(s?.sar??Number.MIN_SAFE_INTEGER)<((s?.high??0)+(s?.low??0))/2?_(e.styles,"circles[0].upColor",i.circles[0].upColor):_(e.styles,"circles[0].downColor",i.circles[0].downColor)}}}],calc:(t,e)=>{const i=e.calcParams,s=i[0]/100,a=i[1]/100,r=i[2]/100;let n=s,o=-100,l=!1,c=0;return t.map((e,i)=>{const h=c,d=e.high,u=e.low;if(l){(-100===o||o<d)&&(o=d,n=Math.min(n+a,r)),c=h+n*(o-h);const g=Math.min(t[Math.max(1,i)-1].low,u);c>e.low?(c=o,n=s,o=-100,l=!l):c>g&&(c=g)}else{(-100===o||o>u)&&(o=u,n=Math.min(n+a,r)),c=h+n*(o-h);const s=Math.max(t[Math.max(1,i)-1].high,d);c<e.high?(c=o,n=0,o=-100,l=!l):c<s&&(c=s)}return{high:d,low:u,sar:c}})}};function _t(){return{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:({data:t,indicator:e,defaultStyles:i})=>{const s=t.current;let a=_(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor);return o(s)&&(s.close>s.open?a=_(e.styles,"bars[0].upColor",i.bars[0].upColor):s.close<s.open&&(a=_(e.styles,"bars[0].downColor",i.bars[0].downColor))),{color:a}}}}const vt={name:"VOL",shortName:"VOL",series:"volume",calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},_t()],regenerateFigures:t=>{const e=t.map((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"}));return e.push(_t()),e},calc:(t,e)=>{const{calcParams:i,figures:s}=e,a=[];return t.map((e,r)=>{const n=e.volume??0,o={volume:n,open:e.open,close:e.close};return i.forEach((e,i)=>{a[i]=(a[i]??0)+n,r>=e-1&&(o[s[i].key]=a[i]/e,a[i]-=t[r-(e-1)].volume??0)}),o})}},bt={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:t=>t.map((t,e)=>({key:`wr${e+1}`,title:`WR${e+1}: `,type:"line"})),calc:(t,e)=>{const{calcParams:i,figures:s}=e;return t.map((e,a)=>{const r={},n=e.close;return i.forEach((e,i)=>{const o=e-1;if(a>=o){const e=pt(t.slice(a-o,a+1),"high","low"),l=e[0],c=l-e[1];r[s[i].key]=0===c?0:(n-l)/c*100}}),r})}},Et={},Ct=[{name:"AVP",shortName:"AVP",series:"price",precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:t=>{let e=0,i=0;return t.map(t=>{const s={},a=t.turnover??0,r=t.volume??0;return e+=a,i+=r,0!==i&&(s.avp=e/i),s})}},st,{name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:t=>t.map((t,e)=>({key:`bias${e+1}`,title:`BIAS${t}: `,type:"line"})),calc:(t,e)=>{const{calcParams:i,figures:s}=e,a=[];return t.map((e,r)=>{const n={},o=e.close;return i.forEach((e,l)=>{if(a[l]=(a[l]??0)+o,r>=e-1){const c=a[l]/i[l];n[s[l].key]=(o-c)/c*100,a[l]-=t[r-(e-1)].close}}),n})}},at,{name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let s=0,a=0,r=0,n=0;return t.map((e,o)=>{const l={},c=e.high,h=e.low,d=e.open,u=(t[o-1]??e).close;if(r+=c-d,n+=d-h,s+=c-u,a+=u-h,o>=i[0]-1){l.ar=0!==n?r/n*100:0,l.br=0!==a?s/a*100:0;const e=t[o-(i[0]-1)],c=e.high,h=e.low,d=e.open,u=(t[o-i[0]]??t[o-(i[0]-1)]).close;s-=c-u,a-=u-h,r-=c-d,n-=d-h}return l})}},rt,nt,ot,lt,ct,{name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let s=0;const a=[];return t.map((e,r)=>{const n={};if(r>0){const o=t[r-1],l=e.high,c=e.low,h=e.volume??0,d=(l+c)/2-(o.high+o.low)/2;if(0===h||l-c===0)n.emv=0;else{const t=h/1e8/(l-c);n.emv=d/t}s+=n.emv,a.push(n.emv),r>=i[0]&&(n.maEmv=s/i[0],s-=a[r-i[0]])}return n})}},{name:"EMA",shortName:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:t=>t.map((t,e)=>({key:`ema${e+1}`,title:`EMA${t}: `,type:"line"})),calc:(t,e)=>{const{calcParams:i,figures:s}=e;let a=0;const r=[];return t.map((t,e)=>{const n={},o=t.close;return a+=o,i.forEach((t,i)=>{e>=t-1&&(r[i]=e>t-1?(2*o+(t-1)*r[i])/(t+1):a/t,n[s[i].key]=r[i])}),n})}},{name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let s=0;const a=[];return t.forEach((e,r)=>{const n={};if(r>=i[0]){const o=e.close,l=t[r-i[0]].close;n.mtm=o-l,s+=n.mtm,r>=i[0]+i[1]-1&&(n.maMtm=s/i[1],s-=a[r-(i[1]-1)].mtm??0)}a.push(n)}),a}},{name:"MA",shortName:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA30: ",type:"line"},{key:"ma4",title:"MA60: ",type:"line"}],regenerateFigures:t=>t.map((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"})),calc:(t,e)=>{const{calcParams:i,figures:s}=e,a=[];return t.map((e,r)=>{const n={},o=e.close;return i.forEach((e,i)=>{a[i]=(a[i]??0)+o,r>=e-1&&(n[s[i].key]=a[i]/e,a[i]-=t[r-(e-1)].close)}),n})}},ht,{name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let s=0,a=0;const r=[];return t.forEach((e,n)=>{const o=t[n-1]??e;e.close<o.close?a-=e.volume??0:e.close>o.close&&(a+=e.volume??0);const l={obv:a};s+=a,n>=i[0]-1&&(l.maObv=s/i[0],s-=r[n-(i[0]-1)].obv??0),r.push(l)}),r}},{name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:t=>{let e=0;return t.map((i,s)=>{const a={},r=i.close,n=i.volume??1,o=(t[s-1]??i).close;let l=0;const c=o*n;return 0!==c&&(l=(r-o)/c),e+=l,a.pvt=e,a})}},{name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let s=0,a=0;const r=[],n=[];return t.forEach((e,o)=>{const l={},c=(t[o-1]??e).close,h=e.close-c>0?1:0;r.push(h),s+=h,o>=i[0]-1&&(l.psy=s/i[0]*100,a+=l.psy,o>=i[0]+i[1]-2&&(l.maPsy=a/i[1],a-=n[o-(i[1]-1)].psy??0),s-=r[o-(i[0]-1)]),n.push(l)}),n}},{name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,s=[];let a=0;return t.forEach((e,r)=>{const n={};if(r>=i[0]-1){const o=e.close,l=(t[r-i[0]]??t[r-(i[0]-1)]).close;n.roc=0!==l?(o-l)/l*100:0,a+=n.roc,r>=i[0]-1+i[1]-1&&(n.maRoc=a/i[1],a-=s[r-(i[1]-1)].roc??0)}s.push(n)}),s}},dt,{name:"SMA",shortName:"SMA",series:"price",calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(t,e)=>{const i=e.calcParams;let s=0,a=0;return t.map((t,e)=>{const r={},n=t.close;return s+=n,e>=i[0]-1&&(a=e>i[0]-1?(n*i[1]+a*(i[0]-i[1]+1))/(i[0]+1):s/i[0],r.sma=a),r})}},xt,ft,{name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let s=0,a=0,r=0,n=0,o=0,l=0,c=0;const h=[];return t.forEach((t,e)=>{const d={},u=t.close;if(s+=u,e>=i[0]-1&&(a=e>i[0]-1?(2*u+(i[0]-1)*a)/(i[0]+1):s/i[0],o+=a,e>=2*i[0]-2&&(r=e>2*i[0]-2?(2*a+(i[0]-1)*r)/(i[0]+1):o/i[0],l+=r,e>=3*i[0]-3))){let t=0,s=0;e>3*i[0]-3?(t=(2*r+(i[0]-1)*n)/(i[0]+1),s=(t-n)/n*100):t=l/i[0],n=t,d.trix=s,c+=s,e>=3*i[0]+i[1]-4&&(d.maTrix=c/i[1],c-=h[e-(i[1]-1)].trix??0)}h.push(d)}),h}},vt,{name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let s=0,a=0,r=0,n=0;const o=[];return t.forEach((e,l)=>{const c={},h=e.close,d=(t[l-1]??e).close,u=e.volume??0;if(h>d?s+=u:h<d?a+=u:r+=u,l>=i[0]-1){const e=r/2;c.vr=a+e===0?0:(s+e)/(a+e)*100,n+=c.vr,l>=i[0]+i[1]-2&&(c.maVr=n/i[1],n-=o[l-(i[1]-1)].vr??0);const h=t[l-(i[0]-1)],d=t[l-i[0]]??h,u=h.close,g=h.volume??0;u>d.close?s-=g:u<d.close?a-=g:r-=g}o.push(c)}),o}},bt];function wt(t){return Et[t]??null}Ct.forEach(t=>{Et[t.name]=it.extend(t)});const Pt={"zh-CN":{time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量：",turnover:"成交额：",change:"涨幅：",second:"秒",minute:"",hour:"小时",day:"天",week:"周",month:"月",year:"年"},"en-US":{time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: ",second:"S",minute:"",hour:"H",day:"D",week:"W",month:"M",year:"Y"}};function St(t,e){return Pt[e][t]??t}function It(t,e){const i=e?.ignoreEvent??!1;return l(i)?!i:!i.includes(t)}const Dt="overlay_figure_";class Tt{id;groupId="";paneId;name;totalStep=1;currentStep=1;lock=!1;visible=!0;zLevel=0;needDefaultPointFigure=!1;needDefaultXAxisFigure=!1;needDefaultYAxisFigure=!1;mode="normal";modeSensitivity=8;points=[];extendData;styles=null;createPointFigures=null;createXAxisFigures=null;createYAxisFigures=null;performEventPressedMove=null;performEventMoveForDrawing=null;onDrawStart=null;onDrawing=null;onDrawEnd=null;onClick=null;onDoubleClick=null;onRightClick=null;onPressedMoveStart=null;onPressedMoving=null;onPressedMoveEnd=null;onMouseMove=null;onMouseEnter=null;onMouseLeave=null;onRemoved=null;onSelected=null;onDeselected=null;_prevZLevel=0;_prevOverlay;_prevPressedPoint=null;_prevPressedPoints=[];constructor(t){this.override(t)}override(t){this._prevOverlay=i({...this,_prevOverlay:null});const{id:r,name:n,currentStep:l,points:h,styles:d,...u}=t;if(e(this,u),c(this.name)||(this.name=n??""),!c(this.id)&&c(r)&&(this.id=r),o(d)&&(this.styles??={},e(this.styles,d)),s(h)&&h.length>0){let t=0;if(this.points=[...h],h.length>=this.totalStep-1?(this.currentStep=-1,t=this.totalStep-1):(this.currentStep=h.length+1,t=h.length),a(this.performEventMoveForDrawing))for(let e=0;e<t;e++)this.performEventMoveForDrawing({currentStep:e+2,mode:this.mode,points:this.points,performPointIndex:e,performPoint:this.points[e]});-1===this.currentStep&&this.performEventPressedMove?.({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]})}}getPrevZLevel(){return this._prevZLevel}setPrevZLevel(t){this._prevZLevel=t}shouldUpdate(){const t=this._prevOverlay.zLevel!==this.zLevel;return{sort:t,draw:t||JSON.stringify(this._prevOverlay.points)!==JSON.stringify(this.points)||this._prevOverlay.visible!==this.visible||this._prevOverlay.extendData!==this.extendData||this._prevOverlay.styles!==this.styles}}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=-1:this.currentStep++}forceComplete(){this.currentStep=-1}isDrawing(){return-1!==this.currentStep}isStart(){return 1===this.currentStep}eventMoveForDrawing(t){const e=this.currentStep-1,i={};n(t.timestamp)&&(i.timestamp=t.timestamp),n(t.dataIndex)&&(i.dataIndex=t.dataIndex),n(t.value)&&(i.value=t.value),this.points[e]=i,this.performEventMoveForDrawing?.({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:e,performPoint:i})}eventPressedPointMove(t,e){this.points[e].timestamp=t.timestamp,n(t.value)&&(this.points[e].value=t.value),this.performEventPressedMove?.({currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:e,performPoint:this.points[e]})}startPressedMove(t){this._prevPressedPoint={...t},this._prevPressedPoints=i(this.points)}eventPressedOtherMove(t,e){if(null!==this._prevPressedPoint){let i=null;n(t.dataIndex)&&n(this._prevPressedPoint.dataIndex)&&(i=t.dataIndex-this._prevPressedPoint.dataIndex);let s=null;n(t.value)&&n(this._prevPressedPoint.value)&&(s=t.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(t=>{n(t.timestamp)&&(t.dataIndex=e.timestampToDataIndex(t.timestamp));const a={...t};return n(i)&&n(t.dataIndex)&&(a.dataIndex=t.dataIndex+i,a.timestamp=e.dataIndexToTimestamp(a.dataIndex)??void 0),n(s)&&n(t.value)&&(a.value=t.value+s),a})}}static extend(t){return class extends Tt{constructor(){super(t)}}}}const Mt={PRICE:2,VOLUME:0},Ft={name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:t,coordinates:e,bounding:i,overlay:s,yAxis:a})=>{const r=s.points;if(e.length>0){let o=0;if(a?.isInCandle()??1)o=t.getSymbol()?.pricePrecision??Mt.PRICE;else{t.getIndicators({paneId:s.paneId}).forEach(t=>{o=Math.max(o,t.precision)})}const l=[],c=[],h=0,d=i.width;if(e.length>1&&n(r[0].value)&&n(r[1].value)){const i=[1,.786,.618,.5,.382,.236,0],s=e[0].y-e[1].y,a=r[0].value-r[1].value;i.forEach(i=>{const n=e[1].y+s*i,u=t.getDecimalFold().format(t.getThousandsSeparator().format(((r[1].value??0)+a*i).toFixed(o)));l.push({coordinates:[{x:h,y:n},{x:d,y:n}]}),c.push({x:h,y:n,text:`${u} (${(100*i).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:l},{type:"text",isCheckEvent:!1,attrs:c}]}return[]}},At={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{const i={x:0,y:t[0].y};return o(t[1])&&t[0].x<t[1].x&&(i.x=e.width),[{type:"line",attrs:{coordinates:[t[0],i]}}]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].value=e.value,t[1].value=e.value},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}};function kt(t,e,i){const s=i??0,a=[];if(t.length>1)if(t[0].x===t[1].x){const i=0,r=e.height;if(a.push({coordinates:[{x:t[0].x,y:i},{x:t[0].x,y:r}]}),t.length>2){a.push({coordinates:[{x:t[2].x,y:i},{x:t[2].x,y:r}]});const e=t[0].x-t[2].x;for(let n=0;n<s;n++){const s=e*(n+1);a.push({coordinates:[{x:t[0].x+s,y:i},{x:t[0].x+s,y:r}]})}}}else{const i=0,r=e.width,n=N(t[0],t[1]),o=n[0],l=n[1];if(a.push({coordinates:[{x:i,y:i*o+l},{x:r,y:r*o+l}]}),t.length>2){const e=t[2].y-o*t[2].x;a.push({coordinates:[{x:i,y:i*o+e},{x:r,y:r*o+e}]});const n=l-e;for(let t=0;t<s;t++){const e=l+n*(t+1);a.push({coordinates:[{x:i,y:i*o+e},{x:r,y:r*o+e}]})}}}return a}const Bt={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:kt(t,e)}]},Rt={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:kt(t,e,1)}]},Lt={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:t,coordinates:e,bounding:i,overlay:s,yAxis:a})=>{let r=0;if(a?.isInCandle()??1)r=t.getSymbol()?.pricePrecision??Mt.PRICE;else{t.getIndicators({paneId:s.paneId}).forEach(t=>{r=Math.max(r,t.precision)})}const{value:n=0}=s.points[0];return[{type:"line",attrs:{coordinates:[e[0],{x:i.width,y:e[0].y}]}},{type:"text",ignoreEvent:!0,attrs:{x:e[0].x,y:e[0].y,text:t.getDecimalFold().format(t.getThousandsSeparator().format(n.toFixed(r))),baseline:"bottom"}}]}};function Ot(t,e){if(t.length>1){let i={x:0,y:0};return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[0].y<t[1].y?{x:t[0].x,y:e.height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:Y(t[0],t[1],{x:0,y:t[0].y})}:{x:e.width,y:Y(t[0],t[1],{x:e.width,y:t[0].y})},{coordinates:[t[0],i]}}return[]}const Wt={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:Ot(t,e)}]},Yt={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>2===t.length?t[0].x===t[1].x?[{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:Y(t[0],t[1],{x:0,y:t[0].y})},{x:e.width,y:Y(t[0],t[1],{x:e.width,y:t[0].y})}]}}]:[]},Nt={name:"simpleAnnotation",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({overlay:t,coordinates:e})=>{let i="";o(t.extendData)&&(i=a(t.extendData)?t.extendData(t):t.extendData??"");const s=e[0].x,r=e[0].y-6,n=r-50,l=n-5;return[{type:"line",attrs:{coordinates:[{x:s,y:r},{x:s,y:n}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:s,y:n},{x:s-4,y:l},{x:s+4,y:l}]},ignoreEvent:!0},{type:"text",attrs:{x:s,y:l,text:i,align:"center",baseline:"bottom"},ignoreEvent:!0}]}},zt={name:"simpleTag",totalStep:2,styles:{line:{style:"dashed"}},createPointFigures:({bounding:t,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:t.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({chart:t,overlay:e,coordinates:i,bounding:s,yAxis:r})=>{let l="left",c=0;r?.isFromZero()??!1?(l="left",c=0):(l="right",c=s.width);let h="";return o(e.extendData)&&(h=a(e.extendData)?e.extendData(e):e.extendData??""),!o(h)&&n(e.points[0].value)&&(h=b(e.points[0].value,t.getSymbol()?.pricePrecision??Mt.PRICE)),{type:"text",attrs:{x:c,y:i[0].y,text:h,align:l,baseline:"middle"}}}};function Vt(t,e,i){return{x:(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i)+e.x,y:(t.x-e.x)*Math.sin(i)+(t.y-e.y)*Math.cos(i)+e.y}}const Xt={name:"arrow",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{if(t.length>1){const e=t[1].x>t[0].x?0:1,i=N(t[0],t[1]);let s;s=i?Math.atan(i[0])+Math.PI*e:t[1].y>t[0].y?Math.PI/2:Math.PI/2*3;const a=Vt({x:t[1].x-8,y:t[1].y+4},t[1],s),r=Vt({x:t[1].x-8,y:t[1].y-4},t[1],s);return[{type:"line",attrs:{coordinates:t}},{type:"line",ignoreEvent:!0,attrs:{coordinates:[a,t[1],r]}}]}return[]}};const Ht={name:"circle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{circle:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{if(t.length>1){const e=function(t,e){const i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return Math.sqrt(i*i+s*s)}(t[0],t[1]);return{type:"circle",attrs:{...t[0],r:e},styles:{style:"stroke_fill"}}}return[]}};const $t={name:"fibonacciCircle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{if(t.length>1){const e=function(t,e){const i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return Math.sqrt(i*i+s*s)}(t[0],t[1]),i=[],s=[];return[.236,.382,.5,.618,.786,1].forEach(a=>{const r=e*a;i.push({...t[0],r:r}),s.push({x:t[0].x,y:t[0].y+r+6,text:`${(100*a).toFixed(1)}%`})}),[{type:"circle",attrs:i,styles:{style:"stroke"}},{type:"text",ignoreEvent:!0,attrs:s}]}return[]}};function Gt(t,e,i){return{x:(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i)+e.x,y:(t.x-e.x)*Math.sin(i)+(t.y-e.y)*Math.cos(i)+e.y}}function Ut(t,e){if(t.length>1){let i;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[0].y<t[1].y?{x:t[0].x,y:e.height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:Y(t[0],t[1],{x:0,y:t[0].y})}:{x:e.width,y:Y(t[0],t[1],{x:e.width,y:t[0].y})},{coordinates:[t[0],i]}}return[]}const Zt={name:"fibonacciSpiral",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{if(t.length>1){const i=function(t,e){const i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return Math.sqrt(i*i+s*s)}(t[0],t[1])/Math.sqrt(24),s=t[1].x>t[0].x?0:1,a=N(t[0],t[1]);let r;r=a?Math.atan(a[0])+Math.PI*s:t[1].y>t[0].y?Math.PI/2:Math.PI/2*3;const n=Gt({x:t[0].x-i,y:t[0].y},t[0],r),o=Gt({x:t[0].x-i,y:t[0].y-i},t[0],r),l=[{...n,r:i,startAngle:r,endAngle:r+Math.PI/2},{...o,r:2*i,startAngle:r+Math.PI/2,endAngle:r+Math.PI}];let c=t[0].x-i,h=t[0].y-i;for(let e=2;e<9;e++){const i=l[e-2].r+l[e-1].r;let s=0;switch(e%4){case 0:s=r,c-=l[e-2].r;break;case 1:s=r+Math.PI/2,h-=l[e-2].r;break;case 2:s=r+Math.PI,c+=l[e-2].r;break;case 3:s=r+Math.PI/2*3,h+=l[e-2].r}const a=Gt({x:c,y:h},t[0],r);l.push({...a,r:i,startAngle:s,endAngle:s+Math.PI/2})}return[{type:"arc",attrs:l},{type:"line",attrs:Ut(t,e)}]}return[]}};function qt(t,e){if(t.length>1){let i;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[0].y<t[1].y?{x:t[0].x,y:e.height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:Y(t[0],t[1],{x:0,y:t[0].y})}:{x:e.width,y:Y(t[0],t[1],{x:e.width,y:t[0].y})},{coordinates:[t[0],i]}}return[]}const jt={name:"fibonacciSpeedResistanceFan",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{const i=[];let s=[];const a=[];if(t.length>1){const[r,n]=t,o=n.x>r.x?-38:4,l=n.y>r.y?-2:20,c=n.x-r.x,h=n.y-r.y;[1,.75,.618,.5,.382,.25,0].forEach(t=>{const d=n.x-c*t,u=n.y-h*t;i.push({coordinates:[{x:d,y:r.y},{x:d,y:n.y}]}),i.push({coordinates:[{x:r.x,y:u},{x:n.x,y:u}]}),s=s.concat(qt([r,{x:d,y:n.y}],e)),s=s.concat(qt([r,{x:n.x,y:u}],e)),a.unshift({x:r.x+o,y:u+10,text:`${t.toFixed(3)}`}),a.unshift({x:d-18,y:r.y+l,text:`${t.toFixed(3)}`})})}return[{type:"line",attrs:i},{type:"line",attrs:s},{type:"text",ignoreEvent:!0,attrs:a}]}},Qt={name:"fibonacciDiagonal",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,overlay:e})=>{const i=e.points;if(t.length>0){const e=[],s=[],a=t[0].x,r=t[t.length-1].x;if(t.length>1&&void 0!==i[0].value&&void 0!==i[1].value){const n=[1,.786,.618,.5,.382,.236,0],o=t[0].y-t[1].y,l=i[0].value-i[1].value;n.forEach(n=>{const c=t[1].y+o*n,h=((i[1].value??0)+l*n).toFixed(2);e.push({coordinates:[{x:a,y:c},{x:r,y:c}]}),s.push({x:a,y:c,text:`${h} (${(100*n).toFixed(1)}%)`,baseline:"bottom"})}),e.push({coordinates:[{x:e[0].coordinates[0].x,y:e[0].coordinates[0].y},{x:e[n.length-1].coordinates[1].x,y:e[n.length-1].coordinates[1].y}]})}return[{type:"line",attrs:e},{type:"text",isCheckEvent:!1,attrs:s}]}return[]}};function Jt(t,e){return{name:t,totalStep:e,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=t.map((t,e)=>({...t,text:`(${e})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:t}},{type:"text",ignoreEvent:!0,attrs:e}]}}}const Kt=Jt("threeWaves",5),te=Jt("fiveWaves",7),ee=Jt("eightWaves",10),ie=Jt("anyWaves",Number.MAX_SAFE_INTEGER),se={name:"measure",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{backgroundColor:"rgba(22, 119, 255, 0.25)",tipBackgroundColor:"#1677FF",lineColor:"#1677FF"},createPointFigures:({coordinates:t,overlay:e,bounding:i})=>{if(t.length>1){const[s,a]=t,r=e.points[1]?.value,n=e.points[0]?.value;let o=0,l=0;void 0!==n&&void 0!==r&&(o=(r-n)/n*100,l=r-n);const c=s.x<a.x,h=s.y<a.y,d={x:Math.round((s.x+a.x)/2),y:Math.round((s.y+a.y)/2)},u=e.styles?.backgroundColor??"rgba(22, 119, 255, 0.25)",g=e.styles?.tipBackgroundColor??"#1677FF",p=e.styles?.lineColor??"#1677FF",m=`${l.toFixed(2)} (${o.toFixed(2)}%)`,y=[{type:"polygon",attrs:{coordinates:[s,{x:a.x,y:s.y},a,{x:s.x,y:a.y}]},styles:{color:u}},{type:"line",attrs:{coordinates:[{x:s.x,y:d.y},{x:a.x,y:d.y}]},styles:{color:p}},{type:"line",attrs:{coordinates:[{x:d.x,y:s.y},{x:d.x,y:a.y}]},styles:{color:p}}];c?y.push({type:"line",attrs:{coordinates:[{x:a.x-6,y:d.y-4},{x:a.x,y:d.y},{x:a.x-6,y:d.y+4}]}}):y.push({type:"line",attrs:{coordinates:[{x:a.x+6,y:d.y-4},{x:a.x,y:d.y},{x:a.x+6,y:d.y+4}]}}),h?y.push({type:"line",attrs:{coordinates:[{x:d.x-4,y:a.y-6},{x:d.x,y:a.y},{x:d.x+4,y:a.y-6}]},styles:{color:p}}):y.push({type:"line",attrs:{coordinates:[{x:d.x-4,y:a.y+6},{x:d.x,y:a.y},{x:d.x+4,y:a.y+6}]},styles:{color:p}});const x=28;let f,_=T(m)+24;return f=h?a.y+8+x>i.height?i.height-x:a.y+8:a.y-8-x<0?0:a.y-8-x,y.push({type:"rect",attrs:{x:d.x-_/2,y:f,width:_,height:x},styles:{borderRadius:4,color:g}}),y.push({type:"text",attrs:{x:d.x,y:f+8,text:m,align:"center"},styles:{paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,backgroundColor:"none",family:"Space Grotesk, sans-serif"}}),y}return[]}},ae={};function re(t){ae[t.name]=Tt.extend(t)}[Ft,At,{name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=[];return 2===t.length&&e.push({coordinates:t}),[{type:"line",attrs:e}]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].value=e.value,t[1].value=e.value},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}},{name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:e.width,y:t[0].y}]}}]},Bt,Rt,Lt,Wt,{name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>2===t.length?[{type:"line",attrs:{coordinates:t}}]:[]},Yt,{name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{if(2===t.length){const i={x:t[0].x,y:0};return t[0].y<t[1].y&&(i.y=e.height),[{type:"line",attrs:{coordinates:[t[0],i]}}]}return[]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex,t[1].timestamp=e.timestamp,t[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex)}},{name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>2===t.length?[{type:"line",attrs:{coordinates:t}}]:[],performEventPressedMove:({points:t,performPoint:e})=>{t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex,t[1].timestamp=e.timestamp,t[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex)}},{name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]},Nt,zt,Xt,Ht,{name:"rect",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>t.length>1?[{type:"polygon",attrs:{coordinates:[t[0],{x:t[1].x,y:t[0].y},t[1],{x:t[0].x,y:t[1].y}]},styles:{style:"stroke_fill"}}]:[]},{name:"triangle",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>[{type:"polygon",attrs:{coordinates:t},styles:{style:"stroke_fill"}}]},{name:"parallelogram",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{if(2===t.length)return[{type:"line",ignoreEvent:!0,attrs:{coordinates:t}}];if(3===t.length){const e={x:t[0].x+t[2].x-t[1].x,y:t[0].y+t[2].y-t[1].y};return[{type:"polygon",attrs:{coordinates:[t[0],t[1],t[2],e]},styles:{style:"stroke_fill"}}]}return[]},performEventPressedMove:({points:t,performPointIndex:e,performPoint:i})=>{e<2&&(t[0].value=i.value,t[1].value=i.value)},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}},$t,{name:"fibonacciSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,overlay:e})=>{const i=[],s=[];if(t.length>1){const a=t[1].x>t[0].x?t[0].x:t[1].x,r=[1,.786,.618,.5,.382,.236,0],n=t[0].y-t[1].y,o=e.points,l=(o[0].value??0)-(o[1].value??0);r.forEach(e=>{const r=t[1].y+n*e,c=((o[1].value??0)+l*e).toFixed(2);i.push({coordinates:[{x:t[0].x,y:r},{x:t[1].x,y:r}]}),s.push({x:a,y:r,text:`${c} (${(100*e).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:i},{type:"text",ignoreEvent:!0,attrs:s}]}},{name:"fibonacciExtension",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,overlay:e})=>{const i=[],s=[];if(t.length>2){const a=e.points,r=(a[1].value??0)-(a[0].value??0),n=t[1].y-t[0].y,o=[0,.236,.382,.5,.618,.786,1],l=t[2].x>t[1].x?t[1].x:t[2].x;o.forEach(e=>{const o=t[2].y+n*e,c=((a[2].value??0)+r*e).toFixed(2);i.push({coordinates:[{x:t[1].x,y:o},{x:t[2].x,y:o}]}),s.push({x:l,y:o,text:`${c} (${(100*e).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:{coordinates:t},styles:{style:"dashed"}},{type:"line",attrs:i},{type:"text",ignoreEvent:!0,attrs:s}]}},Zt,jt,Qt,{name:"gannBox",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{if(t.length>1){const[e,i]=t,s=(i.y-e.y)/4,a=i.x-e.x,r=[{coordinates:[e,{x:i.x,y:i.y-s}]},{coordinates:[e,{x:i.x,y:i.y-2*s}]},{coordinates:[{x:e.x,y:i.y},{x:i.x,y:e.y+s}]},{coordinates:[{x:e.x,y:i.y},{x:i.x,y:e.y+2*s}]},{coordinates:[{...e},{x:e.x+.236*a,y:i.y}]},{coordinates:[{...e},{x:e.x+.5*a,y:i.y}]},{coordinates:[{x:e.x,y:i.y},{x:e.x+.236*a,y:e.y}]},{coordinates:[{x:e.x,y:i.y},{x:e.x+.5*a,y:e.y}]}],n=[{coordinates:[e,i]},{coordinates:[{x:e.x,y:i.y},{x:i.x,y:e.y}]}];return[{type:"line",attrs:[{coordinates:[e,{x:i.x,y:e.y}]},{coordinates:[{x:i.x,y:e.y},i]},{coordinates:[i,{x:e.x,y:i.y}]},{coordinates:[{x:e.x,y:i.y},e]}]},{type:"polygon",ignoreEvent:!0,attrs:{coordinates:[e,{x:i.x,y:e.y},i,{x:e.x,y:i.y}]},styles:{style:"fill"}},{type:"line",attrs:r,styles:{style:"dashed"}},{type:"line",attrs:n}]}return[]}},Kt,te,ee,ie,{name:"abcd",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=["A","B","C","D"],i=t.map((t,i)=>({...t,baseline:"bottom",text:`(${e[i]})`}));let s=[],a=[];return t.length>2&&(s=[t[0],t[2]],t.length>3&&(a=[t[1],t[3]])),[{type:"line",attrs:{coordinates:t}},{type:"line",attrs:[{coordinates:s},{coordinates:a}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:i}]}},{name:"xabcd",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{const e=[],i=[],s=["X","A","B","C","D"],a=t.map((t,e)=>({...t,baseline:"bottom",text:`(${s[e]})`}));return t.length>2&&(e.push({coordinates:[t[0],t[2]]}),i.push({coordinates:[t[0],t[1],t[2]]}),t.length>3&&(e.push({coordinates:[t[1],t[3]]}),t.length>4&&(e.push({coordinates:[t[2],t[4]]}),i.push({coordinates:[t[2],t[3],t[4]]})))),[{type:"line",attrs:{coordinates:t}},{type:"line",attrs:e,styles:{style:"dashed"}},{type:"polygon",ignoreEvent:!0,attrs:i},{type:"text",ignoreEvent:!0,attrs:a}]}},{name:"elliotTripleComboWaves",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=["(0)","(W)","(X)","(Y)","(Z)"],i=t.map((t,i)=>({...t,baseline:"bottom",text:`(${e[i]})`}));return[{type:"line",attrs:{coordinates:t}},{type:"line",attrs:[{coordinates:[]},{coordinates:[]}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:i}]}},{name:"headAndShoulders",totalStep:8,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{const e=[],i=[],s=["1","Left Shoulder","2","Head","3","Right Shoulder","4"],a=t.map((t,e)=>({...t,baseline:"bottom",text:`${s[e]}`}));return t.length>2&&(e.push({coordinates:[t[0],t[2]]}),i.push({coordinates:[t[0],t[1],t[2]]}),t.length>4&&(e.push({coordinates:[t[2],t[4]]}),i.push({coordinates:[t[2],t[3],t[4]]}),t.length>6&&(e.push({coordinates:[t[4],t[6]]}),i.push({coordinates:[t[4],t[5],t[6]]})))),[{type:"line",attrs:{coordinates:t}},{type:"line",attrs:e,styles:{style:"dashed"}},{type:"polygon",ignoreEvent:!0,attrs:i},{type:"text",ignoreEvent:!0,attrs:a}]}},se,{name:"crossLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:e.width,y:t[0].y}]}},{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]},{name:"faltTopBottom",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!1,styles:{polygon:{color:"#FCB9002b"},line:{size:2,color:"#FCB900"}},createPointFigures:({coordinates:t})=>{let e=[];const i=[],s=[];return t.length>2?(e=[{coordinates:[{x:t[0].x,y:t[2].y},{x:t[1].x,y:t[2].y}]}],i.push({coordinates:[t[0],t[1],{x:t[1].x,y:t[2].y},{x:t[0].x,y:t[2].y}]}),s.push({coordinates:[t[0],t[1]]})):e=[{coordinates:t}],[{type:"line",attrs:e,size:2},{type:"polygon",ignoreEvent:!0,attrs:i},{type:"line",attrs:s,size:2}]},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{3===t&&(e[1].timestamp=i.timestamp,e[1].dataIndex=i.dataIndex)},performEventPressedMove:({points:t,performPointIndex:e,performPoint:i})=>{switch(e){case 1:t[2].timestamp=i.timestamp,t[2].dataIndex=i.dataIndex;break;case 2:t[1].timestamp=i.timestamp,t[1].dataIndex=i.dataIndex;break;case 3:t[1].timestamp=i.timestamp}}},{name:"disJointChannel",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"#FCB9002b"},line:{size:2,color:"#FCB900"}},createPointFigures:({coordinates:t})=>{let e=[];const i=[];let s=0;return t.length>=2&&(s=Math.abs(t[1].y-t[0].y)),t.length>2?(e=[{coordinates:[{x:t[0].x,y:t[0].y},{x:t[1].x,y:t[1].y}]}],i.push({coordinates:[{x:t[1].x,y:t[2].y},{x:t[0].x,y:t[2].y+s}]})):e=[{coordinates:t}],[{type:"line",ignoreEvent:!1,attrs:e},{type:"line",ignoreEvent:!1,attrs:i}]},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{3===t&&(e[1].timestamp=i.timestamp,e[1].dataIndex=i.dataIndex)},performEventPressedMove:({points:t,performPointIndex:e,performPoint:i})=>{switch(e){case 1:t[2].timestamp=i.timestamp,t[2].dataIndex=i.dataIndex;break;case 2:t[1].timestamp=i.timestamp,t[1].dataIndex=i.dataIndex}}},{name:"arc",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{arc:{color:"rgba(22, 119, 255)"}},createPointFigures:({coordinates:t})=>{if(t.length>1){return[{type:"arc",attrs:{x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2,r:Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2))/2,startAngle:0,endAngle:Math.PI},styles:{style:"solid"}}]}return[]}},{name:"tradingPlan",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=t.length;if(e>=2){if(2===e)return[{type:"line",attrs:{coordinates:t}}];if(e>=3){const i={type:"polygon",attrs:{coordinates:[t[0],t[1],{x:t[1].x,y:t[2].y},{x:t[0].x,y:t[2].y}]},styles:{style:"fill",color:"#DE46464f"}};if(3===e)return[i];return[i,{type:"polygon",attrs:{coordinates:[t[0],t[1],{x:t[1].x,y:t[3].y},{x:t[0].x,y:t[3].y}]},styles:{style:"fill",color:"#03ca9b2f"}}]}}return[]},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{switch(t){case 2:e[0].value=i.value;break;case 3:e[1].timestamp=i.timestamp,e[1].dataIndex=i.dataIndex;break;case 4:e[1].timestamp=e[2].timestamp=i.timestamp,e[1].dataIndex=e[2].dataIndex=i.dataIndex}},performEventPressedMove:({points:t,performPointIndex:e,performPoint:i})=>{switch(e){case 0:t[1].value=i.value;break;case 1:t[0].value=i.value,t[2].timestamp=t[3].timestamp=i.timestamp,t[2].dataIndex=t[3].dataIndex=i.dataIndex;break;case 2:t[1].timestamp=t[3].timestamp=i.timestamp,t[1].dataIndex=t[3].dataIndex=i.dataIndex;break;case 3:t[1].timestamp=t[2].timestamp=i.timestamp,t[1].dataIndex=t[2].dataIndex=i.dataIndex}}}].forEach(t=>{ae[t.name]=Tt.extend(t)});const ne={light:{grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},title:{color:"#76808F"},legend:{color:"#76808F"}}},indicator:{tooltip:{title:{color:"#76808F"},legend:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},dark:{grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},title:{color:"#929AA5"},legend:{color:"#929AA5"}}},indicator:{tooltip:{title:{color:"#929AA5"},legend:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}}};function oe(t){return ne[t]??null}class le{name;scrollZoomEnabled=!0;createTicks;_parent;_range={from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0,displayFrom:0,displayTo:0,displayRange:0};_prevRange={from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0,displayFrom:0,displayTo:0,displayRange:0};_ticks=[];_autoCalcTickFlag=!0;constructor(t){this._parent=t}getParent(){return this._parent}buildTicks(t){return this._autoCalcTickFlag&&(this._range=this.createRangeImp()),!(this._prevRange.from===this._range.from&&this._prevRange.to===this._range.to&&!t)&&(this._prevRange=this._range,this._ticks=this.createTicksImp(),!0)}getTicks(){return this._ticks}setRange(t){this._autoCalcTickFlag=!1,this._range=t}getRange(){return this._range}setAutoCalcTickFlag(t){this._autoCalcTickFlag=t}getAutoCalcTickFlag(){return this._autoCalcTickFlag}}const ce={second:"HH:mm:ss",minute:"HH:mm",hour:"MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"},he={second:"HH:mm:ss",minute:"YYYY-MM-DD HH:mm",hour:"YYYY-MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"};class de extends le{constructor(t,e){super(t),this.override(e)}override(t){const{name:e,scrollZoomEnabled:i,createTicks:s}=t;c(this.name)||(this.name=e),this.scrollZoomEnabled=i??this.scrollZoomEnabled,this.createTicks=s??this.createTicks}createRangeImp(){const t=this.getParent().getChart().getChartStore().getVisibleRange(),{realFrom:e,realTo:i}=t,s=i-e+1;return{from:e,to:i,range:s,realFrom:e,realTo:i,realRange:s,displayFrom:e,displayTo:i,displayRange:s}}createTicksImp(){const{realFrom:t,realTo:e,from:i}=this.getRange(),s=this.getParent().getChart().getChartStore(),r=s.getInnerFormatter().formatDate,o=s.getPeriod(),l=[],c=s.getBarSpace().bar,h=s.getStyles().xAxis.tickText,d=Math.max(T("YYYY-MM-DD HH:mm:ss",h.size,h.weight,h.family),this.getBounding().width/8);let u=Math.ceil(d/c);u%2!=0&&(u+=1);for(let a=Math.max(0,Math.floor(t/u)*u);a<e;a+=u)if(a>=i){const t=s.dataIndexToTimestamp(a);n(t)&&l.push({coord:this.convertToPixel(a),value:t,text:r(t,ce[o?.type??"day"],"xAxis")})}return a(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:l}):l}getAutoSize(){const t=this.getParent().getChart().getStyles(),e=t.xAxis,i=e.size;if("auto"!==i)return i;const s=t.crosshair;let a=0;e.show&&(e.axisLine.show&&(a+=e.axisLine.size),e.tickLine.show&&(a+=e.tickLine.length),e.tickText.show&&(a+=e.tickText.marginStart+e.tickText.marginEnd+e.tickText.size));let r=0;return s.show&&s.vertical.show&&s.vertical.text.show&&(r+=s.vertical.text.paddingTop+s.vertical.text.paddingBottom+2*s.vertical.text.borderSize+s.vertical.text.size),Math.max(a,r)}getBounding(){return this.getParent().getMainWidget().getBounding()}convertTimestampFromPixel(t){const e=this.getParent().getChart().getChartStore(),i=e.coordinateToDataIndex(t);return e.dataIndexToTimestamp(i)}convertTimestampToPixel(t){const e=this.getParent().getChart().getChartStore(),i=e.timestampToDataIndex(t);return e.dataIndexToCoordinate(i)}convertFromPixel(t){return this.getParent().getChart().getChartStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().dataIndexToCoordinate(t)}static extend(t){return class extends de{constructor(e){super(e,t)}}}}const ue={normal:de.extend({name:"normal"})};const ge={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",X_AXIS:"x_axis_pane"};class pe extends le{reverse=!1;inside=!1;position="right";gap={top:.2,bottom:.1};createRange=t=>t.defaultRange;minSpan=t=>yt(-t);valueToRealValue=t=>t;realValueToDisplayValue=t=>t;displayValueToRealValue=t=>t;realValueToValue=t=>t;displayValueToText=(t,e)=>b(t,e);constructor(t,e){super(t),this.override(e)}override(t){const{name:i,gap:s,...a}=t;c(this.name)||(this.name=i),e(this.gap,s),e(this,a)}createRangeImp(){const t=this.getParent(),e=t.getChart(),i=e.getChartStore(),s=t.getId();let a=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,l=!1,c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER;const u=i.getIndicatorsByPaneId(s);u.forEach(t=>{l||=t.shouldOhlc,d=Math.min(d,t.precision),n(t.minValue)&&(c=Math.min(c,t.minValue)),n(t.maxValue)&&(h=Math.max(h,t.maxValue))});let g=4;const p=this.isInCandle();if(p){const t=i.getSymbol()?.pricePrecision??Mt.PRICE;g=d!==Number.MAX_SAFE_INTEGER?Math.min(d,t):t}else d!==Number.MAX_SAFE_INTEGER&&(g=d);const m=i.getVisibleRangeDataList(),y=e.getStyles().candle,x="area"===y.type,f=y.area.value,_=p&&!x||!p&&l;m.forEach(t=>{const e=t.dataIndex,i=t.data.current;if(o(i)&&(_&&(a=Math.min(a,i.low),r=Math.max(r,i.high)),p&&x)){const t=i[f];n(t)&&(a=Math.min(a,t),r=Math.max(r,t))}u.forEach(({result:t,figures:i})=>{const s=t[e]??{};i.forEach(t=>{const e=s[t.key];n(e)&&(a=Math.min(a,e),r=Math.max(r,e))})})}),a!==Number.MAX_SAFE_INTEGER&&r!==Number.MIN_SAFE_INTEGER?(a=Math.min(c,a),r=Math.max(h,r)):(a=0,r=10);const v=r-a,b={from:a,to:r,range:v,realFrom:a,realTo:r,realRange:v,displayFrom:a,displayTo:r,displayRange:v},E=this.createRange({chart:e,paneId:s,defaultRange:b});let C=E.realFrom,w=E.realTo,P=E.realRange;const S=this.minSpan(g);if(C===w||P<S){const t=c===C,e=h===w,i=4;C=t?C:e?C-8*S:C-i*S,w=e?w:t?w+8*S:w+i*S}const I=this.getBounding().height,{top:D,bottom:T}=this.gap;let M=D;M>=1&&(M/=I);let F=T;F>=1&&(F/=I),P=w-C,C-=P*F,w+=P*M;const A=this.realValueToValue(C,{range:E}),k=this.realValueToValue(w,{range:E}),B=this.realValueToDisplayValue(C,{range:E}),R=this.realValueToDisplayValue(w,{range:E});return{from:A,to:k,range:k-A,realFrom:C,realTo:w,realRange:w-C,displayFrom:B,displayTo:R,displayRange:R-B}}isInCandle(){return this.getParent().getId()===ge.CANDLE}isFromZero(){return"left"===this.position&&this.inside||"right"===this.position&&!this.inside}createTicksImp(){const t=this.getRange(),{displayFrom:e,displayTo:i,displayRange:s}=t,r=[];if(s>=0){const t=function(t){const e=Math.floor(mt(t)),i=yt(e),s=t/i;let a=0;return a=s<1.5?1:s<2.5?2:s<3.5?3:s<4.5?4:s<5.5?5:s<6.5?6:8,+(t=a*i).toFixed(Math.abs(e))}(s/8),a=function(t){const e=t.toString(),i=e.indexOf("e");if(i>0){const t=+e.slice(i+1);return t<0?-t:0}const s=e.indexOf(".");return s<0?0:e.length-1-s}(t),n=gt(Math.ceil(e/t)*t,a),o=gt(Math.floor(i/t)*t,a);let l=0,c=n;if(0!==t)for(;c<=o;){const e=c.toFixed(a);r[l]={text:e,coord:0,value:e},++l,c+=t}}const o=this.getParent(),l=o.getYAxisWidget()?.getBounding().height??0,c=o.getChart().getChartStore(),h=[],d=c.getIndicatorsByPaneId(o.getId()),u=c.getStyles();let g=0,p=!1;this.isInCandle()?g=c.getSymbol()?.pricePrecision??Mt.PRICE:d.forEach(t=>{g=Math.max(g,t.precision),p||=t.shouldFormatBigNumber});const m=c.getInnerFormatter(),y=c.getThousandsSeparator(),x=c.getDecimalFold(),f=u.xAxis.tickText.size;let _=NaN;return r.forEach(({value:e})=>{let i=this.displayValueToText(+e,g);const s=this.convertToPixel(this.realValueToValue(this.displayValueToRealValue(+e,{range:t}),{range:t}));p&&(i=m.formatBigNumber(e)),i=x.format(y.format(i));const a=n(_);s>f&&s<l-f&&(a&&Math.abs(_-s)>2*f||!a)&&(h.push({text:i,coord:s,value:e}),_=s)}),a(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:h}):h}getAutoSize(){const t=this.getParent(),e=t.getChart().getChartStore(),i=e.getStyles(),s=i.yAxis,a=s.size;if("auto"!==a)return a;let r=0;if(s.show&&(s.axisLine.show&&(r+=s.axisLine.size),s.tickLine.show&&(r+=s.tickLine.length),s.tickText.show)){let t=0;this.getTicks().forEach(e=>{t=Math.max(t,T(e.text,s.tickText.size,s.tickText.weight,s.tickText.family))}),r+=s.tickText.marginStart+s.tickText.marginEnd+t}const n=i.candle.priceMark,l=n.show&&n.last.show&&n.last.text.show;let c=0;const h=i.crosshair,d=h.show&&h.horizontal.show&&h.horizontal.text.show;let u=0;if(l||d){const s=e.getSymbol()?.pricePrecision??Mt.PRICE,a=this.getRange().displayTo;if(l){const t=e.getDataList(),i=t[t.length-1];if(o(i)){const{paddingLeft:t,paddingRight:a,size:r,family:o,weight:l}=n.last.text;c=t+T(b(i.close,s),r,l,o)+a;const h=e.getInnerFormatter().formatExtendText;n.last.extendTexts.forEach((t,e)=>{const s=h({type:"last_price",data:i,index:e});s.length>0&&t.show&&(c=Math.max(c,t.paddingLeft+T(s,t.size,t.weight,t.family)+t.paddingRight))})}}if(d){const r=e.getIndicatorsByPaneId(t.getId());let n=0,o=!1;r.forEach(t=>{n=Math.max(t.precision,n),o||=t.shouldFormatBigNumber});let l=2;if(this.isInCandle()){const t=i.indicator.lastValueMark;l=t.show&&t.text.show?Math.max(n,s):s}else l=n;let c=b(a,l);o&&(c=e.getInnerFormatter().formatBigNumber(c)),c=e.getDecimalFold().format(c),u+=h.horizontal.text.paddingLeft+h.horizontal.text.paddingRight+2*h.horizontal.text.borderSize+T(c,h.horizontal.text.size,h.horizontal.text.weight,h.horizontal.text.family)}}return Math.max(r,c,u)}getBounding(){return this.getParent().getYAxisWidget().getBounding()}convertFromPixel(t){const e=this.getBounding().height,i=this.getRange(),{realFrom:s,realRange:a}=i,r=(this.reverse?t/e:1-t/e)*a+s;return this.realValueToValue(r,{range:i})}convertToPixel(t){const e=this.getRange(),i=this.valueToRealValue(t,{range:e}),s=this.getParent().getYAxisWidget()?.getBounding().height??0,{realFrom:a,realRange:r}=e,n=(i-a)/r;return this.reverse?Math.round(n*s):Math.round((1-n)*s)}convertToNicePixel(t){const e=this.getParent().getYAxisWidget()?.getBounding().height??0,i=this.convertToPixel(t);return Math.round(Math.max(.05*e,Math.min(i,.98*e)))}static extend(t){return class extends pe{constructor(e){super(e,t)}}}}const me={name:"percentage",minSpan:()=>Math.pow(10,-2),displayValueToText:t=>`${b(t,2)}%`,valueToRealValue:(t,{range:e})=>(t-e.from)/e.range*e.realRange+e.realFrom,realValueToValue:(t,{range:e})=>(t-e.realFrom)/e.realRange*e.range+e.from,createRange:({chart:t,defaultRange:e})=>{const i=t.getDataList()[t.getVisibleRange().from];if(o(i)){const{from:t,to:s,range:a}=e,r=(e.from-i.close)/i.close*100,n=(e.to-i.close)/i.close*100,o=n-r;return{from:t,to:s,range:a,realFrom:r,realTo:n,realRange:o,displayFrom:r,displayTo:n,displayRange:o}}return e}},ye={name:"logarithm",minSpan:t=>.05*yt(-t),valueToRealValue:t=>t<0?-mt(Math.abs(t)):mt(t),realValueToDisplayValue:t=>t<0?-yt(Math.abs(t)):yt(t),displayValueToRealValue:t=>t<0?-mt(Math.abs(t)):mt(t),realValueToValue:t=>t<0?-yt(Math.abs(t)):yt(t),createRange:({defaultRange:t})=>{const{from:e,to:i,range:s}=t,a=e<0?-mt(Math.abs(e)):mt(e),r=i<0?-mt(Math.abs(i)):mt(i);return{from:e,to:i,range:s,realFrom:a,realTo:r,realRange:r-a,displayFrom:e,displayTo:i,displayRange:s}}},xe={normal:pe.extend({name:"normal"}),percentage:pe.extend(me),logarithm:pe.extend(ye)};function fe(t){const i={width:0,height:0,left:0,right:0,top:0,bottom:0};return o(t)&&e(i,t),i}function _e(t){return a(window.requestAnimationFrame)?window.requestAnimationFrame(t):window.setTimeout(t,20)}function ve(t){a(window.cancelAnimationFrame)?window.cancelAnimationFrame(t):window.clearTimeout(t)}class be{_options={duration:500,iterationCount:1};_doFrameCallback;_currentIterationCount=0;_running=!1;_time=0;constructor(t){e(this._options,t)}_loop(){this._running=!0;const t=()=>{if(this._running){const e=(new Date).getTime()-this._time;e<this._options.duration?(this._doFrameCallback?.(e),_e(t)):(this.stop(),this._currentIterationCount++,this._currentIterationCount<this._options.iterationCount&&this.start())}};_e(t)}doFrame(t){return this._doFrameCallback=t,this}setDuration(t){return this._options.duration=t,this}setIterationCount(t){return this._options.iterationCount=t,this}start(){this._running||(this._time=(new Date).getTime(),this._loop())}stop(){this._running&&this._doFrameCallback?.(this._options.duration),this._running=!1}}let Ee=1,Ce=(new Date).getTime();function we(t){const e=(new Date).getTime();return e===Ce?++Ee:Ee=1,Ce=e,`${t??""}${e}_${Ee}`}function Pe(t,e){const i=document.createElement(t),s=e??{};for(const t in s)i.style[t]=s[t]??"";return i}class Se{_holdingTasks=null;_running=!1;_callback;constructor(t){this._callback=t}add(t){this._running?o(this._holdingTasks)?this._holdingTasks={...this._holdingTasks,...t}:this._holdingTasks=t:this._runTask(t)}async _runTask(t){this._running=!0;try{await Promise.all(Object.values(t))}finally{if(this._running=!1,this._callback?.(),o(this._holdingTasks)){const t=this._holdingTasks;this._runTask(t),this._holdingTasks=null}}}clear(){this._holdingTasks=null}}class Ie{_callbacks=[];subscribe(t){this._callbacks.indexOf(t)<0&&this._callbacks.push(t)}unsubscribe(t){if(a(t)){const e=this._callbacks.indexOf(t);e>-1&&this._callbacks.splice(e,1)}else this._callbacks=[]}execute(t){this._callbacks.forEach(e=>{e(t)})}isEmpty(){return 0===this._callbacks.length}}const De=1,Te=50;class Me{_chart;_styles=function(){return{grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}},candle:g(),indicator:p(),xAxis:m(),yAxis:m(),separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:d(u.BLUE,.08)},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:u.GREY},text:{show:!0,style:"fill",color:u.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:u.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:u.GREY},features:[]},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:u.GREY},text:{show:!0,style:"fill",color:u.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:u.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:u.GREY}}},overlay:y()}}();_formatter={formatDate:({dateTimeFormat:t,timestamp:e,template:i})=>v(t,e,i),formatBigNumber:E,formatExtendText:t=>""};_innerFormatter={formatDate:(t,e,i)=>this._formatter.formatDate({dateTimeFormat:this._dateTimeFormat,timestamp:t,template:e,type:i}),formatBigNumber:t=>this._formatter.formatBigNumber(t),formatExtendText:t=>this._formatter.formatExtendText(t)};_locale="en-US";_thousandsSeparator={sign:",",format:t=>C(t,this._thousandsSeparator.sign)};_decimalFold={threshold:3,format:t=>w(t,this._decimalFold.threshold)};_symbol=null;_period=null;_dataList=[];_dataLoader=null;_loading=!1;_dataLoadMore={forward:!1,backward:!1};_dateTimeFormat;_zoomEnabled=!0;_zoomAnchor={main:"cursor",xAxis:"cursor"};_scrollEnabled=!0;_yScrolling=!0;_totalBarSpace=0;_barSpace=10;_gapBarSpace;_offsetRightDistance=80;_lastBarRightSideDiffBarCount;_startLastBarRightSideDiffBarCount=0;_scrollLimitRole="bar_count";_minVisibleBarCount={left:2,right:2};_maxOffsetDistance={left:50,right:50};_visibleRange={from:0,to:0,realFrom:0,realTo:0};_visibleRangeDataList=[];_visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}];_crosshair={};_actions=new Map;_indicators=new Map;_taskScheduler;_overlays=new Map;_progressOverlayInfo=null;_lastPriceMarkExtendTextUpdateTimers=[];_pressedOverlayInfo={paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null};_hoverOverlayInfo={paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null};_clickOverlayInfo={paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null};constructor(t,e){this._chart=t,this._calcOptimalBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace;const{styles:i,locale:s,timezone:a,formatter:r,thousandsSeparator:n,decimalFold:l,zoomAnchor:h}=e??{};o(i)&&this.setStyles(i),c(s)&&this.setLocale(s),this.setTimezone(a??""),o(r)&&this.setFormatter(r),o(n)&&this.setThousandsSeparator(n),o(l)&&this.setDecimalFold(l),o(h)&&this.setZoomAnchor(h),this._taskScheduler=new Se(()=>{this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})})}setStyles(t){let i=null;if(i=c(t)?oe(t):t,e(this._styles,i),s(i?.candle?.tooltip?.legend?.template)&&(this._styles.candle.tooltip.legend.template=i.candle.tooltip.legend.template),o(i?.candle?.priceMark?.last?.extendTexts)){this._clearLastPriceMarkExtendTextUpdateTimer();const t=[];this._styles.candle.priceMark.last.extendTexts.forEach(e=>{const i=e.updateInterval;if(e.show&&i>0&&!t.includes(i)){t.push(i);const e=setInterval(()=>{this._chart.updatePane(0,ge.CANDLE)},i);this._lastPriceMarkExtendTextUpdateTimers.push(e)}})}}getStyles(){return this._styles}setFormatter(t){e(this._formatter,t)}getFormatter(){return this._formatter}getInnerFormatter(){return this._innerFormatter}setLocale(t){this._locale=t}getLocale(){return this._locale}setTimezone(t){if(!o(this._dateTimeFormat)||this.getTimezone()!==t){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};t.length>0&&(e.timeZone=t);let i=null;try{i=new Intl.DateTimeFormat("en",e)}catch(t){}null!==i&&(this._dateTimeFormat=i)}}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getDateTimeFormat(){return this._dateTimeFormat}setThousandsSeparator(t){e(this._thousandsSeparator,t)}getThousandsSeparator(){return this._thousandsSeparator}setDecimalFold(t){e(this._decimalFold,t)}getDecimalFold(){return this._decimalFold}setSymbol(t){this.resetData(()=>{this._symbol={pricePrecision:Mt.PRICE,volumePrecision:Mt.VOLUME,...this._symbol,...t},this._synchronizeIndicatorSeriesPrecision()})}getSymbol(){return this._symbol}setPeriod(t){this.resetData(()=>{this._period=t})}getPeriod(){return this._period}getDataList(){return this._dataList}getVisibleRangeDataList(){return this._visibleRangeDataList}getVisibleRangeHighLowPrice(){return this._visibleRangeHighLowPrice}_addData(t,e,i){let a=!1,r=!1,n=0;if(s(t)){const s={backward:!1,forward:!1};switch(l(i)?(s.backward=i,s.forward=i):(s.backward=i?.backward??!1,s.forward=i?.forward??!1),n=t.length,e){case"init":this._clearData(),this._dataList=t,this._dataLoadMore.backward=s.backward,this._dataLoadMore.forward=s.forward,this.setOffsetRightDistance(this._offsetRightDistance),r=!0;break;case"backward":this._dataList=this._dataList.concat(t),this._dataLoadMore.backward=s.backward,this._lastBarRightSideDiffBarCount-=n,r=n>0;break;case"forward":this._dataList=t.concat(this._dataList),this._dataLoadMore.forward=s.forward,r=n>0}a=!0}else{const e=this._dataList.length,i=t.timestamp,s=_(this._dataList[e-1],"timestamp",0);if(i>s){this._dataList.push(t);let e=this.getLastBarRightSideDiffBarCount();e<0&&this.setLastBarRightSideDiffBarCount(--e),n=1,a=!0,r=!0}else i===s&&(this._dataList[e-1]=t,a=!0,r=!0)}if(a&&r){this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0});const t=this.getIndicatorsByFilter({});t.length>0?this._calcIndicator(t):this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:"init"!==e})}}setDataLoader(t){this.resetData(()=>{this._dataLoader=t})}_calcOptimalBarSpace(){const t=1-.2*Math.atan(Math.max(4,this._barSpace)-4)/(.5*Math.PI);let e=Math.min(Math.floor(this._barSpace*t),Math.floor(this._barSpace));e%2==0&&e+2>=this._barSpace&&--e,this._gapBarSpace=Math.max(1,e)}_adjustVisibleRange(){const t=this._dataList.length,e=this._totalBarSpace/this._barSpace;let i=0,s=0;"distance"===this._scrollLimitRole?(i=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,s=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(i=this._minVisibleBarCount.left,s=this._minVisibleBarCount.right),i=Math.max(0,i),s=Math.max(0,s);const a=e-Math.min(i,t);this._lastBarRightSideDiffBarCount>a&&(this._lastBarRightSideDiffBarCount=a);const r=-t+Math.min(s,t);this._lastBarRightSideDiffBarCount<r&&(this._lastBarRightSideDiffBarCount=r);let n=Math.round(this._lastBarRightSideDiffBarCount+t+.5);const l=n;n>t&&(n=t);let c=Math.round(n-e)-1;c<0&&(c=0);const h=this._lastBarRightSideDiffBarCount>0?Math.round(t+this._lastBarRightSideDiffBarCount-e)-1:c;this._visibleRange={from:c,to:n,realFrom:h,realTo:l},this.executeAction("onVisibleRangeChange",this._visibleRange),this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}];for(let t=h;t<l;t++){const e=this._dataList[t],i=this.dataIndexToCoordinate(t);this._visibleRangeDataList.push({dataIndex:t,x:i,data:{prev:this._dataList[t-1]??e,current:e,next:this._dataList[t+1]??e}}),o(e)&&(this._visibleRangeHighLowPrice[0].price<e.high&&(this._visibleRangeHighLowPrice[0].price=e.high,this._visibleRangeHighLowPrice[0].x=i),this._visibleRangeHighLowPrice[1].price>e.low&&(this._visibleRangeHighLowPrice[1].price=e.low,this._visibleRangeHighLowPrice[1].x=i))}0===c?this._dataLoadMore.forward&&this._processDataLoad("forward"):n===t&&this._dataLoadMore.backward&&this._processDataLoad("backward")}_processDataLoad(t){if(!this._loading&&o(this._dataLoader)&&o(this._symbol)&&o(this._period)){this._loading=!0;const e={type:t,symbol:this._symbol,period:this._period,timestamp:null,callback:(e,i)=>{this._loading=!1,this._addData(e,t,i),"init"===t&&this._dataLoader?.subscribeBar?.({symbol:this._symbol,period:this._period,callback:t=>{this._addData(t,"update")}})}};switch(t){case"backward":e.timestamp=this._dataList[this._dataList.length-1]?.timestamp??null;break;case"forward":e.timestamp=this._dataList[0]?.timestamp??null}this._dataLoader.getBars(e)}}_processDataUnsubscribe(){o(this._dataLoader)&&o(this._symbol)&&o(this._period)&&this._dataLoader.unsubscribeBar?.({symbol:this._symbol,period:this._period})}resetData(t){this._processDataUnsubscribe(),t?.(),this._loading=!1,this._processDataLoad("init")}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:Math.floor(this._gapBarSpace/2)}}setBarSpace(t,e){t<De||t>Te||this._barSpace===t||(this._barSpace=t,this._calcOptimalBarSpace(),e?.(),this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setYScrolling(t){this._yScrolling=t}getYScrolling(){return this._yScrolling}setTotalBarSpace(t){this._totalBarSpace!==t&&(this._totalBarSpace=t,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}))}setOffsetRightDistance(t,e){return this._offsetRightDistance="distance"===this._scrollLimitRole?Math.min(this._maxOffsetDistance.right,t):t,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,e&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0})),this}getInitialOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightDistance(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)}getLastBarRightSideDiffBarCount(){return this._lastBarRightSideDiffBarCount}setLastBarRightSideDiffBarCount(t){this._lastBarRightSideDiffBarCount=t}setMaxOffsetLeftDistance(t){this._scrollLimitRole="distance",this._maxOffsetDistance.left=t}setMaxOffsetRightDistance(t){this._scrollLimitRole="distance",this._maxOffsetDistance.right=t}setLeftMinVisibleBarCount(t){this._scrollLimitRole="bar_count",this._minVisibleBarCount.left=t}setRightMinVisibleBarCount(t){this._scrollLimitRole="bar_count",this._minVisibleBarCount.right=t}getVisibleRange(){return this._visibleRange}startScroll(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount}scroll(t){if(!this._scrollEnabled)return;const e=t/this._barSpace,i=this._lastBarRightSideDiffBarCount*this._barSpace;this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-e,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0});const s=Math.round(i-this._lastBarRightSideDiffBarCount*this._barSpace);0!==s&&this.executeAction("onScroll",{distance:s})}getDataByDataIndex(t){return this._dataList[t]??null}coordinateToFloatIndex(t){const e=this._dataList.length,i=(this._totalBarSpace-t)/this._barSpace,s=e+this._lastBarRightSideDiffBarCount-i;return Math.round(1e6*s)/1e6}dataIndexToTimestamp(t){const e=this._dataList.length;if(0===e)return null;const i=this.getDataByDataIndex(t);if(o(i))return i.timestamp;if(o(this._period)){const i=e-1;let s=null,a=0;if(t>i?(s=this._dataList[i].timestamp,a=t-i):t<0&&(s=this._dataList[0].timestamp,a=t),n(s)){const{type:t,span:e}=this._period;switch(t){case"second":return s+1e3*e*a;case"minute":return s+60*e*1e3*a;case"hour":return s+60*e*60*1e3*a;case"day":return s+24*e*60*60*1e3*a;case"week":return s+7*e*24*60*60*1e3*a;case"month":{const t=new Date(s),i=t.getDate();t.setDate(1),t.setMonth(t.getMonth()+e*a);const r=new Date(t.getFullYear(),t.getMonth()+1,0).getDate();return t.setDate(Math.min(i,r)),t.getTime()}case"year":{const t=new Date(s);return t.setFullYear(t.getFullYear()+e*a),t.getTime()}}}}return null}timestampToDataIndex(t){const e=this._dataList.length;if(0===e)return 0;if(o(this._period)){let i=null,s=0;const a=e-1,r=this._dataList[a].timestamp;t>r&&(i=r,s=a);const o=this._dataList[0].timestamp;if(t<o&&(i=o,s=0),n(i)){const{type:e,span:a}=this._period;switch(e){case"second":return s+Math.floor((t-i)/(1e3*a));case"minute":return s+Math.floor((t-i)/(60*a*1e3));case"hour":return s+Math.floor((t-i)/(60*a*60*1e3));case"day":return s+Math.floor((t-i)/(24*a*60*60*1e3));case"week":return s+Math.floor((t-i)/(7*a*24*60*60*1e3));case"month":{const e=new Date(i),r=new Date(t),n=e.getFullYear(),o=r.getFullYear(),l=e.getMonth(),c=r.getMonth();return s+Math.floor((12*(o-n)+(c-l))/a)}case"year":{const e=new Date(i).getFullYear(),r=new Date(t).getFullYear();return s+Math.floor((r-e)/a)}}}}return ut(this._dataList,"timestamp",t)}dataIndexToCoordinate(t){const e=this._dataList.length+this._lastBarRightSideDiffBarCount-t;return Math.floor(this._totalBarSpace-(e-.5)*this._barSpace+.5)}coordinateToDataIndex(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}zoom(t,e,i){if(!this._zoomEnabled)return;const s=e??{x:this._crosshair.x??this._totalBarSpace/2};"xAxis"===i?"last_bar"===this._zoomAnchor.xAxis&&(s.x=this.dataIndexToCoordinate(this._dataList.length-1)):"last_bar"===this._zoomAnchor.main&&(s.x=this.dataIndexToCoordinate(this._dataList.length-1));const a=s.x,r=this.coordinateToFloatIndex(a),n=this._barSpace,o=this._barSpace+t*(this._barSpace/10);this.setBarSpace(o,()=>{this._lastBarRightSideDiffBarCount+=r-this.coordinateToFloatIndex(a)});const l=this._barSpace/n;1!==l&&this.executeAction("onZoom",{scale:l})}setZoomEnabled(t){this._zoomEnabled=t}isZoomEnabled(){return this._zoomEnabled}setZoomAnchor(t){c(t)?(this._zoomAnchor.main=t,this._zoomAnchor.xAxis=t):(c(t.main)&&(this._zoomAnchor.main=t.main),c(t.xAxis)&&(this._zoomAnchor.xAxis=t.xAxis))}getZoomAnchor(){return{...this._zoomAnchor}}setScrollEnabled(t){this._scrollEnabled=t}isScrollEnabled(){return this._scrollEnabled}setCrosshair(t,e){const{notInvalidate:i,notExecuteAction:s,forceInvalidate:a}=e??{},r=t??{};let l=0,h=0;n(r.x)?(l=this.coordinateToDataIndex(r.x),h=l<0?0:l>this._dataList.length-1?this._dataList.length-1:l):(l=this._dataList.length-1,h=l);const d=this._dataList[h],u=this.dataIndexToCoordinate(l),g=this._crosshair.x,p=this._crosshair.y,m=this._crosshair.paneId;this._crosshair={...r,realX:u,kLineData:d,realDataIndex:l,dataIndex:h,timestamp:this.dataIndexToTimestamp(l)??void 0},(g!==r.x||p!==r.y||m!==r.paneId||a)&&(o(d)&&!s&&this.hasAction("onCrosshairChange")&&c(this._crosshair.paneId)&&this.executeAction("onCrosshairChange",t),i||this._chart.updatePane(1))}getCrosshair(){return this._crosshair}executeAction(t,e){this._actions.get(t)?.execute(e)}subscribeAction(t,e){this._actions.has(t)||this._actions.set(t,new Ie),this._actions.get(t)?.subscribe(e)}unsubscribeAction(t,e){const i=this._actions.get(t);o(i)&&(i.unsubscribe(e),i.isEmpty()&&this._actions.delete(t))}hasAction(t){const e=this._actions.get(t);return o(e)&&!e.isEmpty()}_sortIndicators(t){c(t)?this._indicators.get(t)?.sort((t,e)=>t.zLevel-e.zLevel):this._indicators.forEach(t=>{t.sort((t,e)=>t.zLevel-e.zLevel)})}_calcIndicator(t){let e=[];if(e=e.concat(t),e.length>0){const t={};e.forEach(e=>{t[e.id]=e.calcImp(this._dataList)}),this._taskScheduler.add(t)}}addIndicator(t,e,i){const{name:s}=t;if(this.getIndicatorsByFilter(t).length>0)return!1;let a=this.getIndicatorsByPaneId(e);const r=new(wt(s));return this._synchronizeIndicatorSeriesPrecision(r),r.paneId=e,r.override(t),i||(this.removeIndicator({paneId:e}),a=[]),a.push(r),this._indicators.set(e,a),this._sortIndicators(e),this._calcIndicator(r),!0}getIndicatorsByPaneId(t){return this._indicators.get(t)??[]}getIndicatorsByFilter(t){const{paneId:e,name:i,id:s}=t,a=t=>o(s)?t.id===s:!o(i)||t.name===i;let r=[];return o(e)?r=r.concat(this.getIndicatorsByPaneId(e).filter(a)):this._indicators.forEach(t=>{r=r.concat(t.filter(a))}),r}removeIndicator(t){let e=!1;return this.getIndicatorsByFilter(t).forEach(t=>{const i=this.getIndicatorsByPaneId(t.paneId),s=i.findIndex(e=>e.id===t.id);s>-1&&(i.splice(s,1),e=!0),0===i.length&&this._indicators.delete(t.paneId)}),e}hasIndicators(t){return this._indicators.has(t)}_synchronizeIndicatorSeriesPrecision(t){if(o(this._symbol)){const{pricePrecision:e=Mt.PRICE,volumePrecision:i=Mt.VOLUME}=this._symbol,s=t=>{switch(t.series){case"price":t.setSeriesPrecision(e);break;case"volume":t.setSeriesPrecision(i)}};o(t)?s(t):this._indicators.forEach(t=>{t.forEach(t=>{s(t)})})}}overrideIndicator(t){let e=!1,i=!1;return this.getIndicatorsByFilter(t).forEach(s=>{s.override(t);const{calc:a,draw:r,sort:n}=s.shouldUpdateImp();n&&(i=!0),a?this._calcIndicator(s):r&&(e=!0)}),i&&this._sortIndicators(),!!e&&(this._chart.layout({update:!0}),!0)}getOverlaysByFilter(t){const{id:e,groupId:i,paneId:s,name:a}=t,r=t=>o(e)?t.id===e:o(i)?t.groupId===i&&(!o(a)||t.name===a):!o(a)||t.name===a;let n=[];o(s)?n=n.concat(this.getOverlaysByPaneId(s).filter(r)):this._overlays.forEach(t=>{n=n.concat(t.filter(r))});const l=this._progressOverlayInfo?.overlay;return o(l)&&r(l)&&n.push(l),n}getOverlaysByPaneId(t){if(!c(t)){let t=[];return this._overlays.forEach(e=>{t=t.concat(e)}),t}return this._overlays.get(t)??[]}_sortOverlays(t){c(t)?this._overlays.get(t)?.sort((t,e)=>t.zLevel-e.zLevel):this._overlays.forEach(t=>{t.sort((t,e)=>t.zLevel-e.zLevel)})}addOverlays(t,e){const i=[],s=t.map((t,s)=>{if(o(t.id)){let e=null;for(const i of this._overlays){const s=i[1].find(e=>e.id===t.id);if(o(s)){e=s;break}}if(o(e))return t.id}const a=(r=t.name,ae[r]??null);var r;if(o(a)){const r=t.id??we("overlay_"),n=new a,o=t.paneId??ge.CANDLE;t.id=r,t.groupId??=r;const l=this.getOverlaysByPaneId(o).length;return t.zLevel??=l,n.override(t),i.includes(o)||i.push(o),n.isDrawing()?this._progressOverlayInfo={paneId:o,overlay:n,appointPaneFlag:e[s]}:(this._overlays.has(o)||this._overlays.set(o,[]),this._overlays.get(o)?.push(n)),n.isStart()&&n.onDrawStart?.({overlay:n,chart:this._chart}),r}return null});return i.length>0&&(this._sortOverlays(),i.forEach(t=>{this._chart.updatePane(1,t)}),this._chart.updatePane(1,ge.X_AXIS)),s}getProgressOverlayInfo(){return this._progressOverlayInfo}progressOverlayComplete(){if(null!==this._progressOverlayInfo){const{overlay:t,paneId:e}=this._progressOverlayInfo;t.isDrawing()||(this._overlays.has(e)||this._overlays.set(e,[]),this._overlays.get(e)?.push(t),this._sortOverlays(e),this._progressOverlayInfo=null)}}updateProgressOverlayInfo(t,e){null!==this._progressOverlayInfo&&(l(e)&&e&&(this._progressOverlayInfo.appointPaneFlag=e),this._progressOverlayInfo.paneId=t,this._progressOverlayInfo.overlay.override({paneId:t}))}overrideOverlay(t){let e=!1;const i=[];return this.getOverlaysByFilter(t).forEach(s=>{s.override(t);const{sort:a,draw:r}=s.shouldUpdate();a&&(e=!0),(a||r)&&(i.includes(s.paneId)||i.push(s.paneId))}),e&&this._sortOverlays(),i.length>0&&(i.forEach(t=>{this._chart.updatePane(1,t)}),this._chart.updatePane(1,ge.X_AXIS),!0)}removeOverlay(t){const e=[];return this.getOverlaysByFilter(t).forEach(t=>{const i=t.paneId,s=this.getOverlaysByPaneId(t.paneId);if(t.onRemoved?.({overlay:t,chart:this._chart}),e.includes(i)||e.push(i),t.isDrawing())this._progressOverlayInfo=null;else{const e=s.findIndex(e=>e.id===t.id);e>-1&&s.splice(e,1)}0===s.length&&this._overlays.delete(i)}),e.length>0&&(e.forEach(t=>{this._chart.updatePane(1,t)}),this._chart.updatePane(1,ge.X_AXIS),!0)}setPressedOverlayInfo(t){this._pressedOverlayInfo=t}getPressedOverlayInfo(){return this._pressedOverlayInfo}setHoverOverlayInfo(t,e,i){const{overlay:s,figureType:a,figureIndex:r,figure:n}=this._hoverOverlayInfo,o=t.overlay;if((s?.id!==o?.id||a!==t.figureType||r!==t.figureIndex)&&(this._hoverOverlayInfo=t,s?.id!==o?.id)){let a=!1,r=!1;null!==s&&(s.override({zLevel:s.getPrevZLevel()}),r=!0,i(s,n)&&(a=!0)),null!==o&&(o.setPrevZLevel(o.zLevel),o.override({zLevel:Number.MAX_SAFE_INTEGER}),r=!0,e(o,t.figure)&&(a=!0)),r&&this._sortOverlays(),a||this._chart.updatePane(1)}}getHoverOverlayInfo(){return this._hoverOverlayInfo}setClickOverlayInfo(t,e,i){const{paneId:s,overlay:a,figureType:r,figure:n,figureIndex:l}=this._clickOverlayInfo,c=t.overlay;a?.id===c?.id&&r===t.figureType&&l===t.figureIndex||(this._clickOverlayInfo=t,a?.id!==c?.id&&(o(a)&&i(a,n),o(c)&&e(c,t.figure),this._chart.updatePane(1,t.paneId),s!==t.paneId&&this._chart.updatePane(1,s),this._chart.updatePane(1,ge.X_AXIS)))}getClickOverlayInfo(){return this._clickOverlayInfo}isOverlayEmpty(){return 0===this._overlays.size&&null===this._progressOverlayInfo}isOverlayDrawing(){return this._progressOverlayInfo?.overlay.isDrawing()??!1}_clearLastPriceMarkExtendTextUpdateTimer(){this._lastPriceMarkExtendTextUpdateTimers.forEach(t=>{clearInterval(t)}),this._lastPriceMarkExtendTextUpdateTimers=[]}_clearData(){this._dataLoadMore.backward=!1,this._dataLoadMore.forward=!1,this._loading=!1,this._dataList=[],this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._visibleRange={from:0,to:0,realFrom:0,realTo:0},this._crosshair={}}getChart(){return this._chart}destroy(){this._clearData(),this._clearLastPriceMarkExtendTextUpdateTimer(),this._taskScheduler.clear(),this._overlays.clear(),this._indicators.clear(),this._actions.clear()}applyNewData(t,e){this._addData(t,"init",e)}applyMoreData(t,e){this._addData(t,"backward",e)}updateData(t){this._addData(t,"forward")}}const Fe="main",Ae="xAxis",ke="yAxis",Be="separator";class Re{_element;_resizeObserver;_mediaQueryList;_ctx;_listener;_supportedDevicePixelContentBox=!1;_width=0;_height=0;_pixelWidth=0;_pixelHeight=0;_nextPixelWidth=0;_nextPixelHeight=0;_requestAnimationId=-1;_mediaQueryListener=()=>{const t=I(this._element);this._nextPixelWidth=Math.round(this._element.clientWidth*t),this._nextPixelHeight=Math.round(this._element.clientHeight*t),this._resetPixelRatio()};constructor(t,e){this._listener=e,this._element=Pe("canvas",t),this._ctx=this._element.getContext("2d"),async function(){return await new Promise(t=>{const e=new ResizeObserver(i=>{t(i.every(t=>"devicePixelContentBoxSize"in t)),e.disconnect()});e.observe(document.body,{box:"device-pixel-content-box"})}).catch(()=>!1)}().then(t=>{this._supportedDevicePixelContentBox=t,t?(this._resizeObserver=new ResizeObserver(t=>{const e=t.find(t=>t.target===this._element),i=e?.devicePixelContentBoxSize[0];o(i)&&(this._nextPixelWidth=i.inlineSize,this._nextPixelHeight=i.blockSize,this._pixelWidth===this._nextPixelWidth&&this._pixelHeight===this._nextPixelHeight||this._resetPixelRatio())}),this._resizeObserver.observe(this._element,{box:"device-pixel-content-box"})):(this._mediaQueryList=window.matchMedia(`(resolution: ${I(this._element)}dppx)`),this._mediaQueryList.addListener(this._mediaQueryListener))}).catch(t=>!1)}_resetPixelRatio(){this._executeListener(()=>{const t=this._element.clientWidth,e=this._element.clientHeight;this._width=t,this._height=e,this._pixelWidth=this._nextPixelWidth,this._pixelHeight=this._nextPixelHeight,this._element.width=this._nextPixelWidth,this._element.height=this._nextPixelHeight;const i=this._nextPixelWidth/t,s=this._nextPixelHeight/e;this._ctx.scale(i,s)})}_executeListener(t){-1===this._requestAnimationId&&(this._requestAnimationId=_e(()=>{this._ctx.clearRect(0,0,this._width,this._height),t?.(),this._listener(),this._requestAnimationId=-1}))}update(t,e){if(this._width!==t||this._height!==e){if(this._element.style.width=`${t}px`,this._element.style.height=`${e}px`,!this._supportedDevicePixelContentBox){const i=I(this._element);this._nextPixelWidth=Math.round(t*i),this._nextPixelHeight=Math.round(e*i),this._resetPixelRatio()}}else this._executeListener()}getElement(){return this._element}getContext(){return this._ctx}destroy(){o(this._resizeObserver)&&this._resizeObserver.unobserve(this._element),o(this._mediaQueryList)&&this._mediaQueryList.removeListener(this._mediaQueryListener)}}class Le extends F{_rootContainer;_pane;_container;_bounding=fe();_cursor="crosshair";_forceCursor=null;constructor(t,e){super(),this._pane=e,this._rootContainer=t,this._container=this.createContainer(),t.appendChild(this._container)}setBounding(t){return e(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}checkEventOn(t){return!0}setCursor(t){c(this._forceCursor)||t!==this._cursor&&(this._cursor=t,this._container.style.cursor=this._cursor)}setForceCursor(t){t!==this._forceCursor&&(this._forceCursor=t,this._container.style.cursor=this._forceCursor??this._cursor)}getForceCursor(){return this._forceCursor}update(t){this.updateImp(this._container,this._bounding,t??3)}destroy(){this._rootContainer.removeChild(this._container)}}class Oe extends Le{_mainCanvas;_overlayCanvas;constructor(t,e){super(t,e),this._mainCanvas=new Re({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateMain(this._mainCanvas.getContext())}),this._overlayCanvas=new Re({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateOverlay(this._overlayCanvas.getContext())});const i=this.getContainer();i.appendChild(this._mainCanvas.getElement()),i.appendChild(this._overlayCanvas.getElement())}createContainer(){return Pe("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})}updateImp(t,e,i){const{width:s,height:a,left:r}=e;t.style.left=`${r}px`;let n=i;const o=t.clientWidth,l=t.clientHeight;switch(s===o&&a===l||(t.style.width=`${s}px`,t.style.height=`${a}px`,n=3),n){case 0:this._mainCanvas.update(s,a);break;case 1:this._overlayCanvas.update(s,a);break;case 3:case 4:this._mainCanvas.update(s,a),this._overlayCanvas.update(s,a)}}destroy(){this._mainCanvas.destroy(),this._overlayCanvas.destroy()}getImage(t){const{width:e,height:i}=this.getBounding(),s=Pe("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),a=s.getContext("2d"),r=I(s);return s.width=e*r,s.height=i*r,a.scale(r,r),a.drawImage(this._mainCanvas.getElement(),0,0,e,i),t&&a.drawImage(this._overlayCanvas.getElement(),0,0,e,i),s}}class We extends F{_widget;constructor(t){super(),this._widget=t}getWidget(){return this._widget}createFigure(t,e){const i=(s=t.name,tt[s]??null);var s;if(null!==i){const s=new i(t);if(o(e)){for(const t in e)e.hasOwnProperty(t)&&s.registerEvent(t,e[t]);this.addChild(s)}return s}return null}draw(t,...e){this.clear(),this.drawImp(t,e)}checkEventOn(t){return!0}}class Ye extends We{drawImp(t){const e=this.getWidget(),i=this.getWidget().getPane(),s=i.getChart(),a=e.getBounding(),r=s.getStyles().grid;if(r.show){t.save(),t.globalCompositeOperation="destination-over";const e=r.horizontal;if(e.show){const s=i.getAxisComponent().getTicks().map(t=>({coordinates:[{x:0,y:t.coord},{x:a.width,y:t.coord}]}));this.createFigure({name:"line",attrs:s,styles:e})?.draw(t)}const n=r.vertical;if(n.show){const e=s.getXAxisPane().getAxisComponent().getTicks().map(t=>({coordinates:[{x:t.coord,y:0},{x:t.coord,y:a.height}]}));this.createFigure({name:"line",attrs:e,styles:n})?.draw(t)}t.restore()}}}class Ne extends We{eachChildren(t){const e=this.getWidget().getPane().getChart().getChartStore(),i=e.getVisibleRangeDataList(),s=e.getBarSpace(),a=i.length;let r=0;for(;r<a;)t(i[r],s,r),++r}}class ze extends Ne{_boundCandleBarClickEvent=t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCandleBarClick",t),!1);drawImp(t){const e=this.getWidget().getPane(),i=e.getId()===ge.CANDLE,s=e.getChart().getChartStore(),a=this.getCandleBarOptions();if(null!==a){const{type:r,styles:n}=a;let l=0,c=0;if("ohlc"===a.type){const{gapBar:t}=s.getBarSpace();l=Math.min(Math.max(Math.round(.2*t),1),8),l>2&&l%2==1&&l--,c=Math.floor(l/2)}const h=e.getAxisComponent();this.eachChildren((e,s)=>{const{x:a,data:{current:d,prev:u}}=e;if(o(d)){const{open:o,high:g,low:p,close:m}=d,y="current_open"===n.compareRule?o:u?.close??m,x=[];m>y?(x[0]=n.upColor,x[1]=n.upBorderColor,x[2]=n.upWickColor):m<y?(x[0]=n.downColor,x[1]=n.downBorderColor,x[2]=n.downWickColor):(x[0]=n.noChangeColor,x[1]=n.noChangeBorderColor,x[2]=n.noChangeWickColor);const f=h.convertToPixel(o),_=h.convertToPixel(m),v=[f,_,h.convertToPixel(g),h.convertToPixel(p)];v.sort((t,e)=>t-e);const b=s.gapBar%2==0?1:0;let E=[];switch(r){case"candle_solid":E=this._createSolidBar(a,v,s,x,b);break;case"candle_stroke":E=this._createStrokeBar(a,v,s,x,b);break;case"candle_up_stroke":E=m>o?this._createStrokeBar(a,v,s,x,b):this._createSolidBar(a,v,s,x,b);break;case"candle_down_stroke":E=o>m?this._createStrokeBar(a,v,s,x,b):this._createSolidBar(a,v,s,x,b);break;case"ohlc":E=[{name:"rect",attrs:[{x:a-c,y:v[0],width:l,height:v[3]-v[0]},{x:a-s.halfGapBar,y:f+l>v[3]?v[3]-l:f,width:s.halfGapBar-c,height:l},{x:a+c,y:_+l>v[3]?v[3]-l:_,width:s.halfGapBar-c,height:l}],styles:{color:x[0]}}]}E.forEach(s=>{let a=null;i&&(a={mouseClickEvent:this._boundCandleBarClickEvent(e)}),this.createFigure(s,a??void 0)?.draw(t)})}})}}getCandleBarOptions(){const t=this.getWidget().getPane().getChart().getStyles().candle;return{type:t.type,styles:t.bar}}_createSolidBar(t,e,i,s,a){return[{name:"rect",attrs:{x:t,y:e[0],width:1,height:e[3]-e[0]},styles:{color:s[2]}},{name:"rect",attrs:{x:t-i.halfGapBar,y:e[1],width:i.gapBar+a,height:Math.max(1,e[2]-e[1])},styles:{style:"stroke_fill",color:s[0],borderColor:s[1]}}]}_createStrokeBar(t,e,i,s,a){return[{name:"rect",attrs:[{x:t,y:e[0],width:1,height:e[1]-e[0]},{x:t,y:e[2],width:1,height:e[3]-e[2]}],styles:{color:s[2]}},{name:"rect",attrs:{x:t-i.halfGapBar,y:e[1],width:i.gapBar+a,height:Math.max(1,e[2]-e[1])},styles:{style:"stroke",borderColor:s[1]}}]}}class Ve extends ze{getCandleBarOptions(){const t=this.getWidget().getPane();if(!t.getAxisComponent().isInCandle()){const e=t.getChart().getChartStore(),i=e.getIndicatorsByPaneId(t.getId());for(const t of i)if(t.shouldOhlc&&t.visible){const i=t.styles,s=e.getStyles().indicator,a=_(i,"ohlc.compareRule",s.ohlc.compareRule),r=_(i,"ohlc.upColor",s.ohlc.upColor),n=_(i,"ohlc.downColor",s.ohlc.downColor),o=_(i,"ohlc.noChangeColor",s.ohlc.noChangeColor);return{type:"ohlc",styles:{compareRule:a,upColor:r,downColor:n,noChangeColor:o,upBorderColor:r,downBorderColor:n,noChangeBorderColor:o,upWickColor:r,downWickColor:n,noChangeWickColor:o}}}}return null}drawImp(t){super.drawImp(t);const e=this.getWidget(),i=e.getPane(),s=i.getChart(),a=e.getBounding(),r=s.getXAxisPane().getAxisComponent(),l=i.getAxisComponent(),c=s.getChartStore(),h=c.getIndicatorsByPaneId(i.getId()),d=c.getStyles().indicator;t.save(),h.forEach(e=>{if(e.visible){e.zLevel<0?t.globalCompositeOperation="destination-over":t.globalCompositeOperation="source-over";let i=!1;if(null!==e.draw&&(t.save(),i=e.draw({ctx:t,chart:s,indicator:e,bounding:a,xAxis:r,yAxis:l}),t.restore()),!i){const i=e.result,s=[];this.eachChildren((c,h)=>{const{halfGapBar:u}=h,{dataIndex:g,x:p}=c,m=r.convertToPixel(g-1),y=r.convertToPixel(g+1),x=i[g-1]??null,f=i[g]??null,_=i[g+1]??null,v={x:m},b={x:p},E={x:y};e.figures.forEach(({key:t})=>{const e=x?.[t];n(e)&&(v[t]=l.convertToPixel(e));const i=f?.[t];n(i)&&(b[t]=l.convertToPixel(i));const s=_?.[t];n(s)&&(E[t]=l.convertToPixel(s))}),et(e,g,d,(e,i,c)=>{if(o(f?.[e.key])){const d=b[e.key];let g=e.attrs?.({data:{prev:x,current:f,next:_},coordinate:{prev:v,current:b,next:E},bounding:a,barSpace:h,xAxis:r,yAxis:l});if(!o(g))switch(e.type){case"circle":g={x:p,y:d,r:Math.max(1,u)};break;case"rect":case"bar":{const t=e.baseValue??l.getRange().from,i=l.convertToPixel(t);let s=Math.abs(i-d);t!==f?.[e.key]&&(s=Math.max(1,s));let a=0;a=d>i?i:d,g={x:p-u,y:a,width:Math.max(1,2*u),height:s};break}case"line":o(s[c])||(s[c]=[]),n(b[e.key])&&n(E[e.key])&&s[c].push({coordinates:[{x:b.x,y:b[e.key]},{x:E.x,y:E[e.key]}],styles:i})}const m=e.type;o(g)&&"line"!==m&&this.createFigure({name:"bar"===m?"rect":m,attrs:g,styles:i})?.draw(t)}})}),s.forEach(e=>{if(e.length>1){const i=[{coordinates:[e[0].coordinates[0],e[0].coordinates[1]],styles:e[0].styles}];for(let t=1;t<e.length;t++){const s=i[i.length-1],a=e[t],r=s.coordinates[s.coordinates.length-1];r.x===a.coordinates[0].x&&r.y===a.coordinates[0].y&&s.styles.style===a.styles.style&&s.styles.color===a.styles.color&&s.styles.size===a.styles.size&&s.styles.smooth===a.styles.smooth&&s.styles.dashedValue?.[0]===a.styles.dashedValue?.[0]&&s.styles.dashedValue?.[1]===a.styles.dashedValue?.[1]?s.coordinates.push(a.coordinates[1]):i.push({coordinates:[a.coordinates[0],a.coordinates[1]],styles:a.styles})}i.forEach(({coordinates:e,styles:i})=>{this.createFigure({name:"line",attrs:{coordinates:e},styles:i})?.draw(t)})}})}}}),t.restore()}}class Xe extends We{drawImp(t){const e=this.getWidget(),i=e.getPane(),s=e.getBounding(),a=e.getPane().getChart().getChartStore(),r=a.getCrosshair(),n=a.getStyles().crosshair;if(c(r.paneId)&&n.show){if(r.paneId===i.getId()){const e=r.y;this._drawLine(t,[{x:0,y:e},{x:s.width,y:e}],n.horizontal)}const e=r.realX;this._drawLine(t,[{x:e,y:0},{x:e,y:s.height}],n.vertical)}}_drawLine(t,e,i){if(i.show){const s=i.line;s.show&&this.createFigure({name:"line",attrs:{coordinates:e},styles:s})?.draw(t)}}}class He extends We{_activeFeatureInfo=null;_featureClickEvent=(t,e)=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction(t,e),!0);_featureMouseMoveEvent=t=>()=>(this._activeFeatureInfo=t,!0);constructor(t){super(t),this.registerEvent("mouseMoveEvent",t=>(this._activeFeatureInfo=null,!1))}drawImp(t){const e=this.getWidget(),i=e.getPane().getChart().getChartStore();if(o(i.getCrosshair().kLineData)){const s=e.getBounding(),{offsetLeft:a,offsetTop:r,offsetRight:n}=i.getStyles().indicator.tooltip;this.drawIndicatorTooltip(t,a,r,s.width-n)}}drawIndicatorTooltip(t,e,i,s){const a=this.getWidget().getPane(),r=a.getChart().getChartStore(),n=r.getStyles().indicator.tooltip;if(this.isDrawTooltip(r.getCrosshair(),n)){const o=r.getIndicatorsByPaneId(a.getId()),l=n.title,c=n.legend;o.forEach(a=>{let r=0;const n={x:e,y:i},{name:o,calcParamsText:h,legends:d,features:u}=this.getIndicatorTooltipData(a),g=o.length>0,p=d.length>0;if(g||p){const m=this.classifyTooltipFeatures(u);if(r=this.drawStandardTooltipFeatures(t,m[0],n,a,e,r,s),g){let i=o;h.length>0&&(i=`${i}${h}`);const a=l.color;r=this.drawStandardTooltipLegends(t,[{title:{text:"",color:a},value:{text:i,color:a}}],n,e,r,s,l)}r=this.drawStandardTooltipFeatures(t,m[1],n,a,e,r,s),p&&(r=this.drawStandardTooltipLegends(t,d,n,e,r,s,c)),r=this.drawStandardTooltipFeatures(t,m[2],n,a,e,r,s),i=n.y+r}})}return i}drawStandardTooltipFeatures(t,e,i,s,a,r,n){if(e.length>0){let l=0,c=0;e.forEach(e=>{const{marginLeft:i=0,marginTop:s=0,marginRight:a=0,marginBottom:r=0,paddingLeft:n=0,paddingTop:o=0,paddingRight:h=0,paddingBottom:d=0,size:u=0,type:g,content:p}=e;let m=0;if("icon_font"===g){const e=p;t.font=D(u,"normal",e.family),m=t.measureText(e.code).width}else m=u;l+=i+n+m+h+a,c=Math.max(c,s+o+u+d+r)}),i.x+l>n?(i.x=a,i.y+=r,r=c):r=Math.max(r,c);const h=this.getWidget().getPane().getId();e.forEach(e=>{const{marginLeft:a=0,marginTop:r=0,marginRight:n=0,paddingLeft:l=0,paddingTop:c=0,paddingRight:d=0,paddingBottom:u=0,backgroundColor:g,activeBackgroundColor:p,borderRadius:m,size:y=0,color:x,activeColor:f,type:_,content:v}=e;let b=x,E=g;this._activeFeatureInfo?.paneId===h&&this._activeFeatureInfo.indicator?.id===s?.id&&this._activeFeatureInfo.feature.id===e.id&&(b=f??x,E=p??g);let C="onCandleTooltipFeatureClick";const w={paneId:h,feature:e};o(s)&&(C="onIndicatorTooltipFeatureClick",w.indicator=s);const P={mouseDownEvent:this._featureClickEvent(C,w),mouseMoveEvent:this._featureMouseMoveEvent(w)};let S=0;if("icon_font"===_){const e=v;this.createFigure({name:"text",attrs:{text:e.code,x:i.x+a,y:i.y+r},styles:{paddingLeft:l,paddingTop:c,paddingRight:d,paddingBottom:u,borderRadius:m,size:y,family:e.family,color:b,backgroundColor:E}},P)?.draw(t),S=t.measureText(e.code).width}else{this.createFigure({name:"rect",attrs:{x:i.x+a,y:i.y+r,width:y,height:y},styles:{paddingLeft:l,paddingTop:c,paddingRight:d,paddingBottom:u,color:E}},P)?.draw(t);const e=v;this.createFigure({name:"path",attrs:{path:e.path,x:i.x+a+l,y:i.y+r+c,width:y,height:y},styles:{style:e.style,lineWidth:e.lineWidth,color:b}})?.draw(t),S=y}i.x+=a+l+S+d+n})}return r}drawStandardTooltipLegends(t,e,i,s,a,r,n){if(e.length>0){const{marginLeft:o,marginTop:l,marginRight:c,marginBottom:h,size:d,family:u,weight:g}=n;t.font=D(d,g,u),e.forEach(e=>{const n=e.title,p=e.value,m=t.measureText(n.text).width,y=m+t.measureText(p.text).width,x=l+d+h;i.x+o+y+c>r?(i.x=s,i.y+=a,a=x):a=Math.max(a,x),n.text.length>0&&this.createFigure({name:"text",attrs:{x:i.x+o,y:i.y+l,text:n.text},styles:{color:n.color,size:d,family:u,weight:g}})?.draw(t),this.createFigure({name:"text",attrs:{x:i.x+o+m,y:i.y+l,text:p.text},styles:{color:p.color,size:d,family:u,weight:g}})?.draw(t),i.x+=o+y+c})}return a}isDrawTooltip(t,e){const i=e.showRule;return"always"===i||"follow_cross"===i&&c(t.paneId)}getIndicatorTooltipData(t){const e=this.getWidget().getPane().getChart().getChartStore(),i=e.getStyles().indicator,s=i.tooltip,l=s.title;let h="",d="";if(l.show&&(l.showName&&(h=t.shortName),l.showParams)){const e=t.calcParams;e.length>0&&(d=`(${e.join(",")})`)}const u={name:h,calcParamsText:d,legends:[],features:s.features},g=e.getCrosshair().dataIndex,p=t.result,m=e.getInnerFormatter(),y=e.getDecimalFold(),x=e.getThousandsSeparator(),f=[];if(t.visible){const e=p[g]??{},a=s.legend.defaultValue;et(t,g,i,(i,s)=>{if(c(i.title)){const r=s.color;let o=e[i.key];n(o)&&(o=b(o,t.precision),t.shouldFormatBigNumber&&(o=m.formatBigNumber(o)),o=y.format(x.format(o))),f.push({title:{text:i.title,color:r},value:{text:o??a,color:r}})}}),u.legends=f}if(a(t.createTooltipDataSource)){const s=this.getWidget(),a=s.getPane(),h=a.getChart(),{name:d,calcParamsText:g,legends:p,features:m}=t.createTooltipDataSource({chart:h,indicator:t,crosshair:e.getCrosshair(),bounding:s.getBounding(),xAxis:a.getChart().getXAxisPane().getAxisComponent(),yAxis:a.getAxisComponent()});if(l.show&&(c(d)&&l.showName&&(u.name=d),c(g)&&l.showParams&&(u.calcParamsText=g)),o(m)&&(u.features=m),o(p)&&t.visible){const t=[],e=i.tooltip.legend.color;p.forEach(i=>{let s={text:"",color:e};r(i.title)?s=i.title:s.text=i.title;let a={text:"",color:e};r(i.value)?a=i.value:a.text=i.value,n(Number(a.text))&&(a.text=y.format(x.format(a.text))),t.push({title:s,value:a})}),u.legends=t}}return u}classifyTooltipFeatures(t){const e=[],i=[],s=[];return t.forEach(t=>{switch(t.position){case"left":e.push(t);break;case"middle":i.push(t);break;case"right":s.push(t)}}),[e,i,s]}}class $e extends We{constructor(t){super(t),this._initEvent()}_initEvent(){const t=this.getWidget(),e=t.getPane(),i=e.getId(),s=e.getChart(),a=s.getChartStore();this.registerEvent("mouseMoveEvent",e=>{const r=a.getProgressOverlayInfo();if(null!==r){const t=r.overlay;let n=r.paneId;t.isStart()&&(a.updateProgressOverlayInfo(i),n=i);const o=t.points.length-1;return t.isDrawing()&&n===i&&(t.eventMoveForDrawing(this._coordinateToPoint(t,e)),t.onDrawing?.({chart:s,overlay:t,...e})),this._figureMouseMoveEvent(t,"point",o,{key:`${Dt}point_${o}`,type:"circle",attrs:{}})(e)}return a.setHoverOverlayInfo({paneId:i,overlay:null,figureType:"none",figureIndex:-1,figure:null},(t,i)=>this._processOverlayMouseEnterEvent(t,i,e),(t,i)=>this._processOverlayMouseLeaveEvent(t,i,e)),t.setForceCursor(null),!1}).registerEvent("mouseClickEvent",t=>{const e=a.getProgressOverlayInfo();if(null!==e){const r=e.overlay;let n=e.paneId;r.isStart()&&(a.updateProgressOverlayInfo(i,!0),n=i);const o=r.points.length-1;return r.isDrawing()&&n===i&&(r.eventMoveForDrawing(this._coordinateToPoint(r,t)),r.onDrawing?.({chart:s,overlay:r,...t}),r.nextStep(),r.isDrawing()||(a.progressOverlayComplete(),r.onDrawEnd?.({chart:s,overlay:r,...t}))),this._figureMouseClickEvent(r,"point",o,{key:`${Dt}point_${o}`,type:"circle",attrs:{}})(t)}return a.setClickOverlayInfo({paneId:i,overlay:null,figureType:"none",figureIndex:-1,figure:null},(e,i)=>this._processOverlaySelectedEvent(e,i,t),(e,i)=>this._processOverlayDeselectedEvent(e,i,t)),!1}).registerEvent("mouseDoubleClickEvent",t=>{const e=a.getProgressOverlayInfo();if(null!==e){const r=e.overlay,n=e.paneId;r.isDrawing()&&n===i&&(r.forceComplete(),r.isDrawing()||(a.progressOverlayComplete(),r.onDrawEnd?.({chart:s,overlay:r,...t})));const o=r.points.length-1;return this._figureMouseClickEvent(r,"point",o,{key:`${Dt}point_${o}`,type:"circle",attrs:{}})(t)}return!1}).registerEvent("mouseRightClickEvent",t=>{const e=a.getProgressOverlayInfo();if(null!==e){const i=e.overlay;if(i.isDrawing()){const e=i.points.length-1;return this._figureMouseRightClickEvent(i,"point",e,{key:`${Dt}point_${e}`,type:"circle",attrs:{}})(t)}}return!1}).registerEvent("mouseUpEvent",t=>{const{overlay:e,figure:r}=a.getPressedOverlayInfo();return null!==e&&It("onPressedMoveEnd",r)&&e.onPressedMoveEnd?.({chart:s,overlay:e,figure:r??void 0,...t}),a.setPressedOverlayInfo({paneId:i,overlay:null,figureType:"none",figureIndex:-1,figure:null}),!1}).registerEvent("pressedMouseMoveEvent",t=>{const{overlay:e,figureType:i,figureIndex:r,figure:n}=a.getPressedOverlayInfo();if(null!==e&&It("onPressedMoving",n)){if(!e.lock){const a=this._coordinateToPoint(e,t);"point"===i?e.eventPressedPointMove(a,r):e.eventPressedOtherMove(a,this.getWidget().getPane().getChart().getChartStore());let o=!1;e.onPressedMoving?.({chart:s,overlay:e,figure:n??void 0,...t,preventDefault:()=>{o=!0}}),o?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return!0}return this.getWidget().setForceCursor(null),!1})}_createFigureEvents(t,e,i,s){return t.isDrawing()?null:{mouseMoveEvent:this._figureMouseMoveEvent(t,e,i,s),mouseDownEvent:this._figureMouseDownEvent(t,e,i,s),mouseClickEvent:this._figureMouseClickEvent(t,e,i,s),mouseRightClickEvent:this._figureMouseRightClickEvent(t,e,i,s),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,e,i,s)}}_processOverlayMouseEnterEvent(t,e,i){return!(!a(t.onMouseEnter)||!It("onMouseEnter",e))&&(t.onMouseEnter({chart:this.getWidget().getPane().getChart(),overlay:t,figure:e??void 0,...i}),!0)}_processOverlayMouseLeaveEvent(t,e,i){return!(!a(t.onMouseLeave)||!It("onMouseLeave",e))&&(t.onMouseLeave({chart:this.getWidget().getPane().getChart(),overlay:t,figure:e??void 0,...i}),!0)}_processOverlaySelectedEvent(t,e,i){return!!It("onSelected",e)&&(t.onSelected?.({chart:this.getWidget().getPane().getChart(),overlay:t,figure:e??void 0,...i}),!0)}_processOverlayDeselectedEvent(t,e,i){return!!It("onDeselected",e)&&(t.onDeselected?.({chart:this.getWidget().getPane().getChart(),overlay:t,figure:e??void 0,...i}),!0)}_figureMouseMoveEvent(t,e,i,s){return a=>{const r=this.getWidget().getPane(),n=!t.isDrawing()&&It("onMouseMove",s);if(n){let e=!1;t.onMouseMove?.({chart:r.getChart(),overlay:t,figure:s,...a,preventDefault:()=>{e=!0}}),e?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return r.getChart().getChartStore().setHoverOverlayInfo({paneId:r.getId(),overlay:t,figureType:e,figure:s,figureIndex:i},(t,e)=>this._processOverlayMouseEnterEvent(t,e,a),(t,e)=>this._processOverlayMouseLeaveEvent(t,e,a)),n}}_figureMouseDownEvent(t,e,i,s){return a=>{const r=this.getWidget().getPane(),n=r.getId();return t.startPressedMove(this._coordinateToPoint(t,a)),!!It("onPressedMoveStart",s)&&(t.onPressedMoveStart?.({chart:r.getChart(),overlay:t,figure:s,...a}),r.getChart().getChartStore().setPressedOverlayInfo({paneId:n,overlay:t,figureType:e,figureIndex:i,figure:s}),!t.isDrawing())}}_figureMouseClickEvent(t,e,i,s){return a=>{const r=this.getWidget().getPane(),n=r.getId(),o=!t.isDrawing()&&It("onClick",s);return o&&t.onClick?.({chart:this.getWidget().getPane().getChart(),overlay:t,figure:s,...a}),r.getChart().getChartStore().setClickOverlayInfo({paneId:n,overlay:t,figureType:e,figureIndex:i,figure:s},(t,e)=>this._processOverlaySelectedEvent(t,e,a),(t,e)=>this._processOverlayDeselectedEvent(t,e,a)),o}}_figureMouseDoubleClickEvent(t,e,i,s){return e=>!!It("onDoubleClick",s)&&(t.onDoubleClick?.({...e,chart:this.getWidget().getPane().getChart(),figure:s,overlay:t}),!t.isDrawing())}_figureMouseRightClickEvent(t,e,i,s){return e=>{if(It("onRightClick",s)){let i=!1;return t.onRightClick?.({chart:this.getWidget().getPane().getChart(),overlay:t,figure:s,...e,preventDefault:()=>{i=!0}}),i||this.getWidget().getPane().getChart().getChartStore().removeOverlay(t),!t.isDrawing()}return!1}}_coordinateToPoint(t,e){const i={},s=this.getWidget().getPane(),a=s.getChart(),r=s.getId(),o=a.getChartStore();if(this.coordinateToPointTimestampDataIndexFlag()){const t=a.getXAxisPane().getAxisComponent().convertFromPixel(e.x),s=o.dataIndexToTimestamp(t)??void 0;i.timestamp=s,i.dataIndex=t}if(this.coordinateToPointValueFlag()){const a=s.getAxisComponent();let l=a.convertFromPixel(e.y);if("normal"!==t.mode&&r===ge.CANDLE&&n(i.dataIndex)){const e=o.getDataByDataIndex(i.dataIndex);if(null!==e){const i=t.modeSensitivity;if(l>e.high)if("weak_magnet"===t.mode){const t=a.convertToPixel(e.high);l<a.convertFromPixel(t-i)&&(l=e.high)}else l=e.high;else if(l<e.low)if("weak_magnet"===t.mode){const t=a.convertToPixel(e.low);l>a.convertFromPixel(t-i)&&(l=e.low)}else l=e.low;else{const t=Math.max(e.open,e.close),i=Math.min(e.open,e.close);l=l>t?l-t<e.high-l?t:e.high:l<i?l-e.low<i-l?e.low:i:t-l<l-i?t:i}}}i.value=l}return i}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,e){return this.getWidget().getPane().getChart().getChartStore().isOverlayDrawing()?this.onEvent(t,e):super.dispatchEvent(t,e)}drawImp(t){this.getCompleteOverlays().forEach(e=>{e.visible&&this._drawOverlay(t,e)});const e=this.getProgressOverlay();o(e)&&e.visible&&this._drawOverlay(t,e)}_drawOverlay(t,e){const{points:i}=e,s=this.getWidget().getPane(),a=s.getChart(),r=a.getChartStore(),o=s.getAxisComponent(),l=a.getXAxisPane().getAxisComponent(),c=i.map(t=>{let e=null;n(t.timestamp)&&(e=r.timestampToDataIndex(t.timestamp));const i={x:0,y:0};return n(e)&&(i.x=l.convertToPixel(e)),n(t.value)&&(i.y=o?.convertToPixel(t.value)??0),i});if(c.length>0){const i=[].concat(this.getFigures(e,c));this.drawFigures(t,e,i)}this.drawDefaultFigures(t,e,c)}drawFigures(t,e,i){const s=this.getWidget().getPane().getChart().getStyles().overlay;i.forEach((i,a)=>{const{type:r,styles:n,attrs:o}=i;[].concat(o).forEach(o=>{const l=this._createFigureEvents(e,"other",a,i),c={...s[r],...e.styles?.[r],...n};this.createFigure({name:r,attrs:o,styles:c},l??void 0)?.draw(t)})})}getCompleteOverlays(){const t=this.getWidget().getPane();return t.getChart().getChartStore().getOverlaysByPaneId(t.getId())}getProgressOverlay(){const t=this.getWidget().getPane(),e=t.getChart().getChartStore().getProgressOverlayInfo();return o(e)&&e.paneId===t.getId()?e.overlay:null}getFigures(t,e){const i=this.getWidget(),s=i.getPane(),a=s.getChart(),r=s.getAxisComponent(),n=a.getXAxisPane().getAxisComponent(),o=i.getBounding();return t.createPointFigures?.({chart:a,overlay:t,coordinates:e,bounding:o,xAxis:n,yAxis:r})??[]}drawDefaultFigures(t,e,i){if(e.needDefaultPointFigure){const s=this.getWidget().getPane().getChart().getChartStore(),a=s.getHoverOverlayInfo(),r=s.getClickOverlayInfo();if(a.overlay?.id===e.id&&"none"!==a.figureType||r.overlay?.id===e.id&&"none"!==r.figureType){const r=s.getStyles().overlay,n=e.styles,o={...r.point,...n?.point};i.forEach(({x:i,y:s},r)=>{let n=o.radius,l=o.color,c=o.borderColor,h=o.borderSize;a.overlay?.id===e.id&&"point"===a.figureType&&a.figure?.key===`${Dt}point_${r}`&&(n=o.activeRadius,l=o.activeColor,c=o.activeBorderColor,h=o.activeBorderSize),this.createFigure({name:"circle",attrs:{x:i,y:s,r:n+h},styles:{color:c}},this._createFigureEvents(e,"point",r,{key:`${Dt}point_${r}`,type:"circle",attrs:{x:i,y:s,r:n+h},styles:{color:c}})??void 0)?.draw(t),this.createFigure({name:"circle",attrs:{x:i,y:s,r:n},styles:{color:l}})?.draw(t)})}}}}class Ge extends Oe{_gridView=new Ye(this);_indicatorView=new Ve(this);_crosshairLineView=new Xe(this);_tooltipView=this.createTooltipView();_overlayView=new $e(this);constructor(t,e){super(t,e),this.addChild(this._tooltipView),this.addChild(this._overlayView)}getName(){return Fe}updateMain(t){"minimize"!==this.getPane().getOptions().state&&(this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t))}createTooltipView(){return new He(this)}updateMainContent(t){}updateOverlayContent(t){}updateOverlay(t){"minimize"!==this.getPane().getOptions().state&&(this._overlayView.draw(t),this._crosshairLineView.draw(t),this.updateOverlayContent(t)),this._tooltipView.draw(t)}}class Ue extends Ne{_ripplePoint=this.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}});_animationFrameTime=0;_animation=new be({iterationCount:1/0}).doFrame(t=>{this._animationFrameTime=t;const e=this.getWidget().getPane();e.getChart().updatePane(0,e.getId())});drawImp(t){const e=this.getWidget(),i=e.getPane(),a=i.getChart(),r=a.getDataList().length-1,l=e.getBounding(),c=i.getAxisComponent(),h=a.getStyles().candle.area,d=[];let u=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,p=null;if(this.eachChildren(t=>{const e=t.x,{current:i}=t.data,s=i?.[h.value];if(n(s)){const i=c.convertToPixel(s);g===Number.MIN_SAFE_INTEGER&&(g=e),d.push({x:e,y:i}),u=Math.min(u,i),t.dataIndex===r&&(p={x:e,y:i})}}),d.length>0){this.createFigure({name:"line",attrs:{coordinates:d},styles:{color:h.lineColor,size:h.lineSize,smooth:h.smooth}})?.draw(t);const e=h.backgroundColor;let i="";if(s(e)){const s=t.createLinearGradient(0,l.height,0,u);try{e.forEach(({offset:t,color:e})=>{s.addColorStop(t,e)})}catch(t){}i=s}else i=e;t.fillStyle=i,t.beginPath(),t.moveTo(g,l.height),t.lineTo(d[0].x,d[0].y),z(t,d,h.smooth),t.lineTo(d[d.length-1].x,l.height),t.closePath(),t.fill()}const m=h.point;if(m.show&&o(p)){this.createFigure({name:"circle",attrs:{x:p.x,y:p.y,r:m.radius},styles:{style:"fill",color:m.color}})?.draw(t);let e=m.rippleRadius;m.animation&&(e=m.radius+this._animationFrameTime/m.animationDuration*(m.rippleRadius-m.radius),this._animation.setDuration(m.animationDuration).start()),this._ripplePoint?.setAttrs({x:p.x,y:p.y,r:e}).setStyles({style:"fill",color:m.rippleColor}).draw(t)}else this.stopAnimation()}stopAnimation(){this._animation.stop()}}class Ze extends We{drawImp(t){const e=this.getWidget().getPane(),i=e.getChart().getChartStore(),s=i.getStyles().candle.priceMark,a=s.high,r=s.low;if(s.show&&(a.show||r.show)){const s=i.getVisibleRangeHighLowPrice(),n=i.getSymbol()?.pricePrecision??Mt.PRICE,o=e.getAxisComponent(),{price:l,x:c}=s[0],{price:h,x:d}=s[1],u=o.convertToPixel(l),g=o.convertToPixel(h),p=i.getDecimalFold(),m=i.getThousandsSeparator();a.show&&l!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,p.format(m.format(b(l,n))),{x:c,y:u},u<g?[-2,-5]:[2,5],a),r.show&&h!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,p.format(m.format(b(h,n))),{x:d,y:g},u<g?[2,5]:[-2,-5],r)}}_drawMark(t,e,i,s,a){const r=i.x,n=i.y+s[0];this.createFigure({name:"line",attrs:{coordinates:[{x:r-2,y:n+s[0]},{x:r,y:n},{x:r+2,y:n+s[0]}]},styles:{color:a.color}})?.draw(t);let o=0,l=0,c="left";const{width:h}=this.getWidget().getBounding();r>h/2?(o=r-5,l=o-a.textOffset,c="right"):(o=r+5,c="left",l=o+a.textOffset);const d=n+s[1];this.createFigure({name:"line",attrs:{coordinates:[{x:r,y:n},{x:r,y:d},{x:o,y:d}]},styles:{color:a.color}})?.draw(t),this.createFigure({name:"text",attrs:{x:l,y:d,text:e,align:c,baseline:"middle"},styles:{color:a.color,size:a.textSize,family:a.textFamily,weight:a.textWeight}})?.draw(t)}}class qe extends We{drawImp(t){const e=this.getWidget(),i=e.getPane(),s=e.getBounding(),a=i.getChart().getChartStore(),r=a.getStyles().candle.priceMark,n=r.last,l=n.line;if(r.show&&n.show&&l.show){const e=i.getAxisComponent(),r=a.getDataList(),c=r[r.length-1];if(o(c)){const{close:i,open:a}=c,o="current_open"===n.compareRule?a:r[r.length-2]?.close??i,h=e.convertToNicePixel(i);let d="";d=i>o?n.upColor:i<o?n.downColor:n.noChangeColor,this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:h},{x:s.width,y:h}]},styles:{style:l.style,color:d,size:l.size,dashedValue:l.dashedValue}})?.draw(t)}}}}class je extends He{drawImp(t){const e=this.getWidget(),i=e.getPane().getChart().getChartStore(),s=i.getCrosshair();if(o(s.kLineData)){const a=e.getBounding(),r=i.getStyles(),n=r.candle,o=r.indicator;if("rect"===n.tooltip.showType&&"rect"===o.tooltip.showType){const e=this.isDrawTooltip(s,n.tooltip),i=this.isDrawTooltip(s,o.tooltip);this._drawRectTooltip(t,e,i,n.tooltip.offsetTop)}else if("standard"===n.tooltip.showType&&"standard"===o.tooltip.showType){const{offsetLeft:e,offsetTop:i,offsetRight:s}=n.tooltip,r=a.width-s,o=this._drawCandleStandardTooltip(t,e,i,r);this.drawIndicatorTooltip(t,e,o,r)}else if("rect"===n.tooltip.showType&&"standard"===o.tooltip.showType){const{offsetLeft:e,offsetTop:i,offsetRight:r}=n.tooltip,o=a.width-r,l=this.drawIndicatorTooltip(t,e,i,o),c=this.isDrawTooltip(s,n.tooltip);this._drawRectTooltip(t,c,!1,l)}else{const{offsetLeft:e,offsetTop:i,offsetRight:r}=n.tooltip,l=a.width-r,c=this._drawCandleStandardTooltip(t,e,i,l),h=this.isDrawTooltip(s,o.tooltip);this._drawRectTooltip(t,!1,h,c)}}}_drawCandleStandardTooltip(t,e,i,s){const a=this.getWidget().getPane().getChart().getChartStore(),r=a.getStyles().candle.tooltip,n=r.legend;let o=0;const l={x:e,y:i},c=a.getCrosshair();if(this.isDrawTooltip(c,r)){const c=r.title;if(c.show){const{type:r="",span:n=""}=a.getPeriod()??{},o=P(c.template,{...a.getSymbol(),period:`${n}${St(r,a.getLocale())}`}),h=c.color,d=this.drawStandardTooltipLegends(t,[{title:{text:"",color:h},value:{text:o,color:h}}],{x:e,y:i},e,0,s,c);l.y=l.y+d}const h=this._getCandleTooltipLegends(),d=this.classifyTooltipFeatures(r.features);o=this.drawStandardTooltipFeatures(t,d[0],l,null,e,o,s),o=this.drawStandardTooltipFeatures(t,d[1],l,null,e,o,s),h.length>0&&(o=this.drawStandardTooltipLegends(t,h,l,e,o,s,n)),o=this.drawStandardTooltipFeatures(t,d[2],l,null,e,o,s)}return l.y+o}_drawRectTooltip(t,e,i,s){const a=this.getWidget(),r=a.getPane(),n=r.getChart().getChartStore(),o=n.getStyles(),l=o.candle,c=o.indicator,h=l.tooltip,d=c.tooltip;if(e||i){const o=this._getCandleTooltipLegends(),{offsetLeft:l,offsetTop:c,offsetRight:u,offsetBottom:g}=h,{marginLeft:p,marginRight:m,marginTop:y,marginBottom:x,size:f,weight:_,family:v}=h.legend,{position:b,paddingLeft:E,paddingRight:C,paddingTop:w,paddingBottom:P,offsetLeft:S,offsetRight:I,offsetTop:T,offsetBottom:M,borderSize:F,borderRadius:A,borderColor:k,color:B}=h.rect;let R=0,L=0,O=0;e&&(t.font=D(f,_,v),o.forEach(e=>{const i=e.title,s=e.value,a=`${i.text}${s.text}`,r=t.measureText(a).width+p+m;R=Math.max(R,r)}),O+=(x+y+f)*o.length);const{marginLeft:W,marginRight:Y,marginTop:N,marginBottom:z,size:V,weight:X,family:H}=d.legend,$=[];if(i){const e=n.getIndicatorsByPaneId(r.getId());t.font=D(V,X,H),e.forEach(e=>{const i=this.getIndicatorTooltipData(e).legends;$.push(i),i.forEach(e=>{const i=e.title,s=e.value,a=`${i.text}${s.text}`,r=t.measureText(a).width+W+Y;R=Math.max(R,r),O+=N+z+V})})}if(L+=R,0!==L&&0!==O){const h=n.getCrosshair(),d=a.getBounding(),D=r.getYAxisWidget().getBounding();L+=2*F+E+C,O+=2*F+w+P;const R=d.width/2,G="pointer"===b&&h.paneId===ge.CANDLE,U=(h.realX??0)>R;let Z=0;if(G){const t=h.realX;Z=U?t-I-L:t+S}else{const t=this.getWidget().getPane().getAxisComponent();U?(Z=S+l,t.inside&&"left"===t.position&&(Z+=D.width)):(Z=d.width-I-L-u,t.inside&&"right"===t.position&&(Z-=D.width))}let q=s+T;if(G){q=h.y-O/2,q+O>d.height-M-g&&(q=d.height-M-O-g),q<s+T&&(q=s+T+c)}this.createFigure({name:"rect",attrs:{x:Z,y:q,width:L,height:O},styles:{style:"stroke_fill",color:B,borderColor:k,borderSize:F,borderRadius:A}})?.draw(t);const j=Z+F+E+p;let Q=q+F+w;if(e&&o.forEach(e=>{Q+=y;const i=e.title;this.createFigure({name:"text",attrs:{x:j,y:Q,text:i.text},styles:{color:i.color,size:f,family:v,weight:_}})?.draw(t);const s=e.value;this.createFigure({name:"text",attrs:{x:Z+L-F-m-C,y:Q,text:s.text,align:"right"},styles:{color:s.color,size:f,family:v,weight:_}})?.draw(t),Q+=f+x}),i){const e=Z+F+E+W;$.forEach(i=>{i.forEach(i=>{Q+=N;const s=i.title,a=i.value;this.createFigure({name:"text",attrs:{x:e,y:Q,text:s.text},styles:{color:s.color,size:V,family:H,weight:X}})?.draw(t),this.createFigure({name:"text",attrs:{x:Z+L-F-Y-C,y:Q,text:a.text,align:"right"},styles:{color:a.color,size:V,family:H,weight:X}})?.draw(t),Q+=V+z})})}}}}_getCandleTooltipLegends(){const t=this.getWidget().getPane().getChart().getChartStore(),e=t.getStyles().candle,i=t.getDataList(),s=t.getInnerFormatter(),n=t.getDecimalFold(),l=t.getThousandsSeparator(),c=t.getLocale(),{pricePrecision:h=Mt.PRICE,volumePrecision:d=Mt.VOLUME}=t.getSymbol()??{},u=t.getPeriod(),g=t.getCrosshair().dataIndex??0,p=e.tooltip,{color:m,defaultValue:y,template:x}=p.legend,f=i[g-1]??null,_=i[g],v=f?.close??_.close,E=_.close-v,C={..._,time:s.formatDate(_.timestamp,he[u?.type??"day"],"tooltip"),open:n.format(l.format(b(_.open,h))),high:n.format(l.format(b(_.high,h))),low:n.format(l.format(b(_.low,h))),close:n.format(l.format(b(_.close,h))),volume:n.format(l.format(s.formatBigNumber(b(_.volume??y,d)))),turnover:n.format(l.format(b(_.turnover??y,h))),change:0===v?y:`${l.format(b(E/v*100))}%`};return(a(x)?x({prev:f,current:_,next:i[g+1]??null},e):x).map(({title:t,value:i})=>{let s={text:"",color:m};r(t)?s={...t}:s.text=t,s.text=St(s.text,c);let a={text:y,color:m};return r(i)?a={...i}:a.text=i,o(/{change}/.exec(a.text))&&(a.color=0===E?e.priceMark.last.noChangeColor:E>0?e.priceMark.last.upColor:e.priceMark.last.downColor),a.text=P(a.text,C),{title:s,value:a}})}}class Qe extends We{_activeFeatureInfo=null;_featureClickEvent=t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCrosshairFeatureClick",t),!0);_featureMouseMoveEvent=t=>()=>(this._activeFeatureInfo=t,this.getWidget().setForceCursor("pointer"),!0);constructor(t){super(t),this.registerEvent("mouseMoveEvent",t=>(this._activeFeatureInfo=null,this.getWidget().setForceCursor(null),!1))}drawImp(t){const e=this.getWidget(),i=e.getPane(),s=e.getPane().getChart().getChartStore(),a=s.getCrosshair(),r=this.getWidget(),n=r.getPane().getAxisComponent();if(c(a.paneId)&&a.paneId===i.getId()&&n.isInCandle()){const e=s.getStyles().crosshair,i=e.horizontal.features;if(e.show&&e.horizontal.show&&i.length>0){const o="right"===n.position,l=r.getBounding();let c=0;const h=e.horizontal.text;if(n.inside&&h.show){const t=n.convertFromPixel(a.y),e=n.getRange();let i=n.displayValueToText(n.realValueToDisplayValue(n.valueToRealValue(t,{range:e}),{range:e}),s.getSymbol()?.pricePrecision??Mt.PRICE);i=s.getDecimalFold().format(s.getThousandsSeparator().format(i)),c=h.paddingLeft+T(i,h.size,h.weight,h.family)+h.paddingRight}let d=c;o&&(d=l.width-c);const u=a.y;i.forEach(e=>{const{marginLeft:i=0,marginTop:s=0,marginRight:r=0,paddingLeft:n=0,paddingTop:l=0,paddingRight:c=0,paddingBottom:h=0,color:g,activeColor:p,backgroundColor:m,activeBackgroundColor:y,borderRadius:x,size:f=0,type:_,content:v}=e;let b=f;if("icon_font"===_){const t=v;b=n+T(t.code,f,"normal",t.family)+c}o?d-=b+r:d+=i;let E=g,C=m;this._activeFeatureInfo?.feature.id===e.id&&(E=p??g,C=y??m);const w={mouseDownEvent:this._featureClickEvent({crosshair:a,feature:e}),mouseMoveEvent:this._featureMouseMoveEvent({crosshair:a,feature:e})};if("icon_font"===_){const e=v;this.createFigure({name:"text",attrs:{text:e.code,x:d,y:u+s,baseline:"middle"},styles:{paddingLeft:n,paddingTop:l,paddingRight:c,paddingBottom:h,borderRadius:x,size:f,family:e.family,color:E,backgroundColor:C}},w)?.draw(t)}else{this.createFigure({name:"rect",attrs:{x:d,y:u+s-f/2,width:f,height:f},styles:{paddingLeft:n,paddingTop:l,paddingRight:c,paddingBottom:h,color:C}},w)?.draw(t);const e=v;this.createFigure({name:"path",attrs:{path:e.path,x:d,y:u+s+l-f/2,width:f,height:f},styles:{style:e.style,lineWidth:e.lineWidth,color:E}})?.draw(t)}o?d-=i:d+=b+r})}}}}class Je extends Ge{_candleBarView=new ze(this);_candleAreaView=new Ue(this);_candleHighLowPriceView=new Ze(this);_candleLastPriceLineView=new qe(this);_crosshairFeatureView=new Qe(this);constructor(t,e){super(t,e),this.addChild(this._candleBarView),this.addChild(this._crosshairFeatureView)}updateMainContent(t){"area"!==this.getPane().getChart().getStyles().candle.type?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleAreaView.stopAnimation()):this._candleAreaView.draw(t),this._candleLastPriceLineView.draw(t)}updateOverlayContent(t){this._crosshairFeatureView.draw(t)}createTooltipView(){return new je(this)}}class Ke extends We{drawImp(t,e){const i=this.getWidget(),s=i.getPane(),a=i.getBounding(),r=s.getAxisComponent(),n=this.getAxisStyles(s.getChart().getStyles());if(n.show&&(n.axisLine.show&&this.createFigure({name:"line",attrs:this.createAxisLine(a,n),styles:n.axisLine})?.draw(t),!e[0])){const e=r.getTicks();if(n.tickLine.show){this.createTickLines(e,a,n).forEach(e=>{this.createFigure({name:"line",attrs:e,styles:n.tickLine})?.draw(t)})}if(n.tickText.show){const i=this.createTickTexts(e,a,n);this.createFigure({name:"text",attrs:i,styles:n.tickText})?.draw(t)}}}}class ti extends Ke{getAxisStyles(t){return t.yAxis}createAxisLine(t,e){const i=this.getWidget().getPane().getAxisComponent(),s=e.axisLine.size;let a=0;return a=i.isFromZero()?0:t.width-s,{coordinates:[{x:a,y:0},{x:a,y:t.height}]}}createTickLines(t,e,i){const s=this.getWidget().getPane().getAxisComponent(),a=i.axisLine,r=i.tickLine;let n=0,o=0;return s.isFromZero()?(n=0,a.show&&(n+=a.size),o=n+r.length):(n=e.width,a.show&&(n-=a.size),o=n-r.length),t.map(t=>({coordinates:[{x:n,y:t.coord},{x:o,y:t.coord}]}))}createTickTexts(t,e,i){const s=this.getWidget().getPane().getAxisComponent(),a=i.axisLine,r=i.tickLine,n=i.tickText;let o=0;s.isFromZero()?(o=n.marginStart,a.show&&(o+=a.size),r.show&&(o+=r.length)):(o=e.width-n.marginEnd,a.show&&(o-=a.size),r.show&&(o-=r.length));const l=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map(t=>({x:o,y:t.coord,text:t.text,align:l,baseline:"middle"}))}}class ei extends We{drawImp(t){const e=this.getWidget(),i=e.getPane(),s=e.getBounding(),a=i.getChart().getChartStore(),r=a.getStyles().candle.priceMark,n=r.last,l=n.text;if(r.show&&n.show&&l.show){const e=a.getSymbol()?.pricePrecision??Mt.PRICE,r=i.getAxisComponent(),c=a.getDataList(),h=c[c.length-1];if(o(h)){const{close:i,open:o}=h,d="current_open"===n.compareRule?o:c[c.length-2]?.close??i,u=r.convertToNicePixel(i);let g="";g=i>d?n.upColor:i<d?n.downColor:n.noChangeColor;let p=0,m="left";r.isFromZero()?(p=0,m="left"):(p=s.width,m="right");const y=[],x=r.getRange();let f=r.displayValueToText(r.realValueToDisplayValue(r.valueToRealValue(i,{range:x}),{range:x}),e);f=a.getDecimalFold().format(a.getThousandsSeparator().format(f));const{paddingLeft:_,paddingRight:v,paddingTop:b,paddingBottom:E,size:C,family:w,weight:P}=l;let S=_+T(f,C,P,w)+v;const I=b+C+E;y.push({name:"text",attrs:{x:p,y:u,width:S,height:I,text:f,align:m,baseline:"middle"},styles:{...l,backgroundColor:g}});const D=a.getInnerFormatter().formatExtendText,M=C/2;let F=u-M-b,A=u+M+E;n.extendTexts.forEach((t,e)=>{const i=D({type:"last_price",data:h,index:e});if(i.length>0&&t.show){const e=t.size/2;let s=0;"above_price"===t.position?(F-=t.paddingBottom+e,s=F,F-=e+t.paddingTop):(A+=t.paddingTop+e,s=A,A+=e+t.paddingBottom),S=Math.max(S,t.paddingLeft+T(i,t.size,t.weight,t.family)+t.paddingRight),y.push({name:"text",attrs:{x:p,y:s,width:S,height:t.paddingTop+t.size+t.paddingBottom,text:i,align:m,baseline:"middle"},styles:{...t,backgroundColor:g}})}}),y.forEach(e=>{e.attrs.width=S,this.createFigure(e)?.draw(t)})}}}}class ii extends We{drawImp(t){const e=this.getWidget(),i=e.getPane(),s=e.getBounding(),a=i.getChart().getChartStore(),r=a.getStyles().indicator,l=r.lastValueMark,c=l.text;if(l.show){const e=i.getAxisComponent(),l=e.getRange(),h=a.getDataList().length-1,d=a.getIndicatorsByPaneId(i.getId()),u=a.getInnerFormatter(),g=a.getDecimalFold(),p=a.getThousandsSeparator();d.forEach(i=>{const a=i.result[h]??{};if(o(a)&&i.visible){const o=i.precision;et(i,h,r,(r,h)=>{const d=a[r.key];if(n(d)){const a=e.convertToNicePixel(d);let r=e.displayValueToText(e.realValueToDisplayValue(e.valueToRealValue(d,{range:l}),{range:l}),o);i.shouldFormatBigNumber&&(r=u.formatBigNumber(r)),r=g.format(p.format(r));let n=0,m="left";e.isFromZero()?(n=0,m="left"):(n=s.width,m="right"),this.createFigure({name:"text",attrs:{x:n,y:a,text:r,align:m,baseline:"middle"},styles:{...c,backgroundColor:h.color}})?.draw(t)}})}})}}}class si extends $e{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(t,e,i){this.drawFigures(t,e,this.getDefaultFigures(e,i))}getDefaultFigures(t,e){const i=this.getWidget(),s=i.getPane(),a=s.getChart().getChartStore(),r=a.getClickOverlayInfo(),o=[];if(t.needDefaultYAxisFigure&&t.id===r.overlay?.id&&r.paneId===s.getId()){const r=s.getAxisComponent(),l=i.getBounding();let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;const d=r.isFromZero();let u="left",g=0;d?(u="left",g=0):(u="right",g=l.width);const p=a.getDecimalFold(),m=a.getThousandsSeparator();e.forEach((e,i)=>{const s=t.points[i];if(n(s.value)){c=Math.min(c,e.y),h=Math.max(h,e.y);const t=p.format(m.format(b(s.value,a.getSymbol()?.pricePrecision??Mt.PRICE)));o.push({type:"text",attrs:{x:g,y:e.y,text:t,align:u,baseline:"middle"},ignoreEvent:!0})}}),e.length>1&&o.unshift({type:"rect",attrs:{x:0,y:c,width:l.width,height:h-c},ignoreEvent:!0})}return o}getFigures(t,e){const i=this.getWidget(),s=i.getPane(),a=s.getChart(),r=s.getAxisComponent(),n=a.getXAxisPane().getAxisComponent(),o=i.getBounding();return t.createYAxisFigures?.({chart:a,overlay:t,coordinates:e,bounding:o,xAxis:n,yAxis:r})??[]}}class ai extends We{drawImp(t){const e=this.getWidget(),i=e.getPane(),s=e.getPane().getChart().getChartStore(),a=s.getCrosshair();if(c(a.paneId)&&this.compare(a,i.getId())){const r=s.getStyles().crosshair;if(r.show){const n=this.getDirectionStyles(r),o=n.text;if(n.show&&o.show){const r=e.getBounding(),n=i.getAxisComponent(),l=this.getText(a,s,n);t.font=D(o.size,o.weight,o.family),this.createFigure({name:"text",attrs:this.getTextAttrs(l,t.measureText(l).width,a,r,n,o),styles:o})?.draw(t)}}}}compare(t,e){return t.paneId===e}getDirectionStyles(t){return t.horizontal}getText(t,e,i){const s=i,a=i.convertFromPixel(t.y);let r=0,n=!1;if(s.isInCandle())r=e.getSymbol()?.pricePrecision??Mt.PRICE;else{e.getIndicatorsByPaneId(t.paneId).forEach(t=>{r=Math.max(t.precision,r),n||=t.shouldFormatBigNumber})}const o=s.getRange();let l=s.displayValueToText(s.realValueToDisplayValue(s.valueToRealValue(a,{range:o}),{range:o}),r);return n&&(l=e.getInnerFormatter().formatBigNumber(l)),e.getDecimalFold().format(e.getThousandsSeparator().format(l))}getTextAttrs(t,e,i,s,a,r){let n=0,o="left";return a.isFromZero()?(n=0,o="left"):(n=s.width,o="right"),{x:n,y:i.y,text:t,align:o,baseline:"middle"}}}class ri extends Oe{_yAxisView=new ti(this);_candleLastPriceLabelView=new ei(this);_indicatorLastValueView=new ii(this);_overlayYAxisView=new si(this);_crosshairHorizontalLabelView=new ai(this);constructor(t,e){super(t,e),this.setCursor("ns-resize"),this.addChild(this._overlayYAxisView)}getName(){return ke}updateMain(t){const e="minimize"===this.getPane().getOptions().state;this._yAxisView.draw(t,e),e||(this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t))}updateOverlay(t){"minimize"!==this.getPane().getOptions().state&&(this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t))}}class ni{_container;_id;_chart;_bounding=fe();_originalBounding=fe();_visible=!0;constructor(t,e){this._chart=t,this._id=e,this._container=Pe("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"})}getContainer(){return this._container}setVisible(t){this._visible!==t&&(this._container.style.display=t?"block":"none",this._visible=t)}getVisible(){return this._visible}getId(){return this._id}getChart(){return this._chart}getBounding(){return this._bounding}setOriginalBounding(t){e(this._originalBounding,t)}getOriginalBounding(){return this._originalBounding}update(t){this._bounding.height!==this._container.clientHeight&&(this._container.style.height=`${this._bounding.height}px`),this.updateImp(t??3,this._container,this._bounding)}}class oi extends ni{_mainWidget;_yAxisWidget=null;_axis;_options={id:"",minHeight:30,dragEnabled:!0,order:0,height:100,state:"normal",axis:{name:"normal",scrollZoomEnabled:!0}};constructor(t,e,i){super(t,e);const s=this.getContainer();this._mainWidget=this.createMainWidget(s),this._yAxisWidget=this.createYAxisWidget(s),this.setOptions(i)}setOptions(t){const i=this.getId();if(i===ge.CANDLE||i===ge.X_AXIS){const e=t.axis?.name;(!o(this._axis)||o(e)&&this._options.axis.name!==e)&&(this._axis=this.createAxisComponent(e??"normal"))}else o(this._axis)||(this._axis=this.createAxisComponent("normal"));this._axis instanceof pe&&this._axis.setAutoCalcTickFlag(!0),e(this._options,t),this._axis.override({...this._options.axis,name:t.axis?.name??"normal"});let s=null,a="default";return this.getId()===ge.X_AXIS?(s=this.getMainWidget().getContainer(),a="ew-resize"):(s=this.getYAxisWidget().getContainer(),a="ns-resize"),t.axis?.scrollZoomEnabled??1?s.style.cursor=a:s.style.cursor="default",this}getOptions(){return this._options}getAxisComponent(){return this._axis}setBounding(t,i,s,a){e(this.getBounding(),t);const r={};o(t.height)&&(r.height=t.height),o(t.top)&&(r.top=t.top),this._mainWidget.setBounding(r);const n=o(i);if(n&&this._mainWidget.setBounding(i),o(this._yAxisWidget)){this._yAxisWidget.setBounding(r);"left"===this._axis.position?o(s)&&this._yAxisWidget.setBounding({...s,left:0}):o(a)&&(this._yAxisWidget.setBounding(a),n&&this._yAxisWidget.setBounding({left:(i.left??0)+(i.width??0)+(i.right??0)-(a.width??0)}))}return this}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}updateImp(t){this._mainWidget.update(t),this._yAxisWidget?.update(t)}destroy(){this._mainWidget.destroy(),this._yAxisWidget?.destroy()}getImage(t){const{width:e,height:i}=this.getBounding(),s=Pe("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),a=s.getContext("2d"),r=I(s);s.width=e*r,s.height=i*r,a.scale(r,r);const n=this._mainWidget.getBounding();if(a.drawImage(this._mainWidget.getImage(t),n.left,0,n.width,n.height),null!==this._yAxisWidget){const e=this._yAxisWidget.getBounding();a.drawImage(this._yAxisWidget.getImage(t),e.left,0,e.width,e.height)}return s}createYAxisWidget(t){return null}}class li extends oi{createAxisComponent(t){const e=function(t){return xe[t]??xe.normal}(t??"default");return new e(this)}createMainWidget(t){return new Ge(t,this)}createYAxisWidget(t){return new ri(t,this)}}class ci extends li{createMainWidget(t){return new Je(t,this)}}class hi extends Ke{getAxisStyles(t){return t.xAxis}createAxisLine(t){return{coordinates:[{x:0,y:0},{x:t.width,y:0}]}}createTickLines(t,e,i){const s=i.tickLine,a=i.axisLine.size;return t.map(t=>({coordinates:[{x:t.coord,y:0},{x:t.coord,y:a+s.length}]}))}createTickTexts(t,e,i){const s=i.tickText,a=i.axisLine.size,r=i.tickLine.length;return t.map(t=>({x:t.coord,y:a+r+s.marginStart,text:t.text,align:"center",baseline:"top"}))}}class di extends si{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(){return this.getWidget().getPane().getChart().getChartStore().getOverlaysByPaneId()}getProgressOverlay(){return this.getWidget().getPane().getChart().getChartStore().getProgressOverlayInfo()?.overlay??null}getDefaultFigures(t,e){const i=[],s=this.getWidget(),a=s.getPane().getChart().getChartStore(),r=a.getClickOverlayInfo();if(t.needDefaultXAxisFigure&&t.id===r.overlay?.id){let r=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;e.forEach((e,s)=>{r=Math.min(r,e.x),o=Math.max(o,e.x);const l=t.points[s];if(n(l.timestamp)){const t=a.getInnerFormatter().formatDate(l.timestamp,"YYYY-MM-DD HH:mm","crosshair");i.push({type:"text",attrs:{x:e.x,y:0,text:t,align:"center"},ignoreEvent:!0})}}),e.length>1&&i.unshift({type:"rect",attrs:{x:r,y:0,width:o-r,height:s.getBounding().height},ignoreEvent:!0})}return i}getFigures(t,e){const i=this.getWidget(),s=i.getPane(),a=s.getChart(),r=s.getAxisComponent(),n=a.getXAxisPane().getAxisComponent(),o=i.getBounding();return t.createXAxisFigures?.({chart:a,overlay:t,coordinates:e,bounding:o,xAxis:n,yAxis:r})??[]}}class ui extends ai{compare(t){return o(t.timestamp)}getDirectionStyles(t){return t.vertical}getText(t,e){const i=t.timestamp;return e.getInnerFormatter().formatDate(i,he[e.getPeriod()?.type??"day"],"crosshair")}getTextAttrs(t,e,i,s,a,r){const n=i.realX;let o=0,l="center";return n-e/2-r.paddingLeft<0?(o=0,l="left"):n+e/2+r.paddingRight>s.width?(o=s.width,l="right"):o=n,{x:o,y:0,text:t,align:l,baseline:"top"}}}class gi extends Oe{_xAxisView=new hi(this);_overlayXAxisView=new di(this);_crosshairVerticalLabelView=new ui(this);constructor(t,e){super(t,e),this.setCursor("ew-resize"),this.addChild(this._overlayXAxisView)}getName(){return Ae}updateMain(t){this._xAxisView.draw(t)}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}class pi extends oi{createAxisComponent(t){const e=function(t){return ue[t]??ue.normal}(t);return new e(this)}createMainWidget(t){return new gi(t,this)}}class mi extends Le{_dragFlag=!1;_dragStartY=0;_topPaneHeight=0;_bottomPaneHeight=0;_topPane=null;_bottomPane=null;constructor(t,e){super(t,e),this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return Be}_mouseDownEvent(t){this._dragFlag=!0,this._dragStartY=t.pageY;const e=this.getPane(),i=e.getChart();this._topPane=e.getTopPane(),this._bottomPane=e.getBottomPane();const s=i.getDrawPanes();if("minimize"===this._topPane.getOptions().state){const t=s.findIndex(t=>t.getId()===this._topPane?.getId());for(let e=t-1;e>-1;e--){const t=s[e];if("minimize"!==t.getOptions().state){this._topPane=t;break}}}if("minimize"===this._bottomPane.getOptions().state){const t=s.findIndex(t=>t.getId()===this._bottomPane?.getId());for(let e=t+1;e<s.length;e++){const t=s[e];if("minimize"!==t.getOptions().state){this._bottomPane=t;break}}}return this._topPaneHeight=this._topPane.getBounding().height,this._bottomPaneHeight=this._bottomPane.getBounding().height,!0}_mouseUpEvent(){return this._dragFlag=!1,this._topPane=null,this._bottomPane=null,this._topPaneHeight=0,this._bottomPaneHeight=0,this._mouseLeaveEvent()}_pressedMouseMoveEvent=function(t,e){let i=0;return function(){const s=Date.now();s-i>e&&(t.apply(this,arguments),i=s)}}(this._pressedTouchMouseMoveEvent,20);_pressedTouchMouseMoveEvent(t){const e=t.pageY-this._dragStartY,i=e<0;if(o(this._topPane)&&o(this._bottomPane)){const t=this._bottomPane.getOptions();if("minimize"!==this._topPane.getOptions().state&&"minimize"!==t.state&&t.dragEnabled){let t=null,s=null,a=0,r=0;i?(t=this._topPane,s=this._bottomPane,a=this._topPaneHeight,r=this._bottomPaneHeight):(t=this._bottomPane,s=this._topPane,a=this._bottomPaneHeight,r=this._topPaneHeight);const n=t.getOptions().minHeight;if(a>n){const i=Math.max(a-Math.abs(e),n),o=a-i;t.setBounding({height:i}),s.setBounding({height:r+o});const l=this.getPane(),c=l.getChart();c.getChartStore().executeAction("onPaneDrag",{paneId:l.getId()}),c.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getBottomPane().getOptions().dragEnabled){const e=t.getChart().getStyles().separator;return this.getContainer().style.background=e.activeBackgroundColor,!0}return!1}_mouseLeaveEvent(){return!this._dragFlag&&(this.getContainer().style.background="transparent",!0)}createContainer(){return Pe("div",{width:"100%",height:"7px",margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"})}updateImp(t,e,i){if(4===i||2===i){const e=this.getPane().getChart().getStyles().separator;t.style.top=-Math.floor((7-e.size)/2)+"px",t.style.height="7px"}}}class yi extends ni{_topPane;_bottomPane;_separatorWidget;constructor(t,e,i,s){super(t,e),this.getContainer().style.overflow="",this._topPane=i,this._bottomPane=s,this._separatorWidget=new mi(this.getContainer(),this)}setBounding(t){return e(this.getBounding(),t),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getWidget(){return this._separatorWidget}getImage(t){const{width:e,height:i}=this.getBounding(),s=this.getChart().getStyles().separator,a=Pe("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),r=a.getContext("2d"),n=I(a);return a.width=e*n,a.height=i*n,r.scale(n,n),r.fillStyle=s.color,r.fillRect(0,0,e,i),a}updateImp(t,e,i){if(4===t||2===t){const s=this.getChart().getStyles().separator;e.style.backgroundColor=s.color,e.style.height=`${i.height}px`,e.style.marginLeft=`${i.left}px`,e.style.width=`${i.width}px`,this._separatorWidget.update(t)}}}function xi(){return"undefined"!=typeof window&&window.navigator.userAgent.toLowerCase().includes("firefox")}function fi(){return"undefined"!=typeof window&&/iPhone|iPad|iPod|iOS/.test(window.navigator.userAgent)}const _i=500,vi=500,bi=500,Ei=5,Ci=5,wi=5,Pi=30,Si=0,Ii=1,Di=2;class Ti{_target;_handler;_options;_clickCount=0;_clickTimeoutId=null;_clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY};_tapCount=0;_tapTimeoutId=null;_tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY};_longTapTimeoutId=null;_longTapActive=!1;_mouseMoveStartCoordinate=null;_touchMoveStartCoordinate=null;_touchMoveExceededManhattanDistance=!1;_cancelClick=!1;_cancelTap=!1;_unsubscribeOutsideMouseEvents=null;_unsubscribeOutsideTouchEvents=null;_unsubscribeMobileSafariEvents=null;_unsubscribeMousemove=null;_unsubscribeMouseWheel=null;_unsubscribeContextMenu=null;_unsubscribeRootMouseEvents=null;_unsubscribeRootTouchEvents=null;_startPinchMiddleCoordinate=null;_startPinchDistance=0;_pinchPrevented=!1;_preventTouchDragProcess=!1;_mousePressed=!1;_lastTouchEventTimeStamp=0;_activeTouchId=null;_acceptMouseLeave=!fi();constructor(t,e,i){this._target=t,this._handler=e,this._options=i,this._init()}destroy(){null!==this._unsubscribeOutsideMouseEvents&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),null!==this._unsubscribeOutsideTouchEvents&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeMouseWheel&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),null!==this._unsubscribeContextMenu&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),null!==this._unsubscribeMobileSafariEvents&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(t){this._unsubscribeMousemove?.(),this._unsubscribeMouseWheel?.(),this._unsubscribeContextMenu?.();const e=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",e)},this._target.addEventListener("mousemove",e);const i=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",i)},this._target.addEventListener("wheel",i,{passive:!1});const s=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",s)},this._target.addEventListener("contextmenu",s,{passive:!1}),this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){null!==this._tapTimeoutId&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(t){this._mousePressed||null!==this._touchMoveStartCoordinate||this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(t){this._preventDefault(t);const e=this._makeCompatEvent(t);if(Math.abs(t.deltaX)>0&&o(this._handler.mouseWheelHortEvent)&&this._handler.mouseWheelHortEvent(e,-t.deltaX),o(this._handler.mouseWheelVertEvent)){let i=-t.deltaY/100;if(0!==i){switch(t.deltaMode){case t.DOM_DELTA_PAGE:i*=120;break;case t.DOM_DELTA_LINE:i*=32}if(0!==i){const t=Math.sign(i)*Math.min(1,Math.abs(i));this._handler.mouseWheelVertEvent(e,t)}}}}_contextMenuHandler(t){this._preventDefault(t)}_touchMoveHandler(t){const e=this._touchWithId(t.changedTouches,this._activeTouchId);if(null===e)return;if(this._lastTouchEventTimeStamp=this._eventTimeStamp(t),null!==this._startPinchMiddleCoordinate)return;if(this._preventTouchDragProcess)return;this._pinchPrevented=!0;const i=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._touchMoveStartCoordinate),{xOffset:s,yOffset:a,manhattanDistance:r}=i;if(this._touchMoveExceededManhattanDistance||!(r<Ci)){if(!this._touchMoveExceededManhattanDistance){const t=.5*s,e=a>=t&&!this._options.treatVertDragAsPageScroll(),i=t>a&&!this._options.treatHorzDragAsPageScroll();e||i||(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(t,e),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(t){if(t.button!==Si)return;const e=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._mouseMoveStartCoordinate),{manhattanDistance:i}=e;i>=Ei&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(t,e){const i=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y);return{xOffset:i,yOffset:s,manhattanDistance:i+s}}_onFirefoxOutsideMouseUp=t=>{this._mouseUpHandler(t)};_onMobileSafariDoubleClick=t=>{if(this._firesTouchEvents(t)){if(++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:e}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate);e<Pi&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(t),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:e}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate);e<wi&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}};_touchEndHandler(t){let e=this._touchWithId(t.changedTouches,this._activeTouchId);if(null===e&&0===t.touches.length&&(e=t.changedTouches[0]),null===e)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(t),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const i=this._makeCompatEvent(t,e);if(this._processEvent(i,this._handler.touchEndEvent),++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);t<Pi&&!this._cancelTap&&this._processEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(i,this._handler.tapEvent),o(this._handler.tapEvent)&&this._preventDefault(t));0===this._tapCount&&this._preventDefault(t),0===t.touches.length&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(t))}_mouseUpHandler(t){if(t.button!==Si)return;const e=this._makeCompatEvent(t);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),xi()){this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp)}if(!this._firesTouchEvents(t))if(this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate);i<wi&&!this._cancelClick&&this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent)}_clearLongTapTimeout(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(t){if(null!==this._activeTouchId)return;const e=t.changedTouches[0];this._activeTouchId=e.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(t);const i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(e),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const e=this._touchMoveHandler.bind(this),s=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",e),i.removeEventListener("touchend",s)},i.addEventListener("touchmove",e,{passive:!1}),i.addEventListener("touchend",s,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),vi)}this._processEvent(this._makeCompatEvent(t,e),this._handler.touchStartEvent),null===this._tapTimeoutId&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),_i),this._tapCoordinate=this._getCoordinate(e))}_mouseDownHandler(t){if(t.button===Di)return this._preventDefault(t),void this._processEvent(this._makeCompatEvent(t),this._handler.mouseRightClickEvent);if(t.button!==Si)return;const e=this._target.ownerDocument.documentElement;xi()&&e.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(t),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const t=this._mouseMoveWithDownHandler.bind(this),i=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",i)},e.addEventListener("mousemove",t),e.addEventListener("mouseup",i)}this._mousePressed=!0,this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseDownEvent),null===this._clickTimeoutId&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),_i),this._clickCoordinate=this._getCoordinate(t)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const t=this._target.ownerDocument,e=t=>{null!=this._handler.mouseDownOutsideEvent&&(t.composed&&this._target.contains(t.composedPath()[0])||null!==t.target&&this._target.contains(t.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{t.removeEventListener("touchstart",e)},this._unsubscribeOutsideMouseEvents=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}fi()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",t=>{if(t.button===Ii)return t.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}_initPinch(){(o(this._handler.pinchStartEvent)||o(this._handler.pinchEvent)||o(this._handler.pinchEndEvent))&&(this._target.addEventListener("touchstart",t=>{this._checkPinchState(t.touches)},{passive:!0}),this._target.addEventListener("touchmove",t=>{if(2===t.touches.length&&null!==this._startPinchMiddleCoordinate&&o(this._handler.pinchEvent)){const e=this._getTouchDistance(t.touches[0],t.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},e),this._preventDefault(t)}},{passive:!1}),this._target.addEventListener("touchend",t=>{this._checkPinchState(t.touches)}))}_checkPinchState(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}_startPinch(t){const e=this._target.getBoundingClientRect();this._startPinchMiddleCoordinate={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=this._getTouchDistance(t[0],t[1]),o(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){null!==this._startPinchMiddleCoordinate&&(this._startPinchMiddleCoordinate=null,o(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(t){this._unsubscribeMousemove?.(),this._unsubscribeMouseWheel?.(),this._unsubscribeContextMenu?.(),this._firesTouchEvents(t)||this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!fi())}_longTapHandler(t){const e=this._touchWithId(t.touches,this._activeTouchId);null!==e&&(this._processEvent(this._makeCompatEvent(t,e),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(t){return o(t.sourceCapabilities?.firesTouchEvents)?t.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(t)<this._lastTouchEventTimeStamp+bi}_processEvent(t,e){e?.call(this._handler,t)}_makeCompatEvent(t,e){const i=e??t,s=this._target.getBoundingClientRect();return{x:i.clientX-s.left,y:i.clientY-s.top,pageX:i.pageX,pageY:i.pageY,isTouch:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type&&"wheel"!==t.type,preventDefault:()=>{"touchstart"!==t.type&&this._preventDefault(t)}}}_getTouchDistance(t,e){const i=t.clientX-e.clientX,s=t.clientY-e.clientY;return Math.sqrt(i*i+s*s)}_preventDefault(t){t.cancelable&&t.preventDefault()}_getCoordinate(t){return{x:t.pageX,y:t.pageY}}_eventTimeStamp(t){return t.timeStamp??performance.now()}_touchWithId(t,e){for(let i=0;i<t.length;++i)if(t[i].identifier===e)return t[i];return null}}class Mi{_container;_chart;_event;_flingStartTime=(new Date).getTime();_flingScrollRequestId=null;_startScrollCoordinate=null;_touchCoordinate=null;_touchCancelCrosshair=!1;_touchZoomed=!1;_pinchScale=1;_mouseDownWidget=null;_prevYAxisRange=null;_xAxisStartScaleCoordinate=null;_xAxisStartScaleDistance=0;_xAxisScale=1;_yAxisStartScaleDistance=0;_mouseMoveTriggerWidgetInfo={pane:null,widget:null};_boundKeyBoardDownEvent=t=>{if(t.shiftKey)switch(t.code){case"Equal":this._chart.getChartStore().zoom(.5,null,"main");break;case"Minus":this._chart.getChartStore().zoom(-.5,null,"main");break;case"ArrowLeft":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(-3*t.getBarSpace().bar);break}case"ArrowRight":{const t=this._chart.getChartStore();t.startScroll(),t.scroll(3*t.getBarSpace().bar);break}}};constructor(t,e){this._container=t,this._chart=e,this._event=new Ti(t,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),t.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(t,e){const{pane:i,widget:s}=this._findWidgetByEvent(t);if(i?.getId()!==ge.X_AXIS&&s?.getName()===Fe){const i=this._makeWidgetEvent(t,s),a=5*(e-this._pinchScale);return this._pinchScale=e,this._chart.getChartStore().zoom(a,{x:i.x,y:i.y},"main"),!0}return!1}mouseWheelHortEvent(t,e){const i=this._chart.getChartStore();return i.startScroll(),i.scroll(e),!0}mouseWheelVertEvent(t,e){const{widget:i}=this._findWidgetByEvent(t),s=this._makeWidgetEvent(t,i),a=i?.getName();return a===Fe&&(this._chart.getChartStore().zoom(e,{x:s.x,y:s.y},"main"),!0)}mouseDownEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(this._mouseDownWidget=i,null!==i){const s=this._makeWidgetEvent(t,i);switch(i.getName()){case Be:return i.dispatchEvent("mouseDownEvent",s);case Fe:{const t=e.getAxisComponent();if(!t.getAutoCalcTickFlag()){const e=t.getRange();this._prevYAxisRange={...e}}return this._startScrollCoordinate={x:s.x,y:s.y},this._chart.getChartStore().startScroll(),i.dispatchEvent("mouseDownEvent",s)}case Ae:return this._processXAxisScrollStartEvent(i,s);case ke:return this._processYAxisScaleStartEvent(i,s)}}return!1}mouseMoveEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t),s=this._makeWidgetEvent(t,i);if(this._mouseMoveTriggerWidgetInfo.pane?.getId()===e?.getId()&&this._mouseMoveTriggerWidgetInfo.widget?.getName()===i?.getName()||(i?.dispatchEvent("mouseEnterEvent",s),this._mouseMoveTriggerWidgetInfo.widget?.dispatchEvent("mouseLeaveEvent",s),this._mouseMoveTriggerWidgetInfo={pane:e,widget:i}),null!==i){switch(i.getName()){case Fe:{const t=i.dispatchEvent("mouseMoveEvent",s);let a={x:s.x,y:s.y,paneId:e?.getId()};return t?("pointer"!==i.getForceCursor()&&(a=void 0),i.setCursor("pointer")):i.setCursor("crosshair"),this._chart.getChartStore().setCrosshair(a),t}case Be:case Ae:case ke:{const t=i.dispatchEvent("mouseMoveEvent",s);return this._chart.getChartStore().setCrosshair(),t}}}return!1}pressedMouseMoveEvent(t){if(null!==this._mouseDownWidget&&this._mouseDownWidget.getName()===Be)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",t);const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i&&this._mouseDownWidget?.getPane().getId()===e?.getId()&&this._mouseDownWidget?.getName()===i.getName()){const s=this._makeWidgetEvent(t,i);switch(i.getName()){case Fe:{let t;const a=i.dispatchEvent("pressedMouseMoveEvent",s);return a||this._processMainScrollingEvent(i,s),a&&"pointer"!==i.getForceCursor()||(t={x:s.x,y:s.y,paneId:e?.getId()}),this._chart.getChartStore().setCrosshair(t,{forceInvalidate:!0}),a}case Ae:return this._processXAxisScrollingEvent(i,s);case ke:return this._processYAxisScalingEvent(i,s)}}return!1}mouseUpEvent(t){const{widget:e}=this._findWidgetByEvent(t);let i=!1;if(null!==e){const s=this._makeWidgetEvent(t,e);switch(e.getName()){case Fe:case Be:case Ae:case ke:i=e.dispatchEvent("mouseUpEvent",s)}i&&this._chart.updatePane(1)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,i}mouseClickEvent(t){const{widget:e}=this._findWidgetByEvent(t);if(null!==e){const i=this._makeWidgetEvent(t,e);return e.dispatchEvent("mouseClickEvent",i)}return!1}mouseRightClickEvent(t){const{widget:e}=this._findWidgetByEvent(t);let i=!1;if(null!==e){const s=this._makeWidgetEvent(t,e);switch(e.getName()){case Fe:case Ae:case ke:i=e.dispatchEvent("mouseRightClickEvent",s)}i&&this._chart.updatePane(1)}return!1}mouseDoubleClickEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i){switch(i.getName()){case Fe:{const e=this._makeWidgetEvent(t,i);return i.dispatchEvent("mouseDoubleClickEvent",e)}case ke:{const t=e.getAxisComponent();if(!t.getAutoCalcTickFlag())return t.setAutoCalcTickFlag(!0),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}),!0;break}}}return!1}mouseLeaveEvent(){return this._chart.getChartStore().setCrosshair(),!0}touchStartEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i){const s=this._makeWidgetEvent(t,i);s.preventDefault?.();switch(i.getName()){case Fe:{const t=this._chart.getChartStore();if(i.dispatchEvent("mouseDownEvent",s))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,t.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(1),!0;null!==this._flingScrollRequestId&&(ve(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=(new Date).getTime();const a=e.getAxisComponent();if(!a.getAutoCalcTickFlag()){const t=a.getRange();this._prevYAxisRange={...t}}if(this._startScrollCoordinate={x:s.x,y:s.y},t.startScroll(),this._touchZoomed=!1,null!==this._touchCoordinate){const i=s.x-this._touchCoordinate.x,a=s.y-this._touchCoordinate.y;Math.sqrt(i*i+a*a)<10?(this._touchCoordinate={x:s.x,y:s.y},t.setCrosshair({x:s.x,y:s.y,paneId:e?.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,t.setCrosshair())}return!0}case Ae:return this._processXAxisScrollStartEvent(i,s);case ke:return this._processYAxisScaleStartEvent(i,s)}}return!1}touchMoveEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i){const s=this._makeWidgetEvent(t,i),a=i.getName(),r=this._chart.getChartStore();switch(a){case Fe:return i.dispatchEvent("pressedMouseMoveEvent",s)?(s.preventDefault?.(),r.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(1),!0):(null!==this._touchCoordinate?(s.preventDefault?.(),r.setCrosshair({x:s.x,y:s.y,paneId:e?.getId()})):this._processMainScrollingEvent(i,s),!0);case Ae:return s.preventDefault?.(),this._processXAxisScrollingEvent(i,s);case ke:return this._processYAxisScalingEvent(i,s)}}return!1}touchEndEvent(t){const{widget:e}=this._findWidgetByEvent(t);if(null!==e){const i=this._makeWidgetEvent(t,e);switch(e.getName()){case Fe:if(e.dispatchEvent("mouseUpEvent",i),null!==this._startScrollCoordinate){const t=(new Date).getTime()-this._flingStartTime;let e=(i.x-this._startScrollCoordinate.x)/(t>0?t:1)*20;if(t<200&&Math.abs(e)>0){const t=this._chart.getChartStore(),i=()=>{this._flingScrollRequestId=_e(()=>{t.startScroll(),t.scroll(e),e*=.975,Math.abs(e)<1?null!==this._flingScrollRequestId&&(ve(this._flingScrollRequestId),this._flingScrollRequestId=null):i()})};i()}}return!0;case Ae:case ke:e.dispatchEvent("mouseUpEvent",i)&&this._chart.updatePane(1)}this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0}return!1}tapEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);let s=!1;if(null!==i){const a=this._makeWidgetEvent(t,i),r=i.dispatchEvent("mouseClickEvent",a);if(i.getName()===Fe){const a=this._makeWidgetEvent(t,i),n=this._chart.getChartStore();r?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,n.setCrosshair(void 0,{notInvalidate:!0}),s=!0):(this._touchCancelCrosshair||this._touchZoomed||(this._touchCoordinate={x:a.x,y:a.y},n.setCrosshair({x:a.x,y:a.y,paneId:e?.getId()},{notInvalidate:!0}),s=!0),this._touchCancelCrosshair=!1)}(s||r)&&this._chart.updatePane(1)}return s}doubleTapEvent(t){return this.mouseDoubleClickEvent(t)}longTapEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i&&i.getName()===Fe){const s=this._makeWidgetEvent(t,i);return this._touchCoordinate={x:s.x,y:s.y},this._chart.getChartStore().setCrosshair({x:s.x,y:s.y,paneId:e?.getId()}),!0}return!1}_processMainScrollingEvent(t,e){if(null!==this._startScrollCoordinate){const i=t.getPane().getAxisComponent();if(null!==this._prevYAxisRange&&!i.getAutoCalcTickFlag()&&i.scrollZoomEnabled){e.preventDefault?.();const{from:s,to:a,range:r}=this._prevYAxisRange;let n=0;n=i.reverse?this._startScrollCoordinate.y-e.y:e.y-this._startScrollCoordinate.y;const o=r*(n/t.getBounding().height),l=s+o,c=a+o,h=i.valueToRealValue(l,{range:this._prevYAxisRange}),d=i.valueToRealValue(c,{range:this._prevYAxisRange}),u=i.realValueToDisplayValue(h,{range:this._prevYAxisRange}),g=i.realValueToDisplayValue(d,{range:this._prevYAxisRange});i.setRange({from:l,to:c,range:c-l,realFrom:h,realTo:d,realRange:d-h,displayFrom:u,displayTo:g,displayRange:g-u})}const s=e.x-this._startScrollCoordinate.x;this._chart.getChartStore().scroll(s)}}_processXAxisScrollStartEvent(t,e){const i=t.dispatchEvent("mouseDownEvent",e);return i&&this._chart.updatePane(1),this._xAxisStartScaleCoordinate={x:e.x,y:e.y},this._xAxisStartScaleDistance=e.pageX,i}_processXAxisScrollingEvent(t,e){const i=t.dispatchEvent("pressedMouseMoveEvent",e);if(i)this._chart.updatePane(1);else{if(t.getPane().getAxisComponent().scrollZoomEnabled&&0!==this._xAxisStartScaleDistance){const t=this._xAxisStartScaleDistance/e.pageX;if(Number.isFinite(t)){const e=10*(t-this._xAxisScale);this._xAxisScale=t,this._chart.getChartStore().zoom(e,this._xAxisStartScaleCoordinate,"xAxis")}}}return i}_processYAxisScaleStartEvent(t,e){const i=t.dispatchEvent("mouseDownEvent",e);i&&this._chart.updatePane(1);const s=t.getPane().getAxisComponent().getRange();return this._prevYAxisRange={...s},this._yAxisStartScaleDistance=e.pageY,i}_processYAxisScalingEvent(t,e){const i=t.dispatchEvent("pressedMouseMoveEvent",e);if(i)this._chart.updatePane(1);else{const i=t.getPane().getAxisComponent();if(null!==this._prevYAxisRange&&i.scrollZoomEnabled&&0!==this._yAxisStartScaleDistance){e.preventDefault?.();const{from:t,to:s,range:a}=this._prevYAxisRange,r=a*(e.pageY/this._yAxisStartScaleDistance),n=(r-a)/2,o=t-n,l=s+n,c=i.valueToRealValue(o,{range:this._prevYAxisRange}),h=i.valueToRealValue(l,{range:this._prevYAxisRange}),d=i.realValueToDisplayValue(c,{range:this._prevYAxisRange}),u=i.realValueToDisplayValue(h,{range:this._prevYAxisRange});i.setRange({from:o,to:l,range:r,realFrom:c,realTo:h,realRange:h-c,displayFrom:d,displayTo:u,displayRange:u-d}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})}}return i}_findWidgetByEvent(t){const{x:e,y:i}=t,s=this._chart.getSeparatorPanes(),a=this._chart.getStyles().separator.size;for(const t of s){const s=t[1],r=s.getBounding(),n=r.top-Math.round((7-a)/2);if(e>=r.left&&e<=r.left+r.width&&i>=n&&i<=n+7)return{pane:s,widget:s.getWidget()}}const r=this._chart.getDrawPanes();let n=null;for(const t of r){const s=t.getBounding();if(e>=s.left&&e<=s.left+s.width&&i>=s.top&&i<=s.top+s.height){n=t;break}}let l=null;if(null!==n){if(!o(l)){const t=n.getMainWidget(),s=t.getBounding();e>=s.left&&e<=s.left+s.width&&i>=s.top&&i<=s.top+s.height&&(l=t)}if(!o(l)){const t=n.getYAxisWidget();if(null!==t){const s=t.getBounding();e>=s.left&&e<=s.left+s.width&&i>=s.top&&i<=s.top+s.height&&(l=t)}}}return{pane:n,widget:l}}_makeWidgetEvent(t,e){const i=e?.getBounding()??null;return{...t,x:t.x-(i?.left??0),y:t.y-(i?.top??0)}}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()}}class Fi{id;_container;_chartContainer;_chartBounding=fe();_chartEvent;_chartStore;_drawPanes=[];_candlePane;_xAxisPane;_separatorPanes=new Map;_layoutOptions={sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1};_layoutPending=!1;_cacheYAxisWidth={left:0,right:0};constructor(t,e){this._initContainer(t),this._chartEvent=new Mi(this._chartContainer,this),this._chartStore=new Me(this,e),this._initPanes(e),this._layout()}_initContainer(t){this._container=t,this._chartContainer=Pe("div",{position:"relative",width:"100%",height:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",overflow:"hidden",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer),this._cacheChartBounding()}_cacheChartBounding(){this._chartBounding.width=Math.floor(this._chartContainer.clientWidth),this._chartBounding.height=Math.floor(this._chartContainer.clientHeight)}_initPanes(t){const i=t=>{if(!o(this._candlePane)){const i=t.options??{};e(i,{id:ge.CANDLE}),this._candlePane=this._createPane(ci,ge.CANDLE,i);(t.content??[]).forEach(t=>{this.createIndicator(t,!0,i)})}},s=t=>{if(!o(this._xAxisPane)){const e=this._createPane(pi,ge.X_AXIS,t??{});this._xAxisPane=e}};(t?.layout??[{type:"candle"}]).forEach(t=>{switch(t.type){case"candle":i(t);break;case"indicator":{const e=t.content??[];if(e.length>0){let i=t.options?.id??null;o(i)&&(i=we(ge.INDICATOR));const s={...t.options,id:i};e.forEach(t=>{this.createIndicator(t,!0,s)})}break}case"xAxis":s(t.options)}}),i({}),s({order:Number.MAX_SAFE_INTEGER})}_createPane(t,e,i){const s=new t(this,e,i??{});return this._drawPanes.push(s),s}_recalculatePaneHeight(t,e,i){if(0===i)return!1;const s=this._drawPanes.filter(e=>{const i=e.getId();return"normal"===e.getOptions().state&&i!==t.getId()&&i!==ge.X_AXIS}),a=s.length;if(0===a)return!1;if(t.getId()!==ge.CANDLE&&o(this._candlePane)&&"normal"===this._candlePane.getOptions().state){const t=this._candlePane.getBounding().height;if(t>0){const s=this._candlePane.getOptions().minHeight;let a=t+i;a<s&&(a=s,e-=t+i-a),this._candlePane.setBounding({height:a})}}else{let t=i;const r=Math.floor(i/a);s.forEach((e,i)=>{const s=e.getBounding().height;let n=0;n=i===a-1?s+t:s+r,n<e.getOptions().minHeight&&(n=e.getOptions().minHeight),e.setBounding({height:n}),t-=n-s}),Math.abs(t)>0&&(e-=t)}return t.setBounding({height:e}),!0}getDrawPaneById(t){if(t===ge.CANDLE)return this._candlePane;if(t===ge.X_AXIS)return this._xAxisPane;return this._drawPanes.find(e=>e.getId()===t)??null}getContainer(){return this._container}getChartStore(){return this._chartStore}getXAxisPane(){return this._xAxisPane}getDrawPanes(){return this._drawPanes}getSeparatorPanes(){return this._separatorPanes}layout(t){t.sort&&(this._layoutOptions.sort=t.sort),t.measureHeight&&(this._layoutOptions.measureHeight=t.measureHeight),t.measureWidth&&(this._layoutOptions.measureWidth=t.measureWidth),t.update&&(this._layoutOptions.update=t.update),t.buildYAxisTick&&(this._layoutOptions.buildYAxisTick=t.buildYAxisTick),t.cacheYAxisWidth&&(this._layoutOptions.cacheYAxisWidth=t.cacheYAxisWidth),t.buildYAxisTick&&(this._layoutOptions.forceBuildYAxisTick=t.forceBuildYAxisTick),this._layoutPending||(this._layoutPending=!0,Promise.resolve().then(t=>{this._layout(),this._layoutPending=!1}).catch(t=>{}))}_layout(){const{sort:t,measureHeight:e,measureWidth:i,update:s,buildYAxisTick:a,cacheYAxisWidth:r,forceBuildYAxisTick:n}=this._layoutOptions;if(t){for(;o(this._chartContainer.firstChild);)this._chartContainer.removeChild(this._chartContainer.firstChild);this._separatorPanes.clear(),this._drawPanes.sort((t,e)=>t.getOptions().order-e.getOptions().order);let t=null;this._drawPanes.forEach(e=>{if(e.getId()!==ge.X_AXIS){if(o(t)){const i=new yi(this,"",t,e);this._chartContainer.appendChild(i.getContainer()),this._separatorPanes.set(e,i)}t=e}this._chartContainer.appendChild(e.getContainer())})}if(e){const t=this._chartBounding.height,e=this.getStyles().separator.size,i=this._xAxisPane.getAxisComponent().getAutoSize();let s=t-i;s<0&&(s=0),this._drawPanes.forEach(t=>{const i=t.getId();if(o(this._separatorPanes.get(t))&&(s-=e),i!==ge.X_AXIS&&i!==ge.CANDLE&&t.getVisible()){let e=t.getBounding().height;e>s?(e=s,s=0):s-=e,t.setBounding({height:e})}}),this._candlePane.setBounding({height:Math.max(s,0)}),this._xAxisPane.setBounding({height:i});let a=0;this._drawPanes.forEach(t=>{const i=this._separatorPanes.get(t);o(i)&&(i.setBounding({height:e,top:a}),a+=e),t.setBounding({top:a}),a+=t.getBounding().height})}let l=i;if((a||n)&&this._drawPanes.forEach(t=>{const e=t.getAxisComponent().buildTicks(n);l||=e}),l){const t=this._chartBounding.width,e=this.getStyles();let i=0,s=!0,a=0,n=!0;this._drawPanes.forEach(t=>{if(t.getId()!==ge.X_AXIS){const e=t.getAxisComponent(),r=e.inside,o=e.getAutoSize();"left"===e.position?(i=Math.max(i,o),r&&(s=!1)):(a=Math.max(a,o),r&&(n=!1))}}),r&&(i=Math.max(this._cacheYAxisWidth.left,i),a=Math.max(this._cacheYAxisWidth.right,a)),this._cacheYAxisWidth.left=i,this._cacheYAxisWidth.right=a;let o=t,l=0,c=0;s&&(o-=i,l=i),n&&(o-=a,c=a),this._chartStore.setTotalBarSpace(o);const h={width:t},d={width:o,left:l,right:c},u={width:i},g={width:a},p=e.separator.fill;let m={};m=p?h:d,this._drawPanes.forEach(t=>{this._separatorPanes.get(t)?.setBounding(m),t.setBounding(h,d,u,g)})}s&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(4)),this._layoutOptions={sort:!1,measureHeight:!1,measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1}}updatePane(t,e){if(o(e)){const i=this.getDrawPaneById(e);i?.update(t)}else this._drawPanes.forEach(e=>{e.update(t),this._separatorPanes.get(e)?.update(t)})}getDom(t,e){if(!o(t))return this._chartContainer;{const i=this.getDrawPaneById(t);if(o(i)){switch(e??"root"){case"root":return i.getContainer();case"main":return i.getMainWidget().getContainer();case"yAxis":return i.getYAxisWidget()?.getContainer()??null}}}return null}getSize(t,e){if(!o(t))return this._chartBounding;{const i=this.getDrawPaneById(t);if(o(i)){switch(e??"root"){case"root":return i.getBounding();case"main":return i.getMainWidget().getBounding();case"yAxis":return i.getYAxisWidget()?.getBounding()??null}}}return null}_resetYAxisAutoCalcTickFlag(){this._drawPanes.forEach(t=>{t.getAxisComponent().setAutoCalcTickFlag(!0)})}setSymbol(t){t!==this.getSymbol()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setSymbol(t))}getSymbol(){return this._chartStore.getSymbol()}setPeriod(t){t!==this.getPeriod()&&(this._resetYAxisAutoCalcTickFlag(),this._chartStore.setPeriod(t))}getPeriod(){return this._chartStore.getPeriod()}setStyles(t){this._setOptions(()=>{this._chartStore.setStyles(t)})}getStyles(){return this._chartStore.getStyles()}setFormatter(t){this._setOptions(()=>{this._chartStore.setFormatter(t)})}getFormatter(){return this._chartStore.getFormatter()}setLocale(t){this._setOptions(()=>{this._chartStore.setLocale(t)})}getLocale(){return this._chartStore.getLocale()}setTimezone(t){this._setOptions(()=>{this._chartStore.setTimezone(t)})}getTimezone(){return this._chartStore.getTimezone()}setThousandsSeparator(t){this._setOptions(()=>{this._chartStore.setThousandsSeparator(t)})}getThousandsSeparator(){return this._chartStore.getThousandsSeparator()}setDecimalFold(t){this._setOptions(()=>{this._chartStore.setDecimalFold(t)})}getDecimalFold(){return this._chartStore.getDecimalFold()}_setOptions(t){t(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}setOffsetRightDistance(t){this._chartStore.setOffsetRightDistance(t,!0)}getOffsetRightDistance(){return this._chartStore.getOffsetRightDistance()}setMaxOffsetLeftDistance(t){t<0||this._chartStore.setMaxOffsetLeftDistance(t)}setMaxOffsetRightDistance(t){t<0||this._chartStore.setMaxOffsetRightDistance(t)}setLeftMinVisibleBarCount(t){t<0||this._chartStore.setLeftMinVisibleBarCount(Math.ceil(t))}setRightMinVisibleBarCount(t){t<0||this._chartStore.setRightMinVisibleBarCount(Math.ceil(t))}setBarSpace(t){this._chartStore.setBarSpace(t)}getBarSpace(){return this._chartStore.getBarSpace()}getVisibleRange(){return this._chartStore.getVisibleRange()}resetData(){this._chartStore.resetData()}getDataList(){return this._chartStore.getDataList()}setDataLoader(t){this._resetYAxisAutoCalcTickFlag(),this._chartStore.setDataLoader(t)}createIndicator(t,e,i){const s=c(t)?{name:t}:t;if(null===wt(s.name))return null;const a=i??{};c(a.id)||(a.id=we(ge.INDICATOR)),c(s.id)||(s.id=we(s.name));if(this._chartStore.addIndicator(s,a.id,e??!1)){let t=!1;return o(this.getDrawPaneById(a.id))||(this._createPane(li,a.id,a),a.height??=100,t=!0),this.setPaneOptions(a),this.layout({sort:t,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0}),s.id}return null}overrideIndicator(t){return this._chartStore.overrideIndicator(t)}getIndicators(t){return this._chartStore.getIndicatorsByFilter(t??{})}removeIndicator(t){const e=this._chartStore.removeIndicator(t??{});if(e){let t=!1;const e=[];this._drawPanes.forEach(t=>{const i=t.getId();i!==ge.CANDLE&&i!==ge.X_AXIS&&e.push(i)}),e.forEach(e=>{if(!this._chartStore.hasIndicators(e)){const i=this._drawPanes.findIndex(t=>t.getId()===e),s=this._drawPanes[i];o(s)&&(t=!0,this._recalculatePaneHeight(s,0,s.getBounding().height),this._drawPanes.splice(i,1),s.destroy())}}),2===this._drawPanes.length&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:t,measureHeight:t,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return e}createOverlay(t){const e=[],i=[],a=t=>{o(t.paneId)&&null!==this.getDrawPaneById(t.paneId)?i.push(!0):(t.paneId=ge.CANDLE,i.push(!1)),e.push(t)};c(t)?a({name:t}):s(t)?t.forEach(t=>{let e=null;e=c(t)?{name:t}:t,a(e)}):a(t);const r=this._chartStore.addOverlays(e,i);return s(t)?r:r[0]}getOverlays(t){return this._chartStore.getOverlaysByFilter(t??{})}overrideOverlay(t){return this._chartStore.overrideOverlay(t)}removeOverlay(t){return this._chartStore.removeOverlay(t??{})}setPaneOptions(t){let e=!1,i=!1;const s=o(t.id);for(const a of this._drawPanes){const r=a.getId();if(s&&t.id===r||!s){if(r!==ge.X_AXIS){if(n(t.height)&&t.height>0){const s=Math.max(t.minHeight??a.getOptions().minHeight,0),r=Math.max(s,t.height);i=!0,e=!0,a.setOriginalBounding({height:r}),this._recalculatePaneHeight(a,r,-r)}if(o(t.state)&&a.getOptions().state!==t.state){e=!0,i=!0;const s=t.state;switch(s){case"maximize":if(!o(this._drawPanes.find(t=>{const e=t.getId();return"maximize"===t.getOptions().state&&e!==ge.X_AXIS}))){"normal"===a.getOptions().state&&a.setOriginalBounding({height:a.getBounding().height}),a.setOptions({state:s});const t=this._chartBounding.height;a.setBounding({height:t-this._xAxisPane.getBounding().height}),this._drawPanes.forEach(t=>{t.getId()!==ge.X_AXIS&&t.getId()!==r&&(t.setBounding({height:t.getOriginalBounding().height}),t.setVisible(!1),this._separatorPanes.get(t)?.setVisible(!1))})}break;case"minimize":{const t=a.getBounding().height,e=a.getOptions().state;let i=t-30;"maximize"===e&&(i=a.getOriginalBounding().height-30),this._recalculatePaneHeight(a,30,i)&&("normal"===e&&a.setOriginalBounding({height:t}),a.setOptions({state:s})),this._drawPanes.forEach(t=>{t.getId()!==ge.X_AXIS&&(t.setVisible(!0),this._separatorPanes.get(t)?.setVisible(!0))});break}default:{const t=a.getOriginalBounding().height;this._recalculatePaneHeight(a,t,a.getBounding().height-t)&&a.setOptions({state:s}),this._drawPanes.forEach(t=>{t.getId()!==ge.X_AXIS&&(t.setVisible(!0),this._separatorPanes.get(t)?.setVisible(!0))});break}}}}o(t.axis)&&(i=!0);const s={...t};if(delete s.state,a.setOptions(s),r===t.id)break}}i&&this.layout({measureHeight:e,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}getPaneOptions(t){if(o(t)){const e=this.getDrawPaneById(t);return e?.getOptions()??null}return this._drawPanes.map(t=>t.getOptions())}setZoomEnabled(t){this._chartStore.setZoomEnabled(t)}isZoomEnabled(){return this._chartStore.isZoomEnabled()}setZoomAnchor(t){this._chartStore.setZoomAnchor(t)}getZoomAnchor(){return this._chartStore.getZoomAnchor()}setScrollEnabled(t){this._chartStore.setScrollEnabled(t)}isScrollEnabled(){return this._chartStore.isScrollEnabled()}scrollByDistance(t,e){const i=n(e)&&e>0?e:0;if(this._chartStore.startScroll(),i>0){const e=new be({duration:i});e.doFrame(e=>{const s=t*(e/i);this._chartStore.scroll(s)}),e.start()}else this._chartStore.scroll(t)}scrollToRealTime(t){const{bar:e}=this._chartStore.getBarSpace(),i=(this._chartStore.getLastBarRightSideDiffBarCount()-this._chartStore.getInitialOffsetRightDistance()/e)*e;this.scrollByDistance(i,t)}scrollToDataIndex(t,e){const i=(this._chartStore.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-t))*this._chartStore.getBarSpace().bar;this.scrollByDistance(i,e)}scrollToTimestamp(t,e){const i=ut(this.getDataList(),"timestamp",t);this.scrollToDataIndex(i,e)}zoomAtCoordinate(t,e,i){const s=n(i)&&i>0?i:0,{bar:a}=this._chartStore.getBarSpace(),r=a*t-a;if(s>0){let t=0;const i=new be({duration:s});i.doFrame(i=>{const a=r*(i/s),n=(a-t)/this._chartStore.getBarSpace().bar*10;this._chartStore.zoom(n,e??null,"main"),t=a}),i.start()}else this._chartStore.zoom(r/a*10,e??null,"main")}zoomAtDataIndex(t,e,i){const s=this._chartStore.dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:s,y:0},i)}zoomAtTimestamp(t,e,i){const s=ut(this.getDataList(),"timestamp",e);this.zoomAtDataIndex(t,s,i)}convertToPixel(t,e){const{paneId:i=ge.CANDLE,absolute:a=!1}=e??{};let r=[];if(i!==ge.X_AXIS){const e=this.getDrawPaneById(i);if(null!==e){const i=e.getBounding(),s=[].concat(t),o=this._xAxisPane.getAxisComponent(),l=e.getAxisComponent();r=s.map(t=>{const e={};let s=t.dataIndex;if(n(t.timestamp)&&(s=this._chartStore.timestampToDataIndex(t.timestamp)),n(s)&&(e.x=o.convertToPixel(s)),n(t.value)){const s=l.convertToPixel(t.value);e.y=a?i.top+s:s}return e})}}return s(t)?r:r[0]??{}}convertFromPixel(t,e){const{paneId:i=ge.CANDLE,absolute:a=!1}=e??{};let r=[];if(i!==ge.X_AXIS){const e=this.getDrawPaneById(i);if(null!==e){const i=e.getBounding(),s=[].concat(t),o=this._xAxisPane.getAxisComponent(),l=e.getAxisComponent();r=s.map(t=>{const e={};if(n(t.x)){const i=o.convertFromPixel(t.x);e.dataIndex=i,e.timestamp=this._chartStore.dataIndexToTimestamp(i)??void 0}if(n(t.y)){const s=a?t.y-i.top:t.y;e.value=l.convertFromPixel(s)}return e})}}return s(t)?r:r[0]??{}}executeAction(t,e){switch(t){case"onCrosshairChange":{let t=null;o(e)&&(t={...e},t.paneId??=ge.CANDLE),this._chartStore.setCrosshair(t,{notExecuteAction:!0});break}}}subscribeAction(t,e){this._chartStore.subscribeAction(t,e)}unsubscribeAction(t,e){this._chartStore.unsubscribeAction(t,e)}getConvertPictureUrl(t,e,i){const{width:s,height:a}=this._chartBounding,r=Pe("canvas",{width:`${s}px`,height:`${a}px`,boxSizing:"border-box"}),n=r.getContext("2d"),l=I(r);r.width=s*l,r.height=a*l,n.scale(l,l),n.fillStyle=i??"#FFFFFF",n.fillRect(0,0,s,a);const c=t??!1;return this._drawPanes.forEach(t=>{const e=this._separatorPanes.get(t);if(o(e)){const t=e.getBounding();n.drawImage(e.getImage(c),t.left,t.top,t.width,t.height)}const i=t.getBounding();n.drawImage(t.getImage(c),0,i.top,s,i.height)}),r.toDataURL(`image/${e??"jpeg"}`)}resize(){this._cacheChartBounding(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}destroy(){this._chartEvent.destroy(),this._drawPanes.forEach(t=>{t.destroy()}),this._drawPanes=[],this._separatorPanes.clear(),this._chartStore.destroy(),this._container.removeChild(this._chartContainer)}applyNewData(t,e){this._chartStore.applyNewData(t,e)}applyMoreData(t,e){this._chartStore.applyMoreData(t,e)}updateData(t){this._chartStore.updateData(t)}setYScrolling(t){this._chartStore.setYScrolling(t)}getYScrolling(){return this._chartStore.getYScrolling()}loadMore(t){this._chartStore.setDataLoader({getBars:e=>{const i=e.timestamp;t(i)}})}setPriceVolumePrecision(t,e){this._chartStore.setSymbol({pricePrecision:t,volumePrecision:e})}}const Ai=new Map;let ki=1;function Bi(t,e,i){return{x:(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i)+e.x,y:(t.x-e.x)*Math.sin(i)+(t.y-e.y)*Math.cos(i)+e.y}}function Ri(t,e){if(t.length>1){let i;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[0].y<t[1].y?{x:t[0].x,y:e.height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:Yi.getLinearYFromCoordinates(t[0],t[1],{x:0,y:t[0].y})}:{x:e.width,y:Yi.getLinearYFromCoordinates(t[0],t[1],{x:e.width,y:t[0].y})},{coordinates:[t[0],i]}}return[]}function Li(t,e){const i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return Math.sqrt(i*i+s*s)}const Oi={name:"measure",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{backgroundColor:"rgba(22, 119, 255, 0.25)",tipBackgroundColor:"#1677FF",lineColor:"#1677FF"},createPointFigures:({coordinates:t,overlay:e,bounding:i})=>{if(t.length>1){const s=e.points[1]?.value,a=e.points[0]?.value;let r=0,n=0;void 0!==a&&void 0!==s&&(r=(s-a)/a*100,n=s-a);const o=t[0]?.x<t[1]?.x,l=t[0]?.y<t[1]?.y,c={x:Math.round((t[0].x+t[1].x)/2),y:Math.round((t[0].y+t[1].y)/2)},h=e.styles?.backgroundColor,d=e.styles?.tipBackgroundColor,u=e.styles?.lineColor,g=[`${n.toFixed(2)} (${r.toFixed(2)}%)`],p=[{type:"polygon",attrs:{coordinates:[t[0],{x:t[1].x,y:t[0].y},t[1],{x:t[0].x,y:t[1].y}]},styles:{color:h}},{type:"line",attrs:{coordinates:[{x:t[0].x,y:c.y},{x:t[1].x,y:c.y}]},styles:{color:u}},{type:"line",attrs:{coordinates:[{x:c.x,y:t[0].y},{x:c.x,y:t[1].y}]},styles:{color:u}}];o?p.push({type:"line",attrs:{coordinates:[{x:t[1].x-6,y:c.y-4},{x:t[1].x,y:c.y},{x:t[1].x-6,y:c.y+4}]}}):p.push({type:"line",attrs:{coordinates:[{x:t[1].x+6,y:c.y-4},{x:t[1].x,y:c.y},{x:t[1].x+6,y:c.y+4}]}}),l?p.push({type:"line",attrs:{coordinates:[{x:c.x-4,y:t[1].y-6},{x:c.x,y:t[1].y},{x:c.x+4,y:t[1].y-6}]},styles:{color:u}}):p.push({type:"line",attrs:{coordinates:[{x:c.x-4,y:t[1].y+6},{x:c.x,y:t[1].y},{x:c.x+4,y:t[1].y+6}]},styles:{color:u}});const m=g.length;if(m>0){const e=8,s=4,a=12,r=8;let n,o=0;const h=12*m+(m-1)*s+2*r;g.forEach(t=>{o=Math.max(Yi.calcTextWidth(t),o)}),o+=2*a,n=l?t[1].y+e+h>i.height?i.height-h:t[1].y+e:t[1].y-e-h<0?0:t[1].y-e-h,p.push({type:"rect",attrs:{x:c.x-o/2,y:n,width:o,height:h},styles:{borderRadius:4,color:d}});let u=n+r;g.forEach(t=>{p.push({type:"text",attrs:{x:c.x,y:u,text:t,align:"center"},styles:{paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,backgroundColor:"none",family:"Space Grotesk, sans-serif"}}),u+=12+s})}return p}return[]}},Wi=[{name:"arrow",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{if(t.length>1){const e=t[1].x>t[0].x?0:1,i=Yi.getLinearSlopeIntercept(t[0],t[1]);let s;s=i?Math.atan(i[0])+Math.PI*e:t[1].y>t[0].y?Math.PI/2:Math.PI/2*3;const a=Bi({x:t[1].x-8,y:t[1].y+4},t[1],s),r=Bi({x:t[1].x-8,y:t[1].y-4},t[1],s);return[{type:"line",attrs:{coordinates:t}},{type:"line",ignoreEvent:!0,attrs:{coordinates:[a,t[1],r]}}]}return[]}},{name:"circle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{circle:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{if(t.length>1){const e=Li(t[0],t[1]);return{type:"circle",attrs:{...t[0],r:e},styles:{style:"stroke_fill"}}}return[]}},{name:"rect",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>t.length>1?[{type:"polygon",attrs:{coordinates:[t[0],{x:t[1].x,y:t[0].y},t[1],{x:t[0].x,y:t[1].y}]},styles:{style:"stroke_fill"}}]:[]},{name:"triangle",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>[{type:"polygon",attrs:{coordinates:t},styles:{style:"stroke_fill"}}]},{name:"parallelogram",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{if(2===t.length)return[{type:"line",ignoreEvent:!0,attrs:{coordinates:t}}];if(3===t.length){const e={x:t[0].x+t[2].x-t[1].x,y:t[0].y+t[2].y-t[1].y};return[{type:"polygon",attrs:{coordinates:[t[0],t[1],t[2],e]},styles:{style:"stroke_fill"}}]}return[]},performEventPressedMove:({points:t,performPointIndex:e,performPoint:i})=>{e<2&&(t[0].price=i.price,t[1].price=i.price)},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].price=i.price)}},{name:"fibonacciCircle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{if(t.length>1){const e=Math.abs(t[0].x-t[1].x),i=Math.abs(t[0].y-t[1].y),s=Math.sqrt(e*e+i*i),a=[],r=[];return[.236,.382,.5,.618,.786,1].forEach(e=>{const i=s*e;a.push({...t[0],r:i}),r.push({x:t[0].x,y:t[0].y+i+6,text:`${(100*e).toFixed(1)}%`})}),[{type:"circle",attrs:a,styles:{style:"stroke"}},{type:"text",ignoreEvent:!0,attrs:r}]}return[]}},{name:"fibonacciSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,overlay:e,precision:i})=>{const s=[],a=[];if(t.length>1){const r=t[1].x>t[0].x?t[0].x:t[1].x,n=[1,.786,.618,.5,.382,.236,0],o=t[0].y-t[1].y,l=e.points,c=l[0].value-l[1].value;n.forEach(e=>{const n=t[1].y+o*e,h=(l[1].value+c*e).toFixed(i.price);s.push({coordinates:[{x:t[0].x,y:n},{x:t[1].x,y:n}]}),a.push({x:r,y:n,text:`${h} (${(100*e).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:s},{type:"text",ignoreEvent:!0,attrs:a}]}},{name:"fibonacciSpiral",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{if(t.length>1){const i=Li(t[0],t[1])/Math.sqrt(24),s=t[1].x>t[0].x?0:1,a=Yi.getLinearSlopeIntercept(t[0],t[1]);let r;r=a?Math.atan(a[0])+Math.PI*s:t[1].y>t[0].y?Math.PI/2:Math.PI/2*3;const n=Bi({x:t[0].x-i,y:t[0].y},t[0],r),o=Bi({x:t[0].x-i,y:t[0].y-i},t[0],r),l=[{...n,r:i,startAngle:r,endAngle:r+Math.PI/2},{...o,r:2*i,startAngle:r+Math.PI/2,endAngle:r+Math.PI}];let c=t[0].x-i,h=t[0].y-i;for(let e=2;e<9;e++){const i=l[e-2].r+l[e-1].r;let s=0;switch(e%4){case 0:s=r,c-=l[e-2].r;break;case 1:s=r+Math.PI/2,h-=l[e-2].r;break;case 2:s=r+Math.PI,c+=l[e-2].r;break;case 3:s=r+Math.PI/2*3,h+=l[e-2].r}const a=s+Math.PI/2,n=Bi({x:c,y:h},t[0],r);l.push({...n,r:i,startAngle:s,endAngle:a})}return[{type:"arc",attrs:l},{type:"line",attrs:Ri(t,e)}]}return[]}},{name:"fibonacciSpeedResistanceFan",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{const i=[];let s=[];const a=[];if(t.length>1){const r=t[1].x>t[0].x?-38:4,n=t[1].y>t[0].y?-2:20,o=t[1].x-t[0].x,l=t[1].y-t[0].y;[1,.75,.618,.5,.382,.25,0].forEach(c=>{const h=t[1].x-o*c,d=t[1].y-l*c;i.push({coordinates:[{x:h,y:t[0].y},{x:h,y:t[1].y}]}),i.push({coordinates:[{x:t[0].x,y:d},{x:t[1].x,y:d}]}),s=s.concat(Ri([t[0],{x:h,y:t[1].y}],e)),s=s.concat(Ri([t[0],{x:t[1].x,y:d}],e)),a.unshift({x:t[0].x+r,y:d+10,text:`${c.toFixed(3)}`}),a.unshift({x:h-18,y:t[0].y+n,text:`${c.toFixed(3)}`})})}return[{type:"line",attrs:i},{type:"line",attrs:s},{type:"text",ignoreEvent:!0,attrs:a}]}},{name:"fibonacciExtension",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,overlay:e,precision:i})=>{const s=[],a=[];if(t.length>2){const r=e.points,n=r[1].value-r[0].value,o=t[1].y-t[0].y,l=[0,.236,.382,.5,.618,.786,1],c=t[2].x>t[1].x?t[1].x:t[2].x;l.forEach(e=>{const l=t[2].y+o*e,h=(r[2].value+n*e).toFixed(i.price);s.push({coordinates:[{x:t[1].x,y:l},{x:t[2].x,y:l}]}),a.push({x:c,y:l,text:`${h} (${(100*e).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:{coordinates:t},styles:{style:"dashed"}},{type:"line",attrs:s},{type:"text",ignoreEvent:!0,attrs:a}]}},{name:"gannBox",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{if(t.length>1){const e=(t[1].y-t[0].y)/4,i=t[1].x-t[0].x,s=[{coordinates:[t[0],{x:t[1].x,y:t[1].y-e}]},{coordinates:[t[0],{x:t[1].x,y:t[1].y-2*e}]},{coordinates:[{x:t[0].x,y:t[1].y},{x:t[1].x,y:t[0].y+e}]},{coordinates:[{x:t[0].x,y:t[1].y},{x:t[1].x,y:t[0].y+2*e}]},{coordinates:[{...t[0]},{x:t[0].x+.236*i,y:t[1].y}]},{coordinates:[{...t[0]},{x:t[0].x+.5*i,y:t[1].y}]},{coordinates:[{x:t[0].x,y:t[1].y},{x:t[0].x+.236*i,y:t[0].y}]},{coordinates:[{x:t[0].x,y:t[1].y},{x:t[0].x+.5*i,y:t[0].y}]}],a=[{coordinates:[t[0],t[1]]},{coordinates:[{x:t[0].x,y:t[1].y},{x:t[1].x,y:t[0].y}]}];return[{type:"line",attrs:[{coordinates:[t[0],{x:t[1].x,y:t[0].y}]},{coordinates:[{x:t[1].x,y:t[0].y},t[1]]},{coordinates:[t[1],{x:t[0].x,y:t[1].y}]},{coordinates:[{x:t[0].x,y:t[1].y},t[0]]}]},{type:"polygon",ignoreEvent:!0,attrs:{coordinates:[t[0],{x:t[1].x,y:t[0].y},t[1],{x:t[0].x,y:t[1].y}]},styles:{style:"fill"}},{type:"line",attrs:s,styles:{style:"dashed"}},{type:"line",attrs:a}]}return[]}},{name:"threeWaves",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=t.map((t,e)=>({...t,text:`(${e})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:t}},{type:"text",ignoreEvent:!0,attrs:e}]}},{name:"fiveWaves",totalStep:7,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=t.map((t,e)=>({...t,text:`(${e})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:t}},{type:"text",ignoreEvent:!0,attrs:e}]}},{name:"eightWaves",totalStep:10,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=t.map((t,e)=>({...t,text:`(${e})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:t}},{type:"text",ignoreEvent:!0,attrs:e}]}},{name:"anyWaves",totalStep:Number.MAX_SAFE_INTEGER,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=t.map((t,e)=>({...t,text:`(${e})`,baseline:"bottom"}));return[{type:"line",attrs:{coordinates:t}},{type:"text",ignoreEvent:!0,attrs:e}]}},{name:"abcd",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{let e=[],i=[];const s=["A","B","C","D"],a=t.map((t,e)=>({...t,baseline:"bottom",text:`(${s[e]})`}));return t.length>2&&(e=[t[0],t[2]],t.length>3&&(i=[t[1],t[3]])),[{type:"line",attrs:{coordinates:t}},{type:"line",attrs:[{coordinates:e},{coordinates:i}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:a}]}},{name:"xabcd",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t,overlay:e})=>{const i=[],s=[],a=["X","A","B","C","D"],r=t.map((t,e)=>({...t,baseline:"bottom",text:`(${a[e]})`}));return t.length>2&&(i.push({coordinates:[t[0],t[2]]}),s.push({coordinates:[t[0],t[1],t[2]]}),t.length>3&&(i.push({coordinates:[t[1],t[3]]}),t.length>4&&(i.push({coordinates:[t[2],t[4]]}),s.push({coordinates:[t[2],t[3],t[4]]})))),[{type:"line",attrs:{coordinates:t}},{type:"line",attrs:i,styles:{style:"dashed"}},{type:"polygon",ignoreEvent:!0,attrs:s},{type:"text",ignoreEvent:!0,attrs:r}]}},{name:"elliotTripleComboWaves",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=["(0)","(W)","(X)","(Y)","(Z)"],i=t.map((t,i)=>({...t,baseline:"bottom",text:`(${e[i]})`}));return[{type:"line",attrs:{coordinates:t}},{type:"line",attrs:[{coordinates:[]},{coordinates:[]}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:i}]}},{name:"headAndShoulders",totalStep:8,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({coordinates:t})=>{const e=[],i=[],s=["1","Left Shoulder","2","Head","3","Right Shoulder","4"],a=t.map((t,e)=>({...t,baseline:"bottom",text:`${s[e]}`}));return t.length>2&&(e.push({coordinates:[t[0],t[2]]}),i.push({coordinates:[t[0],t[1],t[2]]}),t.length>4&&(e.push({coordinates:[t[2],t[4]]}),i.push({coordinates:[t[2],t[3],t[4]]}),t.length>6&&(e.push({coordinates:[t[4],t[6]]}),i.push({coordinates:[t[4],t[5],t[6]]})))),[{type:"line",attrs:{coordinates:t}},{type:"line",attrs:e,styles:{style:"dashed"}},{type:"polygon",ignoreEvent:!0,attrs:i},{type:"text",ignoreEvent:!0,attrs:a}]}},Oi,{name:"crossLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:e.width,y:t[0].y}]}},{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]},{name:"faltTopBottom",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!1,styles:{polygon:{color:"#FCB9002b"},line:{size:2,color:"#FCB900"}},createPointFigures:({coordinates:t,overlay:e})=>{let i=[];const s=[],a=[];return t.length>2?(i=[{coordinates:[{x:t[0].x,y:t[2].y},{x:t[1].x,y:t[2].y}]}],a.push({coordinates:[t[0],t[1],{x:t[1].x,y:t[2].y},{x:t[0].x,y:t[2].y}]}),s.push({coordinates:[t[0],t[1]]})):i=[{coordinates:t}],[{type:"line",attrs:i,size:2},{type:"polygon",ignoreEvent:!0,attrs:a},{type:"line",attrs:s,size:2}]},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{if(3===t)e[1].timestamp=i.timestamp,e[1].dataIndex=i.dataIndex},performEventPressedMove:({points:t,performPointIndex:e,performPoint:i})=>{switch(e){case 1:t[2].timestamp=i.timestamp,t[2].dataIndex=i.dataIndex;break;case 2:t[1].timestamp=i.timestamp,t[1].dataIndex=i.dataIndex;break;case 3:t[1].timestamp=i.timestamp}}},{name:"disJointChannel",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"#FCB9002b"},line:{size:2,color:"#FCB900"}},createPointFigures:({coordinates:t,bounding:e})=>{let i=[];const s=[];let a=0;return t.length>=2&&(a=Math.abs(t[1].y-t[0].y)),t.length>2?(i=[{coordinates:[{x:t[0].x,y:t[0].y},{x:t[1].x,y:t[1].y}]}],s.push({coordinates:[{x:t[1].x,y:t[2].y},{x:t[0].x,y:t[2].y+a}]})):i=[{coordinates:t}],[{type:"line",ignoreEvent:!1,attrs:i},{type:"line",ignoreEvent:!1,attrs:s}]},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{if(3===t)e[1].timestamp=i.timestamp,e[1].dataIndex=i.dataIndex},performEventPressedMove:({points:t,performPointIndex:e,performPoint:i})=>{switch(e){case 1:t[2].timestamp=i.timestamp,t[2].dataIndex=i.dataIndex;break;case 2:t[1].timestamp=i.timestamp,t[1].dataIndex=i.dataIndex}}},{name:"arc",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{arc:{color:"rgba(22, 119, 255)"}},createPointFigures:({coordinates:t})=>{if(t.length>1){return[{type:"arc",attrs:{x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2,r:Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2))/2,startAngle:0,endAngle:Math.PI},styles:{style:"solid"}}]}return[]}},{name:"tradingPlan",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=t.length;if(e>=2){if(2==e)return[{type:"line",attrs:{coordinates:t}}];if(e>=3){const i={type:"polygon",attrs:{coordinates:[t[0],t[1],{x:t[1].x,y:t[2].y},{x:t[0].x,y:t[2].y}]},styles:{style:"fill",color:"#DE46464f"}};if(3==e)return[i];return[i,{type:"polygon",attrs:{coordinates:[t[0],t[1],{x:t[1].x,y:t[3].y},{x:t[0].x,y:t[3].y}]},styles:{style:"fill",color:"#03ca9b2f"}}]}}return[]},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{switch(t){case 2:e[0].value=i.value;break;case 3:e[1].timestamp=i.timestamp,e[1].dataIndex=i.dataIndex;break;case 4:e[1].timestamp=e[2].timestamp=i.timestamp,e[1].dataIndex=e[2].dataIndex=i.dataIndex}},performEventPressedMove:({points:t,performPointIndex:e,performPoint:i})=>{switch(e){case 0:t[1].value=i.value;break;case 1:t[0].value=i.value,t[2].timestamp=t[3].timestamp=i.timestamp,t[2].dataIndex=t[3].dataIndex=i.dataIndex;break;case 2:t[1].timestamp=t[3].timestamp=i.timestamp,t[1].dataIndex=t[3].dataIndex=i.dataIndex;break;case 3:t[1].timestamp=t[2].timestamp=i.timestamp,t[1].dataIndex=t[2].dataIndex=i.dataIndex}}},{name:"fibonacciDiagonal",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e,overlay:i,precision:s,thousandsSeparator:a})=>{const r=i.points;if(t.length>0){const e=[],i=[],n=t[0].x,o=t[t.length-1].x;if(t.length>1&&void 0!==r[0].value&&void 0!==r[1].value){const l=[1,.786,.618,.5,.382,.236,0],c=t[0].y-t[1].y,h=r[0].value-r[1].value;l.forEach(l=>{const d=t[1].y+c*l,u=function(t,e){const i=`${t}`;if(0===e.length)return i;if(i.includes(".")){const t=i.split(".");return`${t[0].replace(/(\d)(?=(\d{3})+$)/g,t=>`${t}${e}`)}.${t[1]}`}return i.replace(/(\d)(?=(\d{3})+$)/g,t=>`${t}${e}`)}(((r[1].value??0)+h*l).toFixed(s.price),a);e.push({coordinates:[{x:n,y:d},{x:o,y:d}]}),i.push({x:n,y:d,text:`${u} (${(100*l).toFixed(1)}%)`,baseline:"bottom"})}),e.push({coordinates:[{x:e[0].coordinates[0].x,y:e[0].coordinates[0].y},{x:e[l.length-1].coordinates[1].x,y:e[l.length-1].coordinates[1].y}]})}return[{type:"line",attrs:e},{type:"text",isCheckEvent:!1,attrs:i}]}return[]},onRightClick:t=>(alert(`object ${t.overlay.name} was clicked`),!0)}];Wi.forEach(t=>{re(t)});const Yi={clone:i,merge:e,isString:c,isNumber:n,isValid:o,isObject:r,isArray:s,isFunction:a,isBoolean:l,formatValue:_,formatPrecision:b,formatBigNumber:E,formatDate:v,formatThousands:C,formatFoldDecimal:w,calcTextWidth:T,getLinearSlopeIntercept:N,getLinearYFromSlopeIntercept:W,getLinearYFromCoordinates:Y,checkCoordinateOnArc:k,checkCoordinateOnCircle:R,checkCoordinateOnLine:O,checkCoordinateOnPolygon:X,checkCoordinateOnRect:$,checkCoordinateOnText:q};t.CandleType={CandleSolid:"candle_solid",CandleStroke:"candle_stroke",CandleUpStroke:"candle_up_stroke",CandleDownStroke:"candle_down_stroke",Ohlc:"ohlc",Area:"area",Line:"line",LineMark:"line_mark",StepLine:"step_line",HeikinAshi:"heikin_ashi",CandleHighLow:"candle_high_low",CandleHighLowArea:"candle_high_low_area"},t.ChartMain=class{},t.YAxisType={Normal:"normal",Log:"log",Percentage:"percentage"},t.dispose=function(t){let e=null;if(t instanceof Fi)e=t.id;else{let i=null;i=c(t)?document.getElementById(t):t,e=i?.getAttribute("k-line-chart-id")??null}null!==e&&(Ai.get(e)?.destroy(),Ai.delete(e))},t.getFigureClass=function(t){return tt[t]??null},t.getOverlayClass=function(t){return ae[t]??null},t.getSupportedFigures=function(){return Object.keys(tt)},t.getSupportedIndicators=function(){return Object.keys(Et)},t.getSupportedLocales=function(){return Object.keys(Pt)},t.getSupportedOverlays=function(){return Object.keys(ae)},t.init=function(t,e){let i=null;if(i=c(t)?document.getElementById(t):t,null===i)return null;let s=Ai.get(i.id);if(o(s))return s;const a="k_line_chart_"+ki++;return s=new Fi(i,e),s.id=a,i.setAttribute("k-line-chart-id",a),Ai.set(a,s),s},t.proOverlays=Wi,t.registerFigure=function(t){tt[t.name]=A.extend(t)},t.registerIndicator=function(t){Et[t.name]=it.extend(t)},t.registerLocale=function(t,e){Pt[t]={...Pt[t],...e}},t.registerOverlay=re,t.registerStyles=function(t,e){ne[t]=e},t.registerXAxis=function(t){ue[t.name]=de.extend(t)},t.registerYAxis=function(t){xe[t.name]=pe.extend(t)},t.utils=Yi,t.version=function(){return"10.0.0-beta1"}});
